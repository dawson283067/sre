# 一：基于Velero实现k8s的数据备份与恢复

```sh
Velero 是一个云原生的灾难恢复和迁移工具，它本身也是开源的，采用Go语言编写。可以安全备份、恢复和迁移Kubernetes集群资源数据。

Velero 是西班牙语，意思是帆船。非常符合Kubernetes社区的命名风格。Velero的开发公司Heptio，已经被VMware收购。VMware把它开源

Velero支持标准的k8s集群，既可以是私有云平台也可以是公有云，除了灾备之外它还能做资源转移，支持把容器应用从一个集群迁移到另一个集群。

Velero组件一共分两部分，分别是服务端和客户端。
服务端：运行在你的kubernetes集群中
客户端：是一些运行在本地的命令行的工具，需要已配置好kubectl及集群kubeconfig的机器上。
```

```
velero单独对指定namespace做备份。基于namespace做备份的。恢复的时候只恢复该namespace的。
velero分为服务端和客户端。
etcd是全量备份。
在k8s启动了一个velero的server端。
velero通过apiserver查询某个namespace的所有数据，然后备份。
这种备份是放到OSS对象存储。备份文件会传到对象存储上。实现高可用，一个数据存放三份。类似于ceph。
只要是标准的对象存储都支持。对象存储后端就是OSD，高可用。OSD可以是AWS也可以是ceph。

Velero客户端是命令行。
Velero不支持本地文件存储。只能放到对象存储。
可以是针对etcd单机，可以是etcd集群来做备份。

etcd是全量备份
之前的恢复只能恢复所有的namespace。
```

```sh
# kubernetes对etcd数据的读写流程
1、Authenticate User
2、Validate Request
3、Retrieve data
4、Update ETCD
5、Scheduler
6、kubelet
```

```sh
# Velero备份流程
~# velero backup create myserver-ns-backup-${DATE} --include-namespaces myserver --kubeconfig=./awsuser.kubeconfig --namespace velero-system

PS：
myserver-ns-backup-${DATE} 备份文件名字
--include-namespaces myserver 备份k8s集群的哪个ns
--namespace velero-system 这是velero的服务端在k8s中的ns
```



## 1.1：部署minio

### 1.1.1：安装docker

```sh
# 安装必要的一些系统工具
[root@k8s-etcd1:~]# apt-get update
[root@k8s-etcd1:~]# apt-get -y install apt-transport-https ca-certificates curl software-properties-common

# Add Docker's official GPG key
[root@k8s-etcd1:~]# install -m 0755 -d /etc/apt/keyrings
[root@k8s-etcd1:~]# curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc
[root@k8s-etcd1:~]# chmod a+r /etc/apt/keyrings/docker.asc

# Add the repository to Apt sources
[root@k8s-etcd1:~]# echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu $(. /etc/os-release && echo "$VERSION_CODENAME") stable" | tee /etc/apt/sources.list.d/docker.list > /dev/null

# 更新
[root@k8s-etcd1:~]# apt-get update

# 安装指定版本的Docker-CE：
# 1. 查找Docker-CE的版本
[root@k8s-etcd1:~]# apt-cache madison docker-ce
[root@k8s-etcd1:~]# apt-cache madison docker-ce-cli

# 2. 安装指定版本的Docker-CE
[root@k8s-etcd1:~]# apt -y install docker-ce=5:26.0.2-1~ubuntu.20.04~focal docker-ce-cli=5:26.0.2-1~ubuntu.20.04~focal

# 查看安装版本
[root@k8s-etcd1:~]# docker info

PS: 使用官方docker源。https://docs.docker.com/engine/install/ubuntu/
```

### 1.1.2：安装minio

```sh
# 镜像minio去hub.docker.com上去找minio/minio
[root@k8s-etcd1:~]# docker pull minio/minio:RELEASE.2022-04-16T04-26-02Z

# 创建数据目录，用来保存minio里的数据。这里是单机的minio。
[root@k8s-etcd1:~]# mkdir -p /data/minio

# 创建minio容器，如果不指定，则默认用户名和密码为minioadmin/minioadmin，可以通过环境变量自定义如下：
[root@k8s-etcd1:~]# docker run --name minio \
> -p 9000:9000 \
> -p 9999:9999 \
> -d --restart=always \
> -e "MINIO_ROOT_USER=admin" \
> -e "MINIO_ROOT_PASSWORD=12345678" \
> -v /data/minio/data:/data \
> minio/minio:RELEASE.2022-04-16T04-26-02Z server /data \
> --console-address '0.0.0.0:9999'
0fe02593c300f54ffb76d1d5fa6cf8f121f352a6c527ce449197848e58f97a9d

命令：
docker run --name minio \
-p 9000:9000 \
-p 9999:9999 \
-d --restart=always \
-e "MINIO_ROOT_USER=admin" \
-e "MINIO_ROOT_PASSWORD=12345678" \
-v /data/minio/data:/data \
minio/minio:RELEASE.2022-04-16T04-26-02Z server /data \
--console-address '0.0.0.0:9999'

PS：通过web界面来管理minio的数据。控制台的监听端口和地址。

# 浏览器上访问：
http://172.31.8.106:9999/login
```



## 1.2：登录web并创建bucket

### 1.2.1：登录界面

![](assets/images/minio01.png)

### 1.2.2：首页

![](assets/images/minio02.png)

### 1.2.3：创建bucket

![](assets/images/minio03.png)

![minio04](assets/images/minio04.png)

## 1.3：部署velero

### 1.3.1：部署velero客户端

```sh
## velero客户端部署
# 安装velero备份环境
# github上搜索velero
# 在有kubectl命令的节点上下载，这里在master1
[root@k8s-master1:~]# cd /usr/local/src/
[root@k8s-master1:/usr/local/src]# wget https://github.com/vmware-tanzu/velero/releases/download/v1.8.1/velero-v1.8.1-linux-amd64.tar.gz

# 解压缩
[root@k8s-master1:/usr/local/src]# tar xvf velero-v1.8.1-linux-amd64.tar.gz

# 查看velero的可执行文件
[root@k8s-master1:/usr/local/src]# ls velero-v1.8.1-linux-amd64/velero
velero-v1.8.1-linux-amd64/velero

[root@k8s-master1:/usr/local/src]# ./velero-v1.8.1-linux-amd64/velero --help

PS：这就是个二进制文件

# 拷贝到系统中，客户端环境准备好了。
[root@k8s-master1:/usr/local/src]# cp velero-v1.8.1-linux-amd64/velero /usr/local/bin/
[root@k8s-master1:/usr/local/src]# velero --help

------------------------------------------------------------------------------------------------------------

```



### 1.3.2：配置velero认证环境

```sh
## velero服务端环境准备
[root@k8s-master1:/usr/local/src]# mkdir /data/velero -p
[root@k8s-master1:/usr/local/src]# cd /data/velero
[root@k8s-master1:/data/velero]# ll
total 0
drwxr-xr-x 2 root root  6 Jun 28 12:56 ./
drwxr-xr-x 3 root root 20 Jun 28 12:56 ../

# 这是和对象存储做认证用的。
[root@k8s-master1:/data/velero]# vim velero-auth.txt
[default]
aws_access_key_id = admin
aws_secret_access_key = 12345678

PS：如果是公有云环境，要拿到AccessKey。

# 要申请用于在k8s里备份使用的证书。要在k8s环境中给这个用户签发个证书。用这个用户备份和还原数据。
[root@k8s-master1:/data/velero]# vim awsuser-csr.json
{
  "CN": "awsuser”,
  "hosts": [],
  "key": {
    "algo": "rsa",
    "size": 2048
  },
  "names": [
    {
      "C": "CN",
      "ST": "BeiJing",
      "L": "BeiJing",
      "O": "k8s",
      "OU": "System"
    }
  ]
}

PS：名字awsuser

# 准备证书签发环境：
[root@k8s-master1:/data/velero]# apt install golang-cfssl

# 其实在kubeasz项目中有cfssl的二进制，但是我们去github下载新的。
[root@k8s-master1:/data/velero]# ls /etc/kubeasz/bin/cfssl
/etc/kubeasz/bin/cfssl

# 下载查看证书信息的文件
[root@k8s-master1:/data/velero]# wget https://github.com/cloudflare/cfssl/releases/download/v1.6.1/cfssl-certinfo_1.6.1_linux_amd64
# 下载识别json的文件
[root@k8s-master1:/data/velero]# wget https://github.com/cloudflare/cfssl/releases/download/v1.6.1/cfssljson_1.6.1_linux_amd64
# 下载证书签发的文件
[root@k8s-master1:/data/velero]# wget https://github.com/cloudflare/cfssl/releases/download/v1.6.1/cfssl_1.6.1_linux_amd64

# 下载后要改名并拷贝到/usr/local/bin/目录中，并增加可执行权限
[root@k8s-master1:/data/velero]# cp cfssl-certinfo_1.6.1_linux_amd64 /usr/local/bin/cfssl-certinfo
[root@k8s-master1:/data/velero]# cp cfssl_1.6.1_linux_amd64 /usr/local/bin/cfssl
[root@k8s-master1:/data/velero]# cp cfssljson_1.6.1_linux_amd64 /usr/local/bin/cfssljson
[root@k8s-master1:/data/velero]# chmod a+x /usr/local/bin/cfssl*

# 准备执行签发证书
[root@k8s-master1:/data/velero]# ls /etc/kubernetes/ssl/ca.pem
/etc/kubernetes/ssl/ca.pem

# 当前k8s集群的配置文件。整个k8s要使用一个ca。下面是证书签发信息。
[root@k8s-master1:/data/velero]# cat /etc/kubeasz/clusters/k8s-cluster1/ssl/ca-config.json
{
  "signing": {
    "default": {
      "expiry": "438000h"
    },
    "profiles": {
      "kubernetes": {
        "usages": [
            "signing",
            "key encipherment",
            "server auth",
            "client auth"
        ],
        "expiry": "438000h"
      }
    },
    "profiles": {
      "kcfg": {
        "usages": [
            "signing",
            "key encipherment",
            "client auth"
        ],
        "expiry": "438000h"
      }
    }
  }
}

[root@k8s-master1:/data/velero]# ll
total 40240
drwxr-xr-x 2 root root      159 Jun 28 13:07 ./
drwxr-xr-x 3 root root       20 Jun 28 12:56 ../
-rw-r--r-- 1 root root      222 Jun 28 13:02 awsuser-csr.json
-rw-r--r-- 1 root root 13502544 Dec  7  2021 cfssl-certinfo_1.6.1_linux_amd64
-rw-r--r-- 1 root root 16659824 Dec  7  2021 cfssl_1.6.1_linux_amd64
-rw-r--r-- 1 root root 11029744 Dec  7  2021 cfssljson_1.6.1_linux_amd64
-rw-r--r-- 1 root root       69 Jun 28 12:59 velero-auth.txt

# 签发证书
[root@k8s-master1:/data/velero]# /usr/local/bin/cfssl gencert -ca=/etc/kubernetes/ssl/ca.pem -ca-key=/etc/kubernetes/ssl/ca-key.pem -config=/etc/kubeasz/clusters/k8s-cluster1/ssl/ca-config.json -profile=kubernetes ./awsuser-csr.json | cfssljson -bare awsuser
2024/06/28 13:17:18 [INFO] generate received request
2024/06/28 13:17:18 [INFO] received CSR
2024/06/28 13:17:18 [INFO] generating key: rsa-2048
2024/06/28 13:17:18 [INFO] encoded CSR
2024/06/28 13:17:18 [INFO] signed certificate with serial number 278130643613915676532724261732214293126824609715
2024/06/28 13:17:18 [WARNING] This certificate lacks a "hosts" field. This makes it unsuitable for
websites. For more information see the Baseline Requirements for the Issuance and Management
of Publicly-Trusted Certificates, v.1.1.6, from the CA/Browser Forum (https://cabforum.org);
specifically, section 10.2.3 ("Information Requirements").

[root@k8s-master1:/data/velero]# ll
total 40252
drwxr-xr-x 2 root root      220 Jun 28 13:17 ./
drwxr-xr-x 3 root root       20 Jun 28 12:56 ../
-rw-r--r-- 1 root root      220 Jun 28 13:17 awsuser-csr.json
-rw------- 1 root root     1679 Jun 28 13:17 awsuser-key.pem
-rw-r--r-- 1 root root      997 Jun 28 13:17 awsuser.csr
-rw-r--r-- 1 root root     1387 Jun 28 13:17 awsuser.pem
-rw-r--r-- 1 root root 13502544 Dec  7  2021 cfssl-certinfo_1.6.1_linux_amd64
-rw-r--r-- 1 root root 16659824 Dec  7  2021 cfssl_1.6.1_linux_amd64
-rw-r--r-- 1 root root 11029744 Dec  7  2021 cfssljson_1.6.1_linux_amd64
-rw-r--r-- 1 root root       69 Jun 28 12:59 velero-auth.txt

# 拷贝公钥和私钥拷贝过去。不拷贝也可以。
[root@k8s-master1:/data/velero]# cp awsuser-key.pem /etc/kubernetes/ssl/
[root@k8s-master1:/data/velero]# cp awsuser.pem /etc/kubernetes/ssl/

# 当前k8s集群的所有证书
[root@k8s-master1:/data/velero]# ll /etc/kubernetes/ssl/
total 40
drwxr-xr-x 2 root root  230 Jun 28 13:18 ./
drwxr-xr-x 3 root root  147 Jun 27 11:15 ../
-rw-r--r-- 1 root root 1679 Jun 27 11:14 aggregator-proxy-key.pem
-rw-r--r-- 1 root root 1383 Jun 27 11:14 aggregator-proxy.pem
-rw------- 1 root root 1679 Jun 28 13:18 awsuser-key.pem
-rw-r--r-- 1 root root 1387 Jun 28 13:18 awsuser.pem
-rw-r--r-- 1 root root 1679 Jun 27 11:14 ca-key.pem
-rw-r--r-- 1 root root 1302 Jun 27 11:14 ca.pem
-rw-r--r-- 1 root root 1675 Jun 27 11:15 kubelet-key.pem
-rw-r--r-- 1 root root 1448 Jun 27 11:15 kubelet.pem
-rw-r--r-- 1 root root 1675 Jun 27 11:14 kubernetes-key.pem
-rw-r--r-- 1 root root 1602 Jun 27 11:14 kubernetes.pem

# 生成集群认证config文件，第一步。也可以使用VIP地址
[root@k8s-master1:/data/velero]# export KUBE_APISERVER="https://172.31.8.101:6443"

[root@k8s-master1:/data/velero]# kubectl config set-cluster kubernetes \
--certificate-authority=/etc/kubernetes/ssl/ca.pem \
--embed-certs=true \
--server=${KUBE_APISERVER} \
--kubeconfig=./awsuser.kubeconfig

[root@k8s-master1:/data/velero]# vim awsuser.kubeconfig
apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURsRENDQW55Z0F3SUJBZ0lVYUJEM3VmVDMxd3k3M0I5L3ZZTCs3MWxYNktRd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1lURUxNQWtHQTFVRUJoTUNRMDR4RVRBUEJnTlZCQWdUQ0VoaGJtZGFhRzkxTVFzd0NRWURWUVFIRXdKWQpVekVNTUFvR0ExVUVDaE1EYXpoek1ROHdEUVlEVlFRTEV3WlRlWE4wWlcweEV6QVJCZ05WQkFNVENtdDFZbVZ5CmJtVjBaWE13SUJjTk1qUXdOakkzTVRVd01qQXdXaGdQTWpFeU5EQTJNRE14TlRBeU1EQmFNR0V4Q3pBSkJnTlYKQkFZVEFrTk9NUkV3RHdZRFZRUUlFd2hJWVc1bldtaHZkVEVMTUFrR0ExVUVCeE1DV0ZNeEREQUtCZ05WQkFvVApBMnM0Y3pFUE1BMEdBMVVFQ3hNR1UzbHpkR1Z0TVJNd0VRWURWUVFERXdwcmRXSmxjbTVsZEdWek1JSUJJakFOCkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXhvcnR2U1BZUEFQKzFTbnc1bVp3YlRrKy9DWW8KbmFiNE9LM1lnK3B3cnRydlFicnlWTC9nQ0ZxdXNIV1pQU3pqNDc2ZmdZOU12ZDZmZmZXUzNmaTJYWmNweUNFRwpoYlBWMlRrdXFMdlZ0YmNHUzNvS09TMWlORkVjV3RuNjgyRm8xSXdYOHQ3cUFEOW1mcnRvT3NyeDBlOG9LR3dMCjdEOEZ6cWxYczRWY3lSeWpZdVNoYU10dENrbFkwZzhTV2pDOW5NV3NsRHBpVk9zMnJqcFZUUVJ6OVZRekZWWHQKQkxXT01BdEpHVGVqODhIZEJIS3lPc21FM2crMVZmQ2ZTRHlnQXdlaHlPeko5bE96QzhCMmtrTFh6L3pOSlhnNApBbU5JZmtyOVY0UzZOZEphSWZBbjBkdmRDajBHck16bmpRbUMxc0xqU3ZtQThlb2UzRGZhNmRXTSt3SURBUUFCCm8wSXdRREFPQmdOVkhROEJBZjhFQkFNQ0FRWXdEd1lEVlIwVEFRSC9CQVV3QXdFQi96QWRCZ05WSFE0RUZnUVUKZmozdm52VUJlSS9sMVBQZkwvd243dnM0Y2FBd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFLSW1GajJRVGd3ZgpkbXlCRWlpZm5WM0tuSGVPaTdrbVBSSGtwR3dDbThYQVV0K2ordUo0Y1VZSFcrMTY4V3NhNjBJcEtockJob1ZLCkF1aVppMVkzVW5BNHBac2hvM3pzektFR3Npd0prRTUwYjVQb0ljVk1BdzlUTzFaR3A2K2xXWXdLV0lmWmxjL1oKQkorOTViL25hb2YxWGxxSklqU3ZxZG0yanQ3SnhGUGlEN2d0NHE1NzFPNVI1eldLZmJjeGF6cGgyQXk0VGVhQgp6VWxLYzU0Z0FvdFlldk8va3VqZXFVRnkybXRrNVljZWsyTDJmOFlyUFpGeU5GWkVXSTVJTjJ0YXJvU1lIVGIxCi96QW1TTzJUcSt2VWxJQnVDdTFOUlR4cHowZkZRVElnaVkzKzh0cWdoQzczU1NvWmErNGgzN1pNWVBnbm8wanEKNGpGcHlocmkzOFU9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    server: https://172.31.8.101:6443
  name: kubernetes
contexts: null
current-context: ""
kind: Config
preferences: {}
users: null 

PS：目前信息还不完整，直到生成和kubelet这种kubeconfig一样才可以。有些字段还没有生成。

# 设置客户端证书认证，第二步。把用户的公钥和私钥放到这个文件里。
[root@k8s-master1:/data/velero]# kubectl config set-credentials awsuser \
--client-certificate=/etc/kubernetes/ssl/awsuser.pem \
--client-key=/etc/kubernetes/ssl/awsuser-key.pem \
--embed-certs=true \
--kubeconfig=./awsuser.kubeconfig

[root@k8s-master1:/data/velero]# cat awsuser.kubeconfig 
apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURsRENDQW55Z0F3SUJBZ0lVYUJEM3VmVDMxd3k3M0I5L3ZZTCs3MWxYNktRd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1lURUxNQWtHQTFVRUJoTUNRMDR4RVRBUEJnTlZCQWdUQ0VoaGJtZGFhRzkxTVFzd0NRWURWUVFIRXdKWQpVekVNTUFvR0ExVUVDaE1EYXpoek1ROHdEUVlEVlFRTEV3WlRlWE4wWlcweEV6QVJCZ05WQkFNVENtdDFZbVZ5CmJtVjBaWE13SUJjTk1qUXdOakkzTVRVd01qQXdXaGdQTWpFeU5EQTJNRE14TlRBeU1EQmFNR0V4Q3pBSkJnTlYKQkFZVEFrTk9NUkV3RHdZRFZRUUlFd2hJWVc1bldtaHZkVEVMTUFrR0ExVUVCeE1DV0ZNeEREQUtCZ05WQkFvVApBMnM0Y3pFUE1BMEdBMVVFQ3hNR1UzbHpkR1Z0TVJNd0VRWURWUVFERXdwcmRXSmxjbTVsZEdWek1JSUJJakFOCkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXhvcnR2U1BZUEFQKzFTbnc1bVp3YlRrKy9DWW8KbmFiNE9LM1lnK3B3cnRydlFicnlWTC9nQ0ZxdXNIV1pQU3pqNDc2ZmdZOU12ZDZmZmZXUzNmaTJYWmNweUNFRwpoYlBWMlRrdXFMdlZ0YmNHUzNvS09TMWlORkVjV3RuNjgyRm8xSXdYOHQ3cUFEOW1mcnRvT3NyeDBlOG9LR3dMCjdEOEZ6cWxYczRWY3lSeWpZdVNoYU10dENrbFkwZzhTV2pDOW5NV3NsRHBpVk9zMnJqcFZUUVJ6OVZRekZWWHQKQkxXT01BdEpHVGVqODhIZEJIS3lPc21FM2crMVZmQ2ZTRHlnQXdlaHlPeko5bE96QzhCMmtrTFh6L3pOSlhnNApBbU5JZmtyOVY0UzZOZEphSWZBbjBkdmRDajBHck16bmpRbUMxc0xqU3ZtQThlb2UzRGZhNmRXTSt3SURBUUFCCm8wSXdRREFPQmdOVkhROEJBZjhFQkFNQ0FRWXdEd1lEVlIwVEFRSC9CQVV3QXdFQi96QWRCZ05WSFE0RUZnUVUKZmozdm52VUJlSS9sMVBQZkwvd243dnM0Y2FBd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFLSW1GajJRVGd3ZgpkbXlCRWlpZm5WM0tuSGVPaTdrbVBSSGtwR3dDbThYQVV0K2ordUo0Y1VZSFcrMTY4V3NhNjBJcEtockJob1ZLCkF1aVppMVkzVW5BNHBac2hvM3pzektFR3Npd0prRTUwYjVQb0ljVk1BdzlUTzFaR3A2K2xXWXdLV0lmWmxjL1oKQkorOTViL25hb2YxWGxxSklqU3ZxZG0yanQ3SnhGUGlEN2d0NHE1NzFPNVI1eldLZmJjeGF6cGgyQXk0VGVhQgp6VWxLYzU0Z0FvdFlldk8va3VqZXFVRnkybXRrNVljZWsyTDJmOFlyUFpGeU5GWkVXSTVJTjJ0YXJvU1lIVGIxCi96QW1TTzJUcSt2VWxJQnVDdTFOUlR4cHowZkZRVElnaVkzKzh0cWdoQzczU1NvWmErNGgzN1pNWVBnbm8wanEKNGpGcHlocmkzOFU9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    server: https://172.31.8.101:6443
  name: kubernetes
contexts: null
current-context: ""
kind: Config
preferences: {}
users:
- name: awsuser
  user:
    client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUQwakNDQXJxZ0F3SUJBZ0lVTUxmUE5PV1ZlUzNtVVJnR2JnQkZvYlZBUjdNd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1lURUxNQWtHQTFVRUJoTUNRMDR4RVRBUEJnTlZCQWdUQ0VoaGJtZGFhRzkxTVFzd0NRWURWUVFIRXdKWQpVekVNTUFvR0ExVUVDaE1EYXpoek1ROHdEUVlEVlFRTEV3WlRlWE4wWlcweEV6QVJCZ05WQkFNVENtdDFZbVZ5CmJtVjBaWE13SUJjTk1qUXdOakk0TVRjeE1qQXdXaGdQTWpBM05EQTJNVFl4TnpFeU1EQmFNR0l4Q3pBSkJnTlYKQkFZVEFrTk9NUkF3RGdZRFZRUUlFd2RDWldsS2FXNW5NUkF3RGdZRFZRUUhFd2RDWldsS2FXNW5NUXd3Q2dZRApWUVFLRXdOck9ITXhEekFOQmdOVkJBc1RCbE41YzNSbGJURVFNQTRHQTFVRUF4TUhZWGR6ZFhObGNqQ0NBU0l3CkRRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0NBUW9DZ2dFQkFPYTc5U1FZSW1jMkhleDV2S3RVbXhKdlhOek8KZmxpSkR2V3FtSmxsd255UUtqU25ybW45QTFQSWp1V0s3U2pZR1E3d1BWZThuVnFNemovV3FCckxMV2Nyb3plSApDK1hEV0ZXeDV5VnF2d0VFeFU3YnRaNUpNVklSbE9IeGxOcUJ2UXZsQmF6WDFLK3g5ZzdJQ0JzVkl2TzF4VXF0Ckx5S2xNTDVrak1nbG1yYTFJNkRqWGdCUnFrWnFucVpHdVhnY0dKNUZaa2t0bm1Sd1d4aGdWa3g1SHVGcm1ZY0IKclV6OW40dU5IUEFscE9VTnAvckFnOC9ERzJUSnBaczVFeGxLMlVMSDh0cjBNbjdzalJVSmQxa09UVXJ2c0h0bQpmU1hPUmI2RDVadnZ6Q3dzVG1pVmlDQzZHOHNEdTRqNmxVaklBNExEaUZibGVPQlowWnNmZnpLSERnOENBd0VBCkFhTi9NSDB3RGdZRFZSMFBBUUgvQkFRREFnV2dNQjBHQTFVZEpRUVdNQlFHQ0NzR0FRVUZCd01CQmdnckJnRUYKQlFjREFqQU1CZ05WSFJNQkFmOEVBakFBTUIwR0ExVWREZ1FXQkJUWWRQZFI3N056ZjZZZFc4NUhpMG5jcGs2cwpIVEFmQmdOVkhTTUVHREFXZ0JSK1BlK2U5UUY0aitYVTg5OHYvQ2Z1K3poeG9EQU5CZ2txaGtpRzl3MEJBUXNGCkFBT0NBUUVBY1JLYkhVenR1SDVRUW9hVGo1QzJZaC9IWDdvaEwvdGxqcThuMHQwTGVIUThsN0dtYVFCWG0rdjMKOW90QlpIL0pKa3hTZHBzaFluczg3T0ltb0dPTkhpK0x4UnBFRmt5RUFudkMxNFI0QVhZZkZzL3JGTVdneGRRbwpxanAySG93QnFXd1hBVytRU3lsR2RObVk1OVBPUmQ4Z0VROVZ1WWVnRDIrYTk2RFYwRjBiOXY5QTUzNWR3cS9XCmkwWUJFM01LMGJrZGlTeG9VZ1BJNWNsNW8zZGhGV2o5SS8rZlBoVWtLSHJNK3NWMWtwemt0eWxlUWdoRWVpa0YKRE5rVjVjck8xRDhxQnhiMUthUmZTbUQ5QzU5TmJlYk5MU09ZNmszcVBuWnJIaDNrZGIyeWFYWDlVTmFsdWt2YwplMkFZay9zRkl2T3BUZWJhQm1TcEsxMlRSVHRBRVE9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
    client-key-data: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBNXJ2MUpCZ2laellkN0htOHExU2JFbTljM001K1dJa085YXFZbVdYQ2ZKQXFOS2V1CmFmMERVOGlPNVlydEtOZ1pEdkE5Vjd5ZFdvek9QOWFvR3NzdFp5dWpONGNMNWNOWVZiSG5KV3EvQVFURlR0dTEKbmtreFVoR1U0ZkdVMm9HOUMrVUZyTmZVcjdIMkRzZ0lHeFVpODdYRlNxMHZJcVV3dm1TTXlDV2F0clVqb09OZQpBRkdxUm1xZXBrYTVlQndZbmtWbVNTMmVaSEJiR0dCV1RIa2U0V3VaaHdHdFRQMmZpNDBjOENXazVRMm4rc0NECno4TWJaTW1sbXprVEdVclpRc2Z5MnZReWZ1eU5GUWwzV1E1TlN1K3dlMlo5SmM1RnZvUGxtKy9NTEN4T2FKV0kKSUxvYnl3TzdpUHFWU01nRGdzT0lWdVY0NEZuUm14OS9Nb2NPRHdJREFRQUJBb0lCQUhYRFRzM2FSNHpZRVJQRgoybWF6cXVZUTBwdWNCTjVaTGJwekZLbU9SMkplRGp5THJMaEp1MjRDdWZRc0lQa3N1alZtcGxobVd3V0JRaTlRCjlzR2VHNUZCczI4K3pQSzY3aFhtMCt2RC9MS2ZaYmptNkY1ZVN2N3hIRVRwa1NpbytQemVLalJhZ0NJZ09VNjQKQjNNVEthQ3JrSU9adXFuN0Y5TEU3Um1tSDczSjQzeGhzd1FuUS9XbDZOcGJhSk03V2RKaUpFc3l3Sjd2Q1pKaQpwODNGRWlOMVBON3hLS2JMSlUxckJMMlIwWk1RVFlHd3RBbi93WUdwUCticm54bHJEb1pZbnZ5U3pSdEV3SGEzCnkwQXZydGtKWFYxaDhpUUF2TzNDQVNlNGNDK3lPS2p2WnpUc1JldVRRYTRWV2FDMnlRdk9iRnlsek1IUUxOZ04KUjZsOWtFRUNnWUVBLzNZRURVcHhVUEZiR1lraWZ1L2RoMU1xUjBhN0d6ZVdxazhTM2N4R3JWc3J3T0tqV1JERApHNE1YSllMSjduYlZhYkRPcXM3aHBrbVRpNVByUmhHd0p5KzZvMnA3blRhRS8wcVNlenI2eENsdEJkUGxvajNVCkxLRXExR1ZuS04xQUZvN3hPdTdjYjFzeW9lMkRjMGozdTlQRUN4U1F0NUVwNDIzTG5yRVo5ZUVDZ1lFQTV6aVYKL0E2Ti9VajBNWDk0ai94VEljYndYU002QmhNTm4zcUtEOEtaYWQva0s3bjVVbS9rRDgyMTVQNUJzSmVFeEFadwprMUEvbXpHOHZvK1puYUd5anptbm83SFJWN0h1WnVSNkU3cC9kT1BDeE03YzFJWUphY1U5ODZaZWMrNjFTMW1WCmU3K0kvVXZydVhKam5IQkZKbUVCZmtMYm9PNDU3YXVSK3F5b29lOENnWUVBaUI3eGI4ZVA4K3AzZVhiYUc3dGkKVmw1Wk05dWJqWmdrUHlHZFV2UXJZT29vdVVIS2VvWDFBSzdzWVg5OGJBV0VHQ292SlZMUmFCTGlmTWhYNEdGQwpkTTc0NjJTczg0dCtlSzNhdWJFbXQrbSsveEQyMW1tTnFpNUNyU1JQUUxZTUZUa2JqeVNCN3hBd1BacGFwYzVtCnV2M1BBM3gwMUd1VVgydzh5SlZqMk9FQ2dZQXZiTG5Hb3kyWVg5aEdOc0VCdDExTnRrSWl1RkQwWWdBUFQ5RDEKZnBKODFzRXovc2NXazRDUmhUM2pwQXJSTDZLNW1pQ0k5cEsxUURSWVdaZkdieDN5cG42dDRwRHZqYjA2T1c2WQprVTRIS1pnUFNlYWRhSWlSdXpVRHZvSHRBVzhKNzJ2cm45TjNNSlUreWltSU1yYmNNbFZlRWxSOTQ1N2FFckMwClc2bVMzUUtCZ1FEeXlVSmZuQWtGMmQxbndBbFhwRXZhemJ0UXdYVXJIU0p3ek5Tc3VsVWxOb1RvbmVVZEswZjkKcnhML3BKb0VEbE4xNFhFQW1USm5YU0VNMEh3Mnp2R1J3NzU0ZThOdldwYVNOUW95amxLYTBad1VZZjFDdU53ZgpNZlZxZlcvbzJsKy9qeWg2emkzZmplRkNjenNBdkZzQnp1akdscUNTTFBUcmthQUFqMkFCWVE9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=

# 这里要注意，是可以还原私钥和公钥的，不安全。
[root@k8s-master1:/data/velero]# echo LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUQwakNDQXJxZ0F3SUJBZ0lVTUxmUE5PV1ZlUzNtVVJnR2JnQkZvYlZBUjdNd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1lURUxNQWtHQTFVRUJoTUNRMDR4RVRBUEJnTlZCQWdUQ0VoaGJtZGFhRzkxTVFzd0NRWURWUVFIRXdKWQpVekVNTUFvR0ExVUVDaE1EYXpoek1ROHdEUVlEVlFRTEV3WlRlWE4wWlcweEV6QVJCZ05WQkFNVENtdDFZbVZ5CmJtVjBaWE13SUJjTk1qUXdOakk0TVRjeE1qQXdXaGdQTWpBM05EQTJNVFl4TnpFeU1EQmFNR0l4Q3pBSkJnTlYKQkFZVEFrTk9NUkF3RGdZRFZRUUlFd2RDWldsS2FXNW5NUkF3RGdZRFZRUUhFd2RDWldsS2FXNW5NUXd3Q2dZRApWUVFLRXdOck9ITXhEekFOQmdOVkJBc1RCbE41YzNSbGJURVFNQTRHQTFVRUF4TUhZWGR6ZFhObGNqQ0NBU0l3CkRRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0NBUW9DZ2dFQkFPYTc5U1FZSW1jMkhleDV2S3RVbXhKdlhOek8KZmxpSkR2V3FtSmxsd255UUtqU25ybW45QTFQSWp1V0s3U2pZR1E3d1BWZThuVnFNemovV3FCckxMV2Nyb3plSApDK1hEV0ZXeDV5VnF2d0VFeFU3YnRaNUpNVklSbE9IeGxOcUJ2UXZsQmF6WDFLK3g5ZzdJQ0JzVkl2TzF4VXF0Ckx5S2xNTDVrak1nbG1yYTFJNkRqWGdCUnFrWnFucVpHdVhnY0dKNUZaa2t0bm1Sd1d4aGdWa3g1SHVGcm1ZY0IKclV6OW40dU5IUEFscE9VTnAvckFnOC9ERzJUSnBaczVFeGxLMlVMSDh0cjBNbjdzalJVSmQxa09UVXJ2c0h0bQpmU1hPUmI2RDVadnZ6Q3dzVG1pVmlDQzZHOHNEdTRqNmxVaklBNExEaUZibGVPQlowWnNmZnpLSERnOENBd0VBCkFhTi9NSDB3RGdZRFZSMFBBUUgvQkFRREFnV2dNQjBHQTFVZEpRUVdNQlFHQ0NzR0FRVUZCd01CQmdnckJnRUYKQlFjREFqQU1CZ05WSFJNQkFmOEVBakFBTUIwR0ExVWREZ1FXQkJUWWRQZFI3N056ZjZZZFc4NUhpMG5jcGs2cwpIVEFmQmdOVkhTTUVHREFXZ0JSK1BlK2U5UUY0aitYVTg5OHYvQ2Z1K3poeG9EQU5CZ2txaGtpRzl3MEJBUXNGCkFBT0NBUUVBY1JLYkhVenR1SDVRUW9hVGo1QzJZaC9IWDdvaEwvdGxqcThuMHQwTGVIUThsN0dtYVFCWG0rdjMKOW90QlpIL0pKa3hTZHBzaFluczg3T0ltb0dPTkhpK0x4UnBFRmt5RUFudkMxNFI0QVhZZkZzL3JGTVdneGRRbwpxanAySG93QnFXd1hBVytRU3lsR2RObVk1OVBPUmQ4Z0VROVZ1WWVnRDIrYTk2RFYwRjBiOXY5QTUzNWR3cS9XCmkwWUJFM01LMGJrZGlTeG9VZ1BJNWNsNW8zZGhGV2o5SS8rZlBoVWtLSHJNK3NWMWtwemt0eWxlUWdoRWVpa0YKRE5rVjVjck8xRDhxQnhiMUthUmZTbUQ5QzU5TmJlYk5MU09ZNmszcVBuWnJIaDNrZGIyeWFYWDlVTmFsdWt2YwplMkFZay9zRkl2T3BUZWJhQm1TcEsxMlRSVHRBRVE9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg== | base64 -d
-----BEGIN CERTIFICATE-----
MIID0jCCArqgAwIBAgIUMLfPNOWVeS3mURgGbgBFobVAR7MwDQYJKoZIhvcNAQEL
BQAwYTELMAkGA1UEBhMCQ04xETAPBgNVBAgTCEhhbmdaaG91MQswCQYDVQQHEwJY
UzEMMAoGA1UEChMDazhzMQ8wDQYDVQQLEwZTeXN0ZW0xEzARBgNVBAMTCmt1YmVy
bmV0ZXMwIBcNMjQwNjI4MTcxMjAwWhgPMjA3NDA2MTYxNzEyMDBaMGIxCzAJBgNV
BAYTAkNOMRAwDgYDVQQIEwdCZWlKaW5nMRAwDgYDVQQHEwdCZWlKaW5nMQwwCgYD
VQQKEwNrOHMxDzANBgNVBAsTBlN5c3RlbTEQMA4GA1UEAxMHYXdzdXNlcjCCASIw
DQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAOa79SQYImc2Hex5vKtUmxJvXNzO
fliJDvWqmJllwnyQKjSnrmn9A1PIjuWK7SjYGQ7wPVe8nVqMzj/WqBrLLWcrozeH
C+XDWFWx5yVqvwEExU7btZ5JMVIRlOHxlNqBvQvlBazX1K+x9g7ICBsVIvO1xUqt
LyKlML5kjMglmra1I6DjXgBRqkZqnqZGuXgcGJ5FZkktnmRwWxhgVkx5HuFrmYcB
rUz9n4uNHPAlpOUNp/rAg8/DG2TJpZs5ExlK2ULH8tr0Mn7sjRUJd1kOTUrvsHtm
fSXORb6D5ZvvzCwsTmiViCC6G8sDu4j6lUjIA4LDiFbleOBZ0ZsffzKHDg8CAwEA
AaN/MH0wDgYDVR0PAQH/BAQDAgWgMB0GA1UdJQQWMBQGCCsGAQUFBwMBBggrBgEF
BQcDAjAMBgNVHRMBAf8EAjAAMB0GA1UdDgQWBBTYdPdR77Nzf6YdW85Hi0ncpk6s
HTAfBgNVHSMEGDAWgBR+Pe+e9QF4j+XU898v/Cfu+zhxoDANBgkqhkiG9w0BAQsF
AAOCAQEAcRKbHUztuH5QQoaTj5C2Yh/HX7ohL/tljq8n0t0LeHQ8l7GmaQBXm+v3
9otBZH/JJkxSdpshYns87OImoGONHi+LxRpEFkyEAnvC14R4AXYfFs/rFMWgxdQo
qjp2HowBqWwXAW+QSylGdNmY59PORd8gEQ9VuYegD2+a96DV0F0b9v9A535dwq/W
i0YBE3MK0bkdiSxoUgPI5cl5o3dhFWj9I/+fPhUkKHrM+sV1kpzktyleQghEeikF
DNkV5crO1D8qBxb1KaRfSmD9C59NbebNLSOY6k3qPnZrHh3kdb2yaXX9UNalukvc
e2AYk/sFIvOpTebaBmSpK12TRTtAEQ==
-----END CERTIFICATE-----

[root@k8s-master1:/data/velero]# echo LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBNXJ2MUpCZ2laellkN0htOHExU2JFbTljM001K1dJa085YXFZbVdYQ2ZKQXFOS2V1CmFmMERVOGlPNVlydEtOZ1pEdkE5Vjd5ZFdvek9QOWFvR3NzdFp5dWpONGNMNWNOWVZiSG5KV3EvQVFURlR0dTEKbmtreFVoR1U0ZkdVMm9HOUMrVUZyTmZVcjdIMkRzZ0lHeFVpODdYRlNxMHZJcVV3dm1TTXlDV2F0clVqb09OZQpBRkdxUm1xZXBrYTVlQndZbmtWbVNTMmVaSEJiR0dCV1RIa2U0V3VaaHdHdFRQMmZpNDBjOENXazVRMm4rc0NECno4TWJaTW1sbXprVEdVclpRc2Z5MnZReWZ1eU5GUWwzV1E1TlN1K3dlMlo5SmM1RnZvUGxtKy9NTEN4T2FKV0kKSUxvYnl3TzdpUHFWU01nRGdzT0lWdVY0NEZuUm14OS9Nb2NPRHdJREFRQUJBb0lCQUhYRFRzM2FSNHpZRVJQRgoybWF6cXVZUTBwdWNCTjVaTGJwekZLbU9SMkplRGp5THJMaEp1MjRDdWZRc0lQa3N1alZtcGxobVd3V0JRaTlRCjlzR2VHNUZCczI4K3pQSzY3aFhtMCt2RC9MS2ZaYmptNkY1ZVN2N3hIRVRwa1NpbytQemVLalJhZ0NJZ09VNjQKQjNNVEthQ3JrSU9adXFuN0Y5TEU3Um1tSDczSjQzeGhzd1FuUS9XbDZOcGJhSk03V2RKaUpFc3l3Sjd2Q1pKaQpwODNGRWlOMVBON3hLS2JMSlUxckJMMlIwWk1RVFlHd3RBbi93WUdwUCticm54bHJEb1pZbnZ5U3pSdEV3SGEzCnkwQXZydGtKWFYxaDhpUUF2TzNDQVNlNGNDK3lPS2p2WnpUc1JldVRRYTRWV2FDMnlRdk9iRnlsek1IUUxOZ04KUjZsOWtFRUNnWUVBLzNZRURVcHhVUEZiR1lraWZ1L2RoMU1xUjBhN0d6ZVdxazhTM2N4R3JWc3J3T0tqV1JERApHNE1YSllMSjduYlZhYkRPcXM3aHBrbVRpNVByUmhHd0p5KzZvMnA3blRhRS8wcVNlenI2eENsdEJkUGxvajNVCkxLRXExR1ZuS04xQUZvN3hPdTdjYjFzeW9lMkRjMGozdTlQRUN4U1F0NUVwNDIzTG5yRVo5ZUVDZ1lFQTV6aVYKL0E2Ti9VajBNWDk0ai94VEljYndYU002QmhNTm4zcUtEOEtaYWQva0s3bjVVbS9rRDgyMTVQNUJzSmVFeEFadwprMUEvbXpHOHZvK1puYUd5anptbm83SFJWN0h1WnVSNkU3cC9kT1BDeE03YzFJWUphY1U5ODZaZWMrNjFTMW1WCmU3K0kvVXZydVhKam5IQkZKbUVCZmtMYm9PNDU3YXVSK3F5b29lOENnWUVBaUI3eGI4ZVA4K3AzZVhiYUc3dGkKVmw1Wk05dWJqWmdrUHlHZFV2UXJZT29vdVVIS2VvWDFBSzdzWVg5OGJBV0VHQ292SlZMUmFCTGlmTWhYNEdGQwpkTTc0NjJTczg0dCtlSzNhdWJFbXQrbSsveEQyMW1tTnFpNUNyU1JQUUxZTUZUa2JqeVNCN3hBd1BacGFwYzVtCnV2M1BBM3gwMUd1VVgydzh5SlZqMk9FQ2dZQXZiTG5Hb3kyWVg5aEdOc0VCdDExTnRrSWl1RkQwWWdBUFQ5RDEKZnBKODFzRXovc2NXazRDUmhUM2pwQXJSTDZLNW1pQ0k5cEsxUURSWVdaZkdieDN5cG42dDRwRHZqYjA2T1c2WQprVTRIS1pnUFNlYWRhSWlSdXpVRHZvSHRBVzhKNzJ2cm45TjNNSlUreWltSU1yYmNNbFZlRWxSOTQ1N2FFckMwClc2bVMzUUtCZ1FEeXlVSmZuQWtGMmQxbndBbFhwRXZhemJ0UXdYVXJIU0p3ek5Tc3VsVWxOb1RvbmVVZEswZjkKcnhML3BKb0VEbE4xNFhFQW1USm5YU0VNMEh3Mnp2R1J3NzU0ZThOdldwYVNOUW95amxLYTBad1VZZjFDdU53ZgpNZlZxZlcvbzJsKy9qeWg2emkzZmplRkNjenNBdkZzQnp1akdscUNTTFBUcmthQUFqMkFCWVE9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo= | base64 -d
-----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEA5rv1JBgiZzYd7Hm8q1SbEm9c3M5+WIkO9aqYmWXCfJAqNKeu
af0DU8iO5YrtKNgZDvA9V7ydWozOP9aoGsstZyujN4cL5cNYVbHnJWq/AQTFTtu1
nkkxUhGU4fGU2oG9C+UFrNfUr7H2DsgIGxUi87XFSq0vIqUwvmSMyCWatrUjoONe
AFGqRmqepka5eBwYnkVmSS2eZHBbGGBWTHke4WuZhwGtTP2fi40c8CWk5Q2n+sCD
z8MbZMmlmzkTGUrZQsfy2vQyfuyNFQl3WQ5NSu+we2Z9Jc5FvoPlm+/MLCxOaJWI
ILobywO7iPqVSMgDgsOIVuV44FnRmx9/MocODwIDAQABAoIBAHXDTs3aR4zYERPF
2mazquYQ0pucBN5ZLbpzFKmOR2JeDjyLrLhJu24CufQsIPksujVmplhmWwWBQi9Q
9sGeG5FBs28+zPK67hXm0+vD/LKfZbjm6F5eSv7xHETpkSio+PzeKjRagCIgOU64
B3MTKaCrkIOZuqn7F9LE7RmmH73J43xhswQnQ/Wl6NpbaJM7WdJiJEsywJ7vCZJi
p83FEiN1PN7xKKbLJU1rBL2R0ZMQTYGwtAn/wYGpP+brnxlrDoZYnvySzRtEwHa3
y0AvrtkJXV1h8iQAvO3CASe4cC+yOKjvZzTsReuTQa4VWaC2yQvObFylzMHQLNgN
R6l9kEECgYEA/3YEDUpxUPFbGYkifu/dh1MqR0a7GzeWqk8S3cxGrVsrwOKjWRDD
G4MXJYLJ7nbVabDOqs7hpkmTi5PrRhGwJy+6o2p7nTaE/0qSezr6xCltBdPloj3U
LKEq1GVnKN1AFo7xOu7cb1syoe2Dc0j3u9PECxSQt5Ep423LnrEZ9eECgYEA5ziV
/A6N/Uj0MX94j/xTIcbwXSM6BhMNn3qKD8KZad/kK7n5Um/kD8215P5BsJeExAZw
k1A/mzG8vo+ZnaGyjzmno7HRV7HuZuR6E7p/dOPCxM7c1IYJacU986Zec+61S1mV
e7+I/UvruXJjnHBFJmEBfkLboO457auR+qyooe8CgYEAiB7xb8eP8+p3eXbaG7ti
Vl5ZM9ubjZgkPyGdUvQrYOoouUHKeoX1AK7sYX98bAWEGCovJVLRaBLifMhX4GFC
dM7462Ss84t+eK3aubEmt+m+/xD21mmNqi5CrSRPQLYMFTkbjySB7xAwPZpapc5m
uv3PA3x01GuUX2w8yJVj2OECgYAvbLnGoy2YX9hGNsEBt11NtkIiuFD0YgAPT9D1
fpJ81sEz/scWk4CRhT3jpArRL6K5miCI9pK1QDRYWZfGbx3ypn6t4pDvjb06OW6Y
kU4HKZgPSeadaIiRuzUDvoHtAW8J72vrn9N3MJU+yimIMrbcMlVeElR9457aErC0
W6mS3QKBgQDyyUJfnAkF2d1nwAlXpEvazbtQwXUrHSJwzNSsulUlNoToneUdK0f9
rxL/pJoEDlN14XEAmTJnXSEM0Hw2zvGRw754e8NvWpaSNQoyjlKa0ZwUYf1CuNwf
MfVqfW/o2l+/jyh6zi3fjeFCczsAvFsBzujGlqCSLPTrkaAAj2ABYQ==
-----END RSA PRIVATE KEY-----

[root@k8s-master1:/data/velero]# cat awsuser-key.pem
-----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEA5rv1JBgiZzYd7Hm8q1SbEm9c3M5+WIkO9aqYmWXCfJAqNKeu
af0DU8iO5YrtKNgZDvA9V7ydWozOP9aoGsstZyujN4cL5cNYVbHnJWq/AQTFTtu1
nkkxUhGU4fGU2oG9C+UFrNfUr7H2DsgIGxUi87XFSq0vIqUwvmSMyCWatrUjoONe
AFGqRmqepka5eBwYnkVmSS2eZHBbGGBWTHke4WuZhwGtTP2fi40c8CWk5Q2n+sCD
z8MbZMmlmzkTGUrZQsfy2vQyfuyNFQl3WQ5NSu+we2Z9Jc5FvoPlm+/MLCxOaJWI
ILobywO7iPqVSMgDgsOIVuV44FnRmx9/MocODwIDAQABAoIBAHXDTs3aR4zYERPF
2mazquYQ0pucBN5ZLbpzFKmOR2JeDjyLrLhJu24CufQsIPksujVmplhmWwWBQi9Q
9sGeG5FBs28+zPK67hXm0+vD/LKfZbjm6F5eSv7xHETpkSio+PzeKjRagCIgOU64
B3MTKaCrkIOZuqn7F9LE7RmmH73J43xhswQnQ/Wl6NpbaJM7WdJiJEsywJ7vCZJi
p83FEiN1PN7xKKbLJU1rBL2R0ZMQTYGwtAn/wYGpP+brnxlrDoZYnvySzRtEwHa3
y0AvrtkJXV1h8iQAvO3CASe4cC+yOKjvZzTsReuTQa4VWaC2yQvObFylzMHQLNgN
R6l9kEECgYEA/3YEDUpxUPFbGYkifu/dh1MqR0a7GzeWqk8S3cxGrVsrwOKjWRDD
G4MXJYLJ7nbVabDOqs7hpkmTi5PrRhGwJy+6o2p7nTaE/0qSezr6xCltBdPloj3U
LKEq1GVnKN1AFo7xOu7cb1syoe2Dc0j3u9PECxSQt5Ep423LnrEZ9eECgYEA5ziV
/A6N/Uj0MX94j/xTIcbwXSM6BhMNn3qKD8KZad/kK7n5Um/kD8215P5BsJeExAZw
k1A/mzG8vo+ZnaGyjzmno7HRV7HuZuR6E7p/dOPCxM7c1IYJacU986Zec+61S1mV
e7+I/UvruXJjnHBFJmEBfkLboO457auR+qyooe8CgYEAiB7xb8eP8+p3eXbaG7ti
Vl5ZM9ubjZgkPyGdUvQrYOoouUHKeoX1AK7sYX98bAWEGCovJVLRaBLifMhX4GFC
dM7462Ss84t+eK3aubEmt+m+/xD21mmNqi5CrSRPQLYMFTkbjySB7xAwPZpapc5m
uv3PA3x01GuUX2w8yJVj2OECgYAvbLnGoy2YX9hGNsEBt11NtkIiuFD0YgAPT9D1
fpJ81sEz/scWk4CRhT3jpArRL6K5miCI9pK1QDRYWZfGbx3ypn6t4pDvjb06OW6Y
kU4HKZgPSeadaIiRuzUDvoHtAW8J72vrn9N3MJU+yimIMrbcMlVeElR9457aErC0
W6mS3QKBgQDyyUJfnAkF2d1nwAlXpEvazbtQwXUrHSJwzNSsulUlNoToneUdK0f9
rxL/pJoEDlN14XEAmTJnXSEM0Hw2zvGRw754e8NvWpaSNQoyjlKa0ZwUYf1CuNwf
MfVqfW/o2l+/jyh6zi3fjeFCczsAvFsBzujGlqCSLPTrkaAAj2ABYQ==
-----END RSA PRIVATE KEY-----

# 设置上下文参数，第三步
[root@k8s-master1:/data/velero]# kubectl config set-context kubernetes \
--cluster=kubernetes \
--user=awsuser \
--namespace=velero-system \
--kubeconfig=./awsuser.kubeconfig

[root@k8s-master1:/data/velero]# cat awsuser.kubeconfig
apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURsRENDQW55Z0F3SUJBZ0lVYUJEM3VmVDMxd3k3M0I5L3ZZTCs3MWxYNktRd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1lURUxNQWtHQTFVRUJoTUNRMDR4RVRBUEJnTlZCQWdUQ0VoaGJtZGFhRzkxTVFzd0NRWURWUVFIRXdKWQpVekVNTUFvR0ExVUVDaE1EYXpoek1ROHdEUVlEVlFRTEV3WlRlWE4wWlcweEV6QVJCZ05WQkFNVENtdDFZbVZ5CmJtVjBaWE13SUJjTk1qUXdOakkzTVRVd01qQXdXaGdQTWpFeU5EQTJNRE14TlRBeU1EQmFNR0V4Q3pBSkJnTlYKQkFZVEFrTk9NUkV3RHdZRFZRUUlFd2hJWVc1bldtaHZkVEVMTUFrR0ExVUVCeE1DV0ZNeEREQUtCZ05WQkFvVApBMnM0Y3pFUE1BMEdBMVVFQ3hNR1UzbHpkR1Z0TVJNd0VRWURWUVFERXdwcmRXSmxjbTVsZEdWek1JSUJJakFOCkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXhvcnR2U1BZUEFQKzFTbnc1bVp3YlRrKy9DWW8KbmFiNE9LM1lnK3B3cnRydlFicnlWTC9nQ0ZxdXNIV1pQU3pqNDc2ZmdZOU12ZDZmZmZXUzNmaTJYWmNweUNFRwpoYlBWMlRrdXFMdlZ0YmNHUzNvS09TMWlORkVjV3RuNjgyRm8xSXdYOHQ3cUFEOW1mcnRvT3NyeDBlOG9LR3dMCjdEOEZ6cWxYczRWY3lSeWpZdVNoYU10dENrbFkwZzhTV2pDOW5NV3NsRHBpVk9zMnJqcFZUUVJ6OVZRekZWWHQKQkxXT01BdEpHVGVqODhIZEJIS3lPc21FM2crMVZmQ2ZTRHlnQXdlaHlPeko5bE96QzhCMmtrTFh6L3pOSlhnNApBbU5JZmtyOVY0UzZOZEphSWZBbjBkdmRDajBHck16bmpRbUMxc0xqU3ZtQThlb2UzRGZhNmRXTSt3SURBUUFCCm8wSXdRREFPQmdOVkhROEJBZjhFQkFNQ0FRWXdEd1lEVlIwVEFRSC9CQVV3QXdFQi96QWRCZ05WSFE0RUZnUVUKZmozdm52VUJlSS9sMVBQZkwvd243dnM0Y2FBd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFLSW1GajJRVGd3ZgpkbXlCRWlpZm5WM0tuSGVPaTdrbVBSSGtwR3dDbThYQVV0K2ordUo0Y1VZSFcrMTY4V3NhNjBJcEtockJob1ZLCkF1aVppMVkzVW5BNHBac2hvM3pzektFR3Npd0prRTUwYjVQb0ljVk1BdzlUTzFaR3A2K2xXWXdLV0lmWmxjL1oKQkorOTViL25hb2YxWGxxSklqU3ZxZG0yanQ3SnhGUGlEN2d0NHE1NzFPNVI1eldLZmJjeGF6cGgyQXk0VGVhQgp6VWxLYzU0Z0FvdFlldk8va3VqZXFVRnkybXRrNVljZWsyTDJmOFlyUFpGeU5GWkVXSTVJTjJ0YXJvU1lIVGIxCi96QW1TTzJUcSt2VWxJQnVDdTFOUlR4cHowZkZRVElnaVkzKzh0cWdoQzczU1NvWmErNGgzN1pNWVBnbm8wanEKNGpGcHlocmkzOFU9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    server: https://172.31.8.101:6443
  name: kubernetes
contexts:
- context:
    cluster: kubernetes
    namespace: velero-system
    user: awsuser
  name: kubernetes
current-context: ""
kind: Config
preferences: {}
users:
- name: awsuser
  user:
    client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUQwakNDQXJxZ0F3SUJBZ0lVTUxmUE5PV1ZlUzNtVVJnR2JnQkZvYlZBUjdNd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1lURUxNQWtHQTFVRUJoTUNRMDR4RVRBUEJnTlZCQWdUQ0VoaGJtZGFhRzkxTVFzd0NRWURWUVFIRXdKWQpVekVNTUFvR0ExVUVDaE1EYXpoek1ROHdEUVlEVlFRTEV3WlRlWE4wWlcweEV6QVJCZ05WQkFNVENtdDFZbVZ5CmJtVjBaWE13SUJjTk1qUXdOakk0TVRjeE1qQXdXaGdQTWpBM05EQTJNVFl4TnpFeU1EQmFNR0l4Q3pBSkJnTlYKQkFZVEFrTk9NUkF3RGdZRFZRUUlFd2RDWldsS2FXNW5NUkF3RGdZRFZRUUhFd2RDWldsS2FXNW5NUXd3Q2dZRApWUVFLRXdOck9ITXhEekFOQmdOVkJBc1RCbE41YzNSbGJURVFNQTRHQTFVRUF4TUhZWGR6ZFhObGNqQ0NBU0l3CkRRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0NBUW9DZ2dFQkFPYTc5U1FZSW1jMkhleDV2S3RVbXhKdlhOek8KZmxpSkR2V3FtSmxsd255UUtqU25ybW45QTFQSWp1V0s3U2pZR1E3d1BWZThuVnFNemovV3FCckxMV2Nyb3plSApDK1hEV0ZXeDV5VnF2d0VFeFU3YnRaNUpNVklSbE9IeGxOcUJ2UXZsQmF6WDFLK3g5ZzdJQ0JzVkl2TzF4VXF0Ckx5S2xNTDVrak1nbG1yYTFJNkRqWGdCUnFrWnFucVpHdVhnY0dKNUZaa2t0bm1Sd1d4aGdWa3g1SHVGcm1ZY0IKclV6OW40dU5IUEFscE9VTnAvckFnOC9ERzJUSnBaczVFeGxLMlVMSDh0cjBNbjdzalJVSmQxa09UVXJ2c0h0bQpmU1hPUmI2RDVadnZ6Q3dzVG1pVmlDQzZHOHNEdTRqNmxVaklBNExEaUZibGVPQlowWnNmZnpLSERnOENBd0VBCkFhTi9NSDB3RGdZRFZSMFBBUUgvQkFRREFnV2dNQjBHQTFVZEpRUVdNQlFHQ0NzR0FRVUZCd01CQmdnckJnRUYKQlFjREFqQU1CZ05WSFJNQkFmOEVBakFBTUIwR0ExVWREZ1FXQkJUWWRQZFI3N056ZjZZZFc4NUhpMG5jcGs2cwpIVEFmQmdOVkhTTUVHREFXZ0JSK1BlK2U5UUY0aitYVTg5OHYvQ2Z1K3poeG9EQU5CZ2txaGtpRzl3MEJBUXNGCkFBT0NBUUVBY1JLYkhVenR1SDVRUW9hVGo1QzJZaC9IWDdvaEwvdGxqcThuMHQwTGVIUThsN0dtYVFCWG0rdjMKOW90QlpIL0pKa3hTZHBzaFluczg3T0ltb0dPTkhpK0x4UnBFRmt5RUFudkMxNFI0QVhZZkZzL3JGTVdneGRRbwpxanAySG93QnFXd1hBVytRU3lsR2RObVk1OVBPUmQ4Z0VROVZ1WWVnRDIrYTk2RFYwRjBiOXY5QTUzNWR3cS9XCmkwWUJFM01LMGJrZGlTeG9VZ1BJNWNsNW8zZGhGV2o5SS8rZlBoVWtLSHJNK3NWMWtwemt0eWxlUWdoRWVpa0YKRE5rVjVjck8xRDhxQnhiMUthUmZTbUQ5QzU5TmJlYk5MU09ZNmszcVBuWnJIaDNrZGIyeWFYWDlVTmFsdWt2YwplMkFZay9zRkl2T3BUZWJhQm1TcEsxMlRSVHRBRVE9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
    client-key-data: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBNXJ2MUpCZ2laellkN0htOHExU2JFbTljM001K1dJa085YXFZbVdYQ2ZKQXFOS2V1CmFmMERVOGlPNVlydEtOZ1pEdkE5Vjd5ZFdvek9QOWFvR3NzdFp5dWpONGNMNWNOWVZiSG5KV3EvQVFURlR0dTEKbmtreFVoR1U0ZkdVMm9HOUMrVUZyTmZVcjdIMkRzZ0lHeFVpODdYRlNxMHZJcVV3dm1TTXlDV2F0clVqb09OZQpBRkdxUm1xZXBrYTVlQndZbmtWbVNTMmVaSEJiR0dCV1RIa2U0V3VaaHdHdFRQMmZpNDBjOENXazVRMm4rc0NECno4TWJaTW1sbXprVEdVclpRc2Z5MnZReWZ1eU5GUWwzV1E1TlN1K3dlMlo5SmM1RnZvUGxtKy9NTEN4T2FKV0kKSUxvYnl3TzdpUHFWU01nRGdzT0lWdVY0NEZuUm14OS9Nb2NPRHdJREFRQUJBb0lCQUhYRFRzM2FSNHpZRVJQRgoybWF6cXVZUTBwdWNCTjVaTGJwekZLbU9SMkplRGp5THJMaEp1MjRDdWZRc0lQa3N1alZtcGxobVd3V0JRaTlRCjlzR2VHNUZCczI4K3pQSzY3aFhtMCt2RC9MS2ZaYmptNkY1ZVN2N3hIRVRwa1NpbytQemVLalJhZ0NJZ09VNjQKQjNNVEthQ3JrSU9adXFuN0Y5TEU3Um1tSDczSjQzeGhzd1FuUS9XbDZOcGJhSk03V2RKaUpFc3l3Sjd2Q1pKaQpwODNGRWlOMVBON3hLS2JMSlUxckJMMlIwWk1RVFlHd3RBbi93WUdwUCticm54bHJEb1pZbnZ5U3pSdEV3SGEzCnkwQXZydGtKWFYxaDhpUUF2TzNDQVNlNGNDK3lPS2p2WnpUc1JldVRRYTRWV2FDMnlRdk9iRnlsek1IUUxOZ04KUjZsOWtFRUNnWUVBLzNZRURVcHhVUEZiR1lraWZ1L2RoMU1xUjBhN0d6ZVdxazhTM2N4R3JWc3J3T0tqV1JERApHNE1YSllMSjduYlZhYkRPcXM3aHBrbVRpNVByUmhHd0p5KzZvMnA3blRhRS8wcVNlenI2eENsdEJkUGxvajNVCkxLRXExR1ZuS04xQUZvN3hPdTdjYjFzeW9lMkRjMGozdTlQRUN4U1F0NUVwNDIzTG5yRVo5ZUVDZ1lFQTV6aVYKL0E2Ti9VajBNWDk0ai94VEljYndYU002QmhNTm4zcUtEOEtaYWQva0s3bjVVbS9rRDgyMTVQNUJzSmVFeEFadwprMUEvbXpHOHZvK1puYUd5anptbm83SFJWN0h1WnVSNkU3cC9kT1BDeE03YzFJWUphY1U5ODZaZWMrNjFTMW1WCmU3K0kvVXZydVhKam5IQkZKbUVCZmtMYm9PNDU3YXVSK3F5b29lOENnWUVBaUI3eGI4ZVA4K3AzZVhiYUc3dGkKVmw1Wk05dWJqWmdrUHlHZFV2UXJZT29vdVVIS2VvWDFBSzdzWVg5OGJBV0VHQ292SlZMUmFCTGlmTWhYNEdGQwpkTTc0NjJTczg0dCtlSzNhdWJFbXQrbSsveEQyMW1tTnFpNUNyU1JQUUxZTUZUa2JqeVNCN3hBd1BacGFwYzVtCnV2M1BBM3gwMUd1VVgydzh5SlZqMk9FQ2dZQXZiTG5Hb3kyWVg5aEdOc0VCdDExTnRrSWl1RkQwWWdBUFQ5RDEKZnBKODFzRXovc2NXazRDUmhUM2pwQXJSTDZLNW1pQ0k5cEsxUURSWVdaZkdieDN5cG42dDRwRHZqYjA2T1c2WQprVTRIS1pnUFNlYWRhSWlSdXpVRHZvSHRBVzhKNzJ2cm45TjNNSlUreWltSU1yYmNNbFZlRWxSOTQ1N2FFckMwClc2bVMzUUtCZ1FEeXlVSmZuQWtGMmQxbndBbFhwRXZhemJ0UXdYVXJIU0p3ek5Tc3VsVWxOb1RvbmVVZEswZjkKcnhML3BKb0VEbE4xNFhFQW1USm5YU0VNMEh3Mnp2R1J3NzU0ZThOdldwYVNOUW95amxLYTBad1VZZjFDdU53ZgpNZlZxZlcvbzJsKy9qeWg2emkzZmplRkNjenNBdkZzQnp1akdscUNTTFBUcmthQUFqMkFCWVE9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=

# 设置默认上下文，第四步
[root@k8s-master1:/data/velero]# kubectl config use-context kubernetes --kubeconfig=awsuser.kubeconfig

[root@k8s-master1:/data/velero]# cat awsuser.kubeconfig
apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURsRENDQW55Z0F3SUJBZ0lVYUJEM3VmVDMxd3k3M0I5L3ZZTCs3MWxYNktRd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1lURUxNQWtHQTFVRUJoTUNRMDR4RVRBUEJnTlZCQWdUQ0VoaGJtZGFhRzkxTVFzd0NRWURWUVFIRXdKWQpVekVNTUFvR0ExVUVDaE1EYXpoek1ROHdEUVlEVlFRTEV3WlRlWE4wWlcweEV6QVJCZ05WQkFNVENtdDFZbVZ5CmJtVjBaWE13SUJjTk1qUXdOakkzTVRVd01qQXdXaGdQTWpFeU5EQTJNRE14TlRBeU1EQmFNR0V4Q3pBSkJnTlYKQkFZVEFrTk9NUkV3RHdZRFZRUUlFd2hJWVc1bldtaHZkVEVMTUFrR0ExVUVCeE1DV0ZNeEREQUtCZ05WQkFvVApBMnM0Y3pFUE1BMEdBMVVFQ3hNR1UzbHpkR1Z0TVJNd0VRWURWUVFERXdwcmRXSmxjbTVsZEdWek1JSUJJakFOCkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXhvcnR2U1BZUEFQKzFTbnc1bVp3YlRrKy9DWW8KbmFiNE9LM1lnK3B3cnRydlFicnlWTC9nQ0ZxdXNIV1pQU3pqNDc2ZmdZOU12ZDZmZmZXUzNmaTJYWmNweUNFRwpoYlBWMlRrdXFMdlZ0YmNHUzNvS09TMWlORkVjV3RuNjgyRm8xSXdYOHQ3cUFEOW1mcnRvT3NyeDBlOG9LR3dMCjdEOEZ6cWxYczRWY3lSeWpZdVNoYU10dENrbFkwZzhTV2pDOW5NV3NsRHBpVk9zMnJqcFZUUVJ6OVZRekZWWHQKQkxXT01BdEpHVGVqODhIZEJIS3lPc21FM2crMVZmQ2ZTRHlnQXdlaHlPeko5bE96QzhCMmtrTFh6L3pOSlhnNApBbU5JZmtyOVY0UzZOZEphSWZBbjBkdmRDajBHck16bmpRbUMxc0xqU3ZtQThlb2UzRGZhNmRXTSt3SURBUUFCCm8wSXdRREFPQmdOVkhROEJBZjhFQkFNQ0FRWXdEd1lEVlIwVEFRSC9CQVV3QXdFQi96QWRCZ05WSFE0RUZnUVUKZmozdm52VUJlSS9sMVBQZkwvd243dnM0Y2FBd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFLSW1GajJRVGd3ZgpkbXlCRWlpZm5WM0tuSGVPaTdrbVBSSGtwR3dDbThYQVV0K2ordUo0Y1VZSFcrMTY4V3NhNjBJcEtockJob1ZLCkF1aVppMVkzVW5BNHBac2hvM3pzektFR3Npd0prRTUwYjVQb0ljVk1BdzlUTzFaR3A2K2xXWXdLV0lmWmxjL1oKQkorOTViL25hb2YxWGxxSklqU3ZxZG0yanQ3SnhGUGlEN2d0NHE1NzFPNVI1eldLZmJjeGF6cGgyQXk0VGVhQgp6VWxLYzU0Z0FvdFlldk8va3VqZXFVRnkybXRrNVljZWsyTDJmOFlyUFpGeU5GWkVXSTVJTjJ0YXJvU1lIVGIxCi96QW1TTzJUcSt2VWxJQnVDdTFOUlR4cHowZkZRVElnaVkzKzh0cWdoQzczU1NvWmErNGgzN1pNWVBnbm8wanEKNGpGcHlocmkzOFU9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    server: https://172.31.8.101:6443
  name: kubernetes
contexts:
- context:
    cluster: kubernetes
    namespace: velero-system
    user: awsuser
  name: kubernetes
current-context: kubernetes
kind: Config
preferences: {}
users:
- name: awsuser
  user:
    client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUQwakNDQXJxZ0F3SUJBZ0lVTUxmUE5PV1ZlUzNtVVJnR2JnQkZvYlZBUjdNd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1lURUxNQWtHQTFVRUJoTUNRMDR4RVRBUEJnTlZCQWdUQ0VoaGJtZGFhRzkxTVFzd0NRWURWUVFIRXdKWQpVekVNTUFvR0ExVUVDaE1EYXpoek1ROHdEUVlEVlFRTEV3WlRlWE4wWlcweEV6QVJCZ05WQkFNVENtdDFZbVZ5CmJtVjBaWE13SUJjTk1qUXdOakk0TVRjeE1qQXdXaGdQTWpBM05EQTJNVFl4TnpFeU1EQmFNR0l4Q3pBSkJnTlYKQkFZVEFrTk9NUkF3RGdZRFZRUUlFd2RDWldsS2FXNW5NUkF3RGdZRFZRUUhFd2RDWldsS2FXNW5NUXd3Q2dZRApWUVFLRXdOck9ITXhEekFOQmdOVkJBc1RCbE41YzNSbGJURVFNQTRHQTFVRUF4TUhZWGR6ZFhObGNqQ0NBU0l3CkRRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0NBUW9DZ2dFQkFPYTc5U1FZSW1jMkhleDV2S3RVbXhKdlhOek8KZmxpSkR2V3FtSmxsd255UUtqU25ybW45QTFQSWp1V0s3U2pZR1E3d1BWZThuVnFNemovV3FCckxMV2Nyb3plSApDK1hEV0ZXeDV5VnF2d0VFeFU3YnRaNUpNVklSbE9IeGxOcUJ2UXZsQmF6WDFLK3g5ZzdJQ0JzVkl2TzF4VXF0Ckx5S2xNTDVrak1nbG1yYTFJNkRqWGdCUnFrWnFucVpHdVhnY0dKNUZaa2t0bm1Sd1d4aGdWa3g1SHVGcm1ZY0IKclV6OW40dU5IUEFscE9VTnAvckFnOC9ERzJUSnBaczVFeGxLMlVMSDh0cjBNbjdzalJVSmQxa09UVXJ2c0h0bQpmU1hPUmI2RDVadnZ6Q3dzVG1pVmlDQzZHOHNEdTRqNmxVaklBNExEaUZibGVPQlowWnNmZnpLSERnOENBd0VBCkFhTi9NSDB3RGdZRFZSMFBBUUgvQkFRREFnV2dNQjBHQTFVZEpRUVdNQlFHQ0NzR0FRVUZCd01CQmdnckJnRUYKQlFjREFqQU1CZ05WSFJNQkFmOEVBakFBTUIwR0ExVWREZ1FXQkJUWWRQZFI3N056ZjZZZFc4NUhpMG5jcGs2cwpIVEFmQmdOVkhTTUVHREFXZ0JSK1BlK2U5UUY0aitYVTg5OHYvQ2Z1K3poeG9EQU5CZ2txaGtpRzl3MEJBUXNGCkFBT0NBUUVBY1JLYkhVenR1SDVRUW9hVGo1QzJZaC9IWDdvaEwvdGxqcThuMHQwTGVIUThsN0dtYVFCWG0rdjMKOW90QlpIL0pKa3hTZHBzaFluczg3T0ltb0dPTkhpK0x4UnBFRmt5RUFudkMxNFI0QVhZZkZzL3JGTVdneGRRbwpxanAySG93QnFXd1hBVytRU3lsR2RObVk1OVBPUmQ4Z0VROVZ1WWVnRDIrYTk2RFYwRjBiOXY5QTUzNWR3cS9XCmkwWUJFM01LMGJrZGlTeG9VZ1BJNWNsNW8zZGhGV2o5SS8rZlBoVWtLSHJNK3NWMWtwemt0eWxlUWdoRWVpa0YKRE5rVjVjck8xRDhxQnhiMUthUmZTbUQ5QzU5TmJlYk5MU09ZNmszcVBuWnJIaDNrZGIyeWFYWDlVTmFsdWt2YwplMkFZay9zRkl2T3BUZWJhQm1TcEsxMlRSVHRBRVE9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
    client-key-data: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBNXJ2MUpCZ2laellkN0htOHExU2JFbTljM001K1dJa085YXFZbVdYQ2ZKQXFOS2V1CmFmMERVOGlPNVlydEtOZ1pEdkE5Vjd5ZFdvek9QOWFvR3NzdFp5dWpONGNMNWNOWVZiSG5KV3EvQVFURlR0dTEKbmtreFVoR1U0ZkdVMm9HOUMrVUZyTmZVcjdIMkRzZ0lHeFVpODdYRlNxMHZJcVV3dm1TTXlDV2F0clVqb09OZQpBRkdxUm1xZXBrYTVlQndZbmtWbVNTMmVaSEJiR0dCV1RIa2U0V3VaaHdHdFRQMmZpNDBjOENXazVRMm4rc0NECno4TWJaTW1sbXprVEdVclpRc2Z5MnZReWZ1eU5GUWwzV1E1TlN1K3dlMlo5SmM1RnZvUGxtKy9NTEN4T2FKV0kKSUxvYnl3TzdpUHFWU01nRGdzT0lWdVY0NEZuUm14OS9Nb2NPRHdJREFRQUJBb0lCQUhYRFRzM2FSNHpZRVJQRgoybWF6cXVZUTBwdWNCTjVaTGJwekZLbU9SMkplRGp5THJMaEp1MjRDdWZRc0lQa3N1alZtcGxobVd3V0JRaTlRCjlzR2VHNUZCczI4K3pQSzY3aFhtMCt2RC9MS2ZaYmptNkY1ZVN2N3hIRVRwa1NpbytQemVLalJhZ0NJZ09VNjQKQjNNVEthQ3JrSU9adXFuN0Y5TEU3Um1tSDczSjQzeGhzd1FuUS9XbDZOcGJhSk03V2RKaUpFc3l3Sjd2Q1pKaQpwODNGRWlOMVBON3hLS2JMSlUxckJMMlIwWk1RVFlHd3RBbi93WUdwUCticm54bHJEb1pZbnZ5U3pSdEV3SGEzCnkwQXZydGtKWFYxaDhpUUF2TzNDQVNlNGNDK3lPS2p2WnpUc1JldVRRYTRWV2FDMnlRdk9iRnlsek1IUUxOZ04KUjZsOWtFRUNnWUVBLzNZRURVcHhVUEZiR1lraWZ1L2RoMU1xUjBhN0d6ZVdxazhTM2N4R3JWc3J3T0tqV1JERApHNE1YSllMSjduYlZhYkRPcXM3aHBrbVRpNVByUmhHd0p5KzZvMnA3blRhRS8wcVNlenI2eENsdEJkUGxvajNVCkxLRXExR1ZuS04xQUZvN3hPdTdjYjFzeW9lMkRjMGozdTlQRUN4U1F0NUVwNDIzTG5yRVo5ZUVDZ1lFQTV6aVYKL0E2Ti9VajBNWDk0ai94VEljYndYU002QmhNTm4zcUtEOEtaYWQva0s3bjVVbS9rRDgyMTVQNUJzSmVFeEFadwprMUEvbXpHOHZvK1puYUd5anptbm83SFJWN0h1WnVSNkU3cC9kT1BDeE03YzFJWUphY1U5ODZaZWMrNjFTMW1WCmU3K0kvVXZydVhKam5IQkZKbUVCZmtMYm9PNDU3YXVSK3F5b29lOENnWUVBaUI3eGI4ZVA4K3AzZVhiYUc3dGkKVmw1Wk05dWJqWmdrUHlHZFV2UXJZT29vdVVIS2VvWDFBSzdzWVg5OGJBV0VHQ292SlZMUmFCTGlmTWhYNEdGQwpkTTc0NjJTczg0dCtlSzNhdWJFbXQrbSsveEQyMW1tTnFpNUNyU1JQUUxZTUZUa2JqeVNCN3hBd1BacGFwYzVtCnV2M1BBM3gwMUd1VVgydzh5SlZqMk9FQ2dZQXZiTG5Hb3kyWVg5aEdOc0VCdDExTnRrSWl1RkQwWWdBUFQ5RDEKZnBKODFzRXovc2NXazRDUmhUM2pwQXJSTDZLNW1pQ0k5cEsxUURSWVdaZkdieDN5cG42dDRwRHZqYjA2T1c2WQprVTRIS1pnUFNlYWRhSWlSdXpVRHZvSHRBVzhKNzJ2cm45TjNNSlUreWltSU1yYmNNbFZlRWxSOTQ1N2FFckMwClc2bVMzUUtCZ1FEeXlVSmZuQWtGMmQxbndBbFhwRXZhemJ0UXdYVXJIU0p3ek5Tc3VsVWxOb1RvbmVVZEswZjkKcnhML3BKb0VEbE4xNFhFQW1USm5YU0VNMEh3Mnp2R1J3NzU0ZThOdldwYVNOUW95amxLYTBad1VZZjFDdU53ZgpNZlZxZlcvbzJsKy9qeWg2emkzZmplRkNjenNBdkZzQnp1akdscUNTTFBUcmthQUFqMkFCWVE9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=

# 在k8s集群中创建awsuser账户：设置为集群管理员
[root@k8s-master1:/data/velero]# kubectl create clusterrolebinding awsuser --clusterrole=cluster-admin --user=awsuser
clusterrolebinding.rbac.authorization.k8s.io/awsuser created
```

### 1.3.3： 部署velero服务端

```sh
# 创建namespace
[root@k8s-master1:/data/velero]# kubectl create ns velero-system
namespace/velero-system created

# 安装velero服务端
[root@k8s-master1:/data/velero]# velero --kubeconfig ./awsuser.kubeconfig \
install \
--provider aws \
--plugins velero/velero-plugin-for-aws:v1.3.1 \
--bucket velerodata \
--secret-file ./velero-auth.txt \
--use-volume-snapshots=false \
--namespace velero-system \
--backup-location-config region=minio,s3ForcePathStyle="true",s3Url=http://172.31.8.106:9000

# 验证这个velero容器是否启动
[root@k8s-master1:/data/velero]# kubectl get pod -n velero-system 
NAME                      READY   STATUS    RESTARTS   AGE
velero-6755cb8697-k5pqq   1/1     Running   0          93s

# 查看日志，都是info级别就没有问题
[root@k8s-master1:/data/velero]# kubectl logs -f velero-6755cb8697-k5pqq -n velero-system

# 查看容器的具体信息
[root@k8s-master1:/data/velero]# kubectl describe pod velero-6755cb8697-k5pqq -n velero-system 
```



## 1.4：备份与还原default命令空间备份

### 1.4.1：验证当前default的ns pod状态

```sh
[root@k8s-master1:/data/velero]# velero --help

[root@k8s-master1:/data/velero]# kubectl get pods
NAME        READY   STATUS    RESTARTS       AGE
net-test1   1/1     Running   0              5h31m
net-test2   1/1     Running   3 (6h9m ago)   27h
```



### 1.4.2：对default ns进行备份

```sh
[root@k8s-master1:/data/velero]# DATE=`date +%Y%m%d%H%M%S`

[root@k8s-master1:/data/velero]# velero backup create default-ns-backup-${DATE} \
--include-namespaces default \
--kubeconfig=./awsuser.kubeconfig \
--namespace velero-system
```

### 1.4.3：minio验证数据备份

![](assets/images/veloro-default01.png)

![veloro-default02](assets/images/veloro-default02.png)

### 1.4.4：删除pod

### 1.4.5：恢复default ns的pod

### 1.4.6：验证恢复后的pod是否存在



## 1.5：备份与还原myserver命令空间

### 1.5.1：创建测试pod

```sh
[root@k8s-master1:~]# kubectl create ns myserver
namespace/myserver created
[root@k8s-master1:~]# kubectl get ns
NAME                   STATUS   AGE
default                Active   27h
kube-node-lease        Active   27h
kube-public            Active   27h
kube-system            Active   27h
kubernetes-dashboard   Active   21h
myserver               Active   5s
velero-system          Active   26m
```

### 1.5.2：验证myserver ns的pod状态

```sh
[root@k8s-master1:~]# kubectl get pods -n myserver 
NAME                                              READY   STATUS    RESTARTS   AGE
linux66-tomcat-app1-deployment-667c9cf879-xtl9h   1/1     Running   0          39s

[root@k8s-master1:/data/velero]# kubectl get deploy -n myserver
NAME                             READY   UP-TO-DATE   AVAILABLE   AGE
linux66-tomcat-app1-deployment   1/1     1            1           19m
[root@k8s-master1:/data/velero]# kubectl get svc -n myserver
NAME                          TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE
linux66-tomcat-app1-service   ClusterIP   10.100.37.181   <none>        80/TCP    19m
```

### 1.5.3：对myserver ns进行备份

```sh
[root@k8s-master1:~]# velero backup create sunnycreek-n66-20240628 --include-namespaces myserver -n velero-system

PS：备份的名字不能重复。

# 正常备份：
# DATE=`date +%Y%m%d%H%M%S`
# velero backup create default-ns-backup-${DATE} \
--include-namespaces default \
--kubeconfig=./awsuser.kubeconfig \
--namespace velero-system

PS：写个脚本，做个任务计划。每天凌晨执行一下。
```

### 1.5.4：minio验证备份数据

![](assets/images/veloro-myserver01.png)

![veloro-myserver02](assets/images/veloro-myserver02.png)

### 1.5.5：删除deployment和service

```sh
[root@k8s-master1:/data/velero]# kubectl delete svc linux66-tomcat-app1-service -n myserver
service "linux66-tomcat-app1-service" deleted
[root@k8s-master1:/data/velero]# kubectl delete deploy linux66-tomcat-app1-deployment -n myserver
deployment.apps "linux66-tomcat-app1-deployment" deleted

```

### 1.5.6：恢复myserver ns的数据

```sh
velero发给apiserver，由apiserver写到etcd。然后再创建。基于消息来传递任务的。再由scheduler调度，再写到etcd。然后再创建pod
这和kubectl去创建没什么太大区别。不会有锁的。

[root@k8s-master1:/data/velero]# velero restore create --from-backup sunnycreek-n66-20240628 --wait --kubeconfig=./awsuser.kubeconfig --namespace velero-system
```

### 1.5.7：验证恢复后的pod和service是否存在

```sh
[root@k8s-master1:/data/velero]# kubectl get deploy -n myserver
NAME                             READY   UP-TO-DATE   AVAILABLE   AGE
linux66-tomcat-app1-deployment   1/1     1            1           43s
[root@k8s-master1:/data/velero]# kubectl get svc -n myserver
NAME                          TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE
linux66-tomcat-app1-service   ClusterIP   10.100.254.84   <none>        80/TCP    50s

```

## 1.6：总结

```sh
minio占用9000和9999端口
docker运行minio
去hub.docker.io找minio项目的镜像
运行后通过web界面访问
创建Bucket --> velerodata
对象存储就准备好了。

去github搜索velero，在能执行kubectl命令的服务器上下载，可以在master节点上下载。

服务端由于需要认证。
/data/velero
部署velero的server端。
创建一个认证文件velero-auth.txt，和对象存储做认证。
签发一个json文件
apt install golang-cfssl  # 需要先安装这个依赖
cfssl三个文件下载下来。github.com中找。

etcd的全量备份
velero的有针对性备份，生产中常用。
```

