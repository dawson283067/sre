# 一：k8s准入控制

## 1.1：概念

```sh
我们在访问k8s的时候，肯定是需要鉴权的。
如何给一个账号授权，然后通过新建的账号对k8s中的一些namespace进行管理。
```

## 1.2：k8s鉴权流程

![](assets/images/authentication_k8s.png)

```sh
## kubernetes 鉴权流程
`1、身份验证
kubernetes API-Server验证客户端身份是不是合法的service account账户，如果不是则API服务器直接返回错误状态码401并终止请求。
此步骤会检查头部报文和客户端证书，如：client certificates，password，tokens
证书过期，证书签发不一致，token过期，反正是有问题都会报错误信息。

认证信息通常位于用户的家目录，/root/.kube/config。这里存储了API Server的地址，以及各种认证信息。
即使你没指定，它也会存在。有的时候为了安全，会放到其他的安全目录，而且名字可能会变。
--kubeconfig=/opt/config  默认是去家目录里去找。也可以放其它路径，比如/opt/config。
[root@k8s-master1:~]# cat /root/.kube/config
apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURsRENDQW55Z0F3SUJBZ0lVYUJEM3VmVDMxd3k3M0I5L3ZZTCs3MWxYNktRd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1lURUxNQWtHQTFVRUJoTUNRMDR4RVRBUEJnTlZCQWdUQ0VoaGJtZGFhRzkxTVFzd0NRWURWUVFIRXdKWQpVekVNTUFvR0ExVUVDaE1EYXpoek1ROHdEUVlEVlFRTEV3WlRlWE4wWlcweEV6QVJCZ05WQkFNVENtdDFZbVZ5CmJtVjBaWE13SUJjTk1qUXdOakkzTVRVd01qQXdXaGdQTWpFeU5EQTJNRE14TlRBeU1EQmFNR0V4Q3pBSkJnTlYKQkFZVEFrTk9NUkV3RHdZRFZRUUlFd2hJWVc1bldtaHZkVEVMTUFrR0ExVUVCeE1DV0ZNeEREQUtCZ05WQkFvVApBMnM0Y3pFUE1BMEdBMVVFQ3hNR1UzbHpkR1Z0TVJNd0VRWURWUVFERXdwcmRXSmxjbTVsZEdWek1JSUJJakFOCkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXhvcnR2U1BZUEFQKzFTbnc1bVp3YlRrKy9DWW8KbmFiNE9LM1lnK3B3cnRydlFicnlWTC9nQ0ZxdXNIV1pQU3pqNDc2ZmdZOU12ZDZmZmZXUzNmaTJYWmNweUNFRwpoYlBWMlRrdXFMdlZ0YmNHUzNvS09TMWlORkVjV3RuNjgyRm8xSXdYOHQ3cUFEOW1mcnRvT3NyeDBlOG9LR3dMCjdEOEZ6cWxYczRWY3lSeWpZdVNoYU10dENrbFkwZzhTV2pDOW5NV3NsRHBpVk9zMnJqcFZUUVJ6OVZRekZWWHQKQkxXT01BdEpHVGVqODhIZEJIS3lPc21FM2crMVZmQ2ZTRHlnQXdlaHlPeko5bE96QzhCMmtrTFh6L3pOSlhnNApBbU5JZmtyOVY0UzZOZEphSWZBbjBkdmRDajBHck16bmpRbUMxc0xqU3ZtQThlb2UzRGZhNmRXTSt3SURBUUFCCm8wSXdRREFPQmdOVkhROEJBZjhFQkFNQ0FRWXdEd1lEVlIwVEFRSC9CQVV3QXdFQi96QWRCZ05WSFE0RUZnUVUKZmozdm52VUJlSS9sMVBQZkwvd243dnM0Y2FBd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFLSW1GajJRVGd3ZgpkbXlCRWlpZm5WM0tuSGVPaTdrbVBSSGtwR3dDbThYQVV0K2ordUo0Y1VZSFcrMTY4V3NhNjBJcEtockJob1ZLCkF1aVppMVkzVW5BNHBac2hvM3pzektFR3Npd0prRTUwYjVQb0ljVk1BdzlUTzFaR3A2K2xXWXdLV0lmWmxjL1oKQkorOTViL25hb2YxWGxxSklqU3ZxZG0yanQ3SnhGUGlEN2d0NHE1NzFPNVI1eldLZmJjeGF6cGgyQXk0VGVhQgp6VWxLYzU0Z0FvdFlldk8va3VqZXFVRnkybXRrNVljZWsyTDJmOFlyUFpGeU5GWkVXSTVJTjJ0YXJvU1lIVGIxCi96QW1TTzJUcSt2VWxJQnVDdTFOUlR4cHowZkZRVElnaVkzKzh0cWdoQzczU1NvWmErNGgzN1pNWVBnbm8wanEKNGpGcHlocmkzOFU9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    server: https://127.0.0.1:6443
  name: cluster1
contexts:
- context:
    cluster: cluster1
    user: admin
  name: context-cluster1
current-context: context-cluster1
kind: Config
preferences: {}
users:
- name: admin
  user:
    client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUQxekNDQXIrZ0F3SUJBZ0lVRUVHczd6SW9UOXYwclF6YTF0MVJZTzJRR2hZd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1lURUxNQWtHQTFVRUJoTUNRMDR4RVRBUEJnTlZCQWdUQ0VoaGJtZGFhRzkxTVFzd0NRWURWUVFIRXdKWQpVekVNTUFvR0ExVUVDaE1EYXpoek1ROHdEUVlEVlFRTEV3WlRlWE4wWlcweEV6QVJCZ05WQkFNVENtdDFZbVZ5CmJtVjBaWE13SUJjTk1qUXdOakkzTVRVd05UQXdXaGdQTWpBM05EQTJNVFV4TlRBMU1EQmFNR2N4Q3pBSkJnTlYKQkFZVEFrTk9NUkV3RHdZRFZRUUlFd2hJWVc1bldtaHZkVEVMTUFrR0ExVUVCeE1DV0ZNeEZ6QVZCZ05WQkFvVApEbk41YzNSbGJUcHRZWE4wWlhKek1ROHdEUVlEVlFRTEV3WlRlWE4wWlcweERqQU1CZ05WQkFNVEJXRmtiV2x1Ck1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBdjlpSDhuMkIwanpOWTFpMTY2b0gKVHRySnczRnBBS2FTZjNIOGJGVlZOUmZQSGNSOEplaTBSQ2xtZVBTbzEwM0FrM2ViV01FRWtrdnFaWVl4UFJhTQpROHhZbE5QNlVxdGZ3OEVuYUVzc21rSkZlckJoMC9VYXZWTmpqWjFJclRGT0xpQWltY0hjNDB4V0c5YmJEdWZnCjdESjRQUG90SXF2Wmp0S2xFYlN1eENaMS9tUFo1S2FTUFhXbUNVSkhvbmxGSmc3UmNWcWtqSFo4dkQ0MVZCODYKU1FEbGpIYUh2NWlpbUpMbmlHcm53UEhhcldXUHRvUUs4QzUrUldUaGJTOUtxMjc1SWd3M254Sk9JVUp3Znhocwp0ZGZrZktiQ2JGNVhWMEozKzkvM0hJUzBXZ0RPWFp0SlVxZGhyVTNVQXFGYVd0RlNXV0FDSTRpU3lDbUE4eVcyCkh3SURBUUFCbzM4d2ZUQU9CZ05WSFE4QkFmOEVCQU1DQmFBd0hRWURWUjBsQkJZd0ZBWUlLd1lCQlFVSEF3RUcKQ0NzR0FRVUZCd01DTUF3R0ExVWRFd0VCL3dRQ01BQXdIUVlEVlIwT0JCWUVGS0t3NDF6NVdnbXVvdHBvRzFrYgpWdXdDSThOZ01COEdBMVVkSXdRWU1CYUFGSDQ5NzU3MUFYaVA1ZFR6M3kvOEorNzdPSEdnTUEwR0NTcUdTSWIzCkRRRUJDd1VBQTRJQkFRQzJvdkx4Q2gwMlV3TUk4MndFSFhaSkVGRExONGthMm1yMjdGUWIwdWVnWG5IV1drSjkKcHJFQk5QUXgydGIwSkVZV0RwbjRTM0JkeDdkVzdYMC8wYUw2VU92RVhtWEJpNmYzUDVzVC9nTWU5NE5pRGNxRwpIa1pQOTNGQUFiM2l5eVQ1V3VtWDBZQWV4Wk15N3E5d1hWUXFNaUdubWFQaEx6clpRdWpvWEZKNXVCS3ByRHhuCnUwU0ZVTnphQmZOQjFkMEJQT3FvMmhDNytsWldnbmwxaDI4bVBJMFZGZ21iSGFyRmxSUVNUSmN0bzM3NnBCdDIKbXRTc1VtQ2w1OTdJOHZTYzFSd2hMZVE0Q3UzdHFqTHJrcmR1VkJhTDVUSXoybzJORDJOS21HZlNSQ3pXQlFQZwppTUtvWkpHYzNCWjhTQldyR3lDNkdNSC9WdlBNcnR4Q0prckMKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
    client-key-data: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBdjlpSDhuMkIwanpOWTFpMTY2b0hUdHJKdzNGcEFLYVNmM0g4YkZWVk5SZlBIY1I4CkplaTBSQ2xtZVBTbzEwM0FrM2ViV01FRWtrdnFaWVl4UFJhTVE4eFlsTlA2VXF0Znc4RW5hRXNzbWtKRmVyQmgKMC9VYXZWTmpqWjFJclRGT0xpQWltY0hjNDB4V0c5YmJEdWZnN0RKNFBQb3RJcXZaanRLbEViU3V4Q1oxL21QWgo1S2FTUFhXbUNVSkhvbmxGSmc3UmNWcWtqSFo4dkQ0MVZCODZTUURsakhhSHY1aWltSkxuaUdybndQSGFyV1dQCnRvUUs4QzUrUldUaGJTOUtxMjc1SWd3M254Sk9JVUp3Znhoc3RkZmtmS2JDYkY1WFYwSjMrOS8zSElTMFdnRE8KWFp0SlVxZGhyVTNVQXFGYVd0RlNXV0FDSTRpU3lDbUE4eVcySHdJREFRQUJBb0lCQUVaVUFacFNpam5oRWtZZQpLaXFuWFNCNk1rYlVsM0ttbmNQY3JIV21YcU1sQkVkY1ZVcXNZUkV2d0NJTlJxd1BFODY3cFJaSFEvN0JsNzc2CkQ2amVVRE0yZ1M2bCt2azlXOUR1U1IwQm1lcys2aXVNNTRBRk5YVThVWjJEa0RYMWdqeUVpVXFtZCt4WGVxV2cKQVJRWXl5cXJZY3F3eDhVVERLRS85VVZsWUVBRldzY2YzRDlPK0pSc3RNWThzTDVEZ2Q4NzBjRHVwM3dWdTFoSgpRTDRFQW5sUVBsTVVwNnU2YnZ1Q00yQ3hMdW1hRjM0aEEvVURxSFB5cXBhV1RlYUNtZTh0aUp3bFErOWxSZksyCkV3Y1d2OEJTNjBha0d1Q1VsTjFvRjdQaXJ6N0xobEdSc2tLSnZzZXB2Z3lqTTl4UjRlYTBqK3NVd1lidUExTzcKNjBpVEJ5a0NnWUVBNkdzM00wSDJ3V3FqUG9CeGo4WG9BL0RtWTM1ZjdONlVUL3Y5Tk9GdSsxckI5akZDOEtnSApJSTJCaE5wcWlMQ2pUSVRqTVVQcnFCYVd5dnFZV1Qyd1U1V1Y0RGlDbG5yTGZsbFlpcTE1a0lNWGRUekZMWmdmCndwTVVvcko5V2I0cWtaVWpabi9XamJLV1BxcFFralJvazhxUHc4RXpaTFJhWnZWd1dnSGtrUU1DZ1lFQTAwOTcKdzdrd1l4RWtySWVqWTc4OW1LNlUxdUNOTWZSam1uaWU3aVpIc0N5d3d2anM2aHNDVDViNU93S1p4ZW5jak9ZRwpGTnduUmJZUXprcHFuNWtJdEhnV1hueGlJTitrVWp5NFFaZnZCaEF0aW9zS252OXlxU2xFMDZLaDBuaUdUVXRiCitYQ3RQcUdRVmRob0xpd2toeGU1M01SNUVxWWRYVmVkNnBMSFpiVUNnWUVBZ0JoWFhCREhCdUxYQmVPVXMwREkKRnlQMlZtK1lQdHlOc1dlWXJrUncvbWVPN3psSFE0dllJY0RiMlhUbnNsNW9JZ3c3aXpONzlqQTgrN0lSdFYyaQppTzZ3bzl1QlhaNWYrVXNVMlpteW5rc2g2cU9McVExbXM3Nk1hUDhteHdkZ1BzeUxyanBXN2RHM3JPSUJkaE1jCmNCZjhGRSt2RzVtckdZTzhZRjhhc2pFQ2dZRUF3aU5OVHdXdVNlWXZMbit6Z21ucU9vTnk1WFFLNVBGbUxUNVMKcmZQbmV4bWtFSTFJaE5EcHI1dkNRUS9qbld4OW44bVpuc0toSmkvZWd0amwydGxyb1BxUGVxR0dPak9lTVp2dApvUDNvc1VaZHdPSjdrSmFham9ZRzRQV1MvTjZVYlNFbVVDYlFWREYxZlJsRXBkOFNkRGM5SUhJMTFnZGVCU3NCClA4azRmdDBDZ1lCMHBBcTVyay82VXppVzJoaDFabHBhaGhKYzBYR3ZTdC9NVWs1eHhBOWFTQmhNZWt5UXhIRUYKbE13elNnWDd3VTdGeTlNTE53LzJ0Q2JleXRUT2VoNTc3cGN0ZzgxNVZFZjhRQ2loOS9RWkxMZS81WDcySmJ1Rgo2SFlCNWsreVg1UzQyeVF1aHZHeTdDRkFMTDdRSStnT3BiMDNjdWtrZDFyOWo5anc0T3VrdGc9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
    
    

`2、鉴权
如果请求者有效，API服务器继续验证客户端是否有权限执行其当前的请求操作，如果请求者未经授权则API服务器返回错误403并终止请求。
此步骤会检测Policy与Verbs，如get、delete等。
就是对资源对象有没有get、delete等权限。

`3、准入控制
如果客户端权限验证通过，则API服务器的准入控制器判断请求是否被允许执行。
此步骤由控制器检测权限，如DenyExecOnPrivileged，LimitRanger等。
k8s有没有资源给你创建，没有也会deny。
```

## 1.3：k8s API 鉴权类型

```sh
## 鉴权类型，四种
https://kubernetes.io/zh/docs/reference/access-authn-authz/authorization
通常情况下不用调整。
主要就是Node和RBAC。

`Node（节点鉴权）：针对kubelet发出的API请求进行鉴权。
同一个k8s内部，它的证书都是由一个CA签发的，所以都是被信任的。
授予node节点的kubelet读取services，endpoints, secrets，configmaps等事件转态，并向API Server更新pod与node状态。
这个可以在主配置文件改。/etc/systemd/system/kube-api-server.servcie。

`Webhook
是一个HTTP回调，发生某些事情时调用的HTTP调用。
比如你上传一个镜像，这个镜像是安全的吗？可以让API Server调用你的镜像扫描器，扫描镜像是不是有一些重大的bug。这个镜像扫描不是k8s本身能完成的。但是可以在你发起镜像调用的时候，调用其他的API接口对镜像进行扫描。
它的镜像扫描必须是https的，也必须配置证书。
通常用不上webhook。

`ABAC(Attribute-based access control)
基于属性的访问控制。1.6之前使用，通常是将用户和权限直接绑定，通过json文件来直接创建。
授权方法粗暴、简单。需要创建一堆json文件，每授权一个账号都需要单独创建。这并不好管理。
目前这种方式废弃了。

`RBAC(Role-Based Access Control):
基于角色的访问控制，将权限与角色（role）先进行关联，然后将角色与用户进行绑定(binding)，从而继承角色中的权限。
用户和权限不是直接关联的。权限和角色进行关联。

[root@k8s-master1:~]# kubectl api-resources
NAME                              SHORTNAMES   APIVERSION                             NAMESPACED   KIND
bindings                                       v1                                     true         Binding
componentstatuses                 cs           v1                                     false        ComponentStatus
configmaps                        cm           v1                                     true         ConfigMap
endpoints                         ep           v1                                     true         Endpoints
events                            ev           v1                                     true         Event
limitranges                       limits       v1                                     true         LimitRange
namespaces                        ns           v1                                     false        Namespace
nodes                             no           v1                                     false        Node
persistentvolumeclaims            pvc          v1                                     true         PersistentVolumeClaim
persistentvolumes                 pv           v1                                     false        PersistentVolume
pods                              po           v1                                     true         Pod
podtemplates                                   v1                                     true         PodTemplate
replicationcontrollers            rc           v1                                     true         ReplicationController
resourcequotas                    quota        v1                                     true         ResourceQuota
secrets                                        v1                                     true         Secret
serviceaccounts                   sa           v1                                     true         ServiceAccount
services                          svc          v1                                     true         Service
mutatingwebhookconfigurations                  admissionregistration.k8s.io/v1        false        MutatingWebhookConfiguration
validatingwebhookconfigurations                admissionregistration.k8s.io/v1        false        ValidatingWebhookConfiguration
customresourcedefinitions         crd,crds     apiextensions.k8s.io/v1                false        CustomResourceDefinition
apiservices                                    apiregistration.k8s.io/v1              false        APIService
controllerrevisions                            apps/v1                                true         ControllerRevision
daemonsets                        ds           apps/v1                                true         DaemonSet
deployments                       deploy       apps/v1                                true         Deployment
replicasets                       rs           apps/v1                                true         ReplicaSet
statefulsets                      sts          apps/v1                                true         StatefulSet
tokenreviews                                   authentication.k8s.io/v1               false        TokenReview
localsubjectaccessreviews                      authorization.k8s.io/v1                true         LocalSubjectAccessReview
selfsubjectaccessreviews                       authorization.k8s.io/v1                false        SelfSubjectAccessReview
selfsubjectrulesreviews                        authorization.k8s.io/v1                false        SelfSubjectRulesReview
subjectaccessreviews                           authorization.k8s.io/v1                false        SubjectAccessReview
horizontalpodautoscalers          hpa          autoscaling/v2                         true         HorizontalPodAutoscaler
cronjobs                          cj           batch/v1                               true         CronJob
jobs                                           batch/v1                               true         Job
certificatesigningrequests        csr          certificates.k8s.io/v1                 false        CertificateSigningRequest
leases                                         coordination.k8s.io/v1                 true         Lease
endpointslices                                 discovery.k8s.io/v1                    true         EndpointSlice
events                            ev           events.k8s.io/v1                       true         Event
flowschemas                                    flowcontrol.apiserver.k8s.io/v1beta2   false        FlowSchema
prioritylevelconfigurations                    flowcontrol.apiserver.k8s.io/v1beta2   false        PriorityLevelConfiguration
nodes                                          metrics.k8s.io/v1beta1                 false        NodeMetrics
pods                                           metrics.k8s.io/v1beta1                 true         PodMetrics
ingressclasses                                 networking.k8s.io/v1                   false        IngressClass
ingresses                         ing          networking.k8s.io/v1                   true         Ingress
networkpolicies                   netpol       networking.k8s.io/v1                   true         NetworkPolicy
runtimeclasses                                 node.k8s.io/v1                         false        RuntimeClass
poddisruptionbudgets              pdb          policy/v1                              true         PodDisruptionBudget
podsecuritypolicies               psp          policy/v1beta1                         false        PodSecurityPolicy
clusterrolebindings                            rbac.authorization.k8s.io/v1           false        ClusterRoleBinding
clusterroles                                   rbac.authorization.k8s.io/v1           false        ClusterRole
rolebindings                                   rbac.authorization.k8s.io/v1           true         RoleBinding
roles                                          rbac.authorization.k8s.io/v1           true         Role
priorityclasses                   pc           scheduling.k8s.io/v1                   false        PriorityClass
csidrivers                                     storage.k8s.io/v1                      false        CSIDriver
csinodes                                       storage.k8s.io/v1                      false        CSINode
csistoragecapacities                           storage.k8s.io/v1beta1                 true         CSIStorageCapacity
storageclasses                    sc           storage.k8s.io/v1                      false        StorageClass
volumeattachments                              storage.k8s.io/v1                      false        VolumeAttachment
backups                                        velero.io/v1                           true         Backup
backupstoragelocations            bsl          velero.io/v1                           true         BackupStorageLocation
deletebackuprequests                           velero.io/v1                           true         DeleteBackupRequest
downloadrequests                               velero.io/v1                           true         DownloadRequest
podvolumebackups                               velero.io/v1                           true         PodVolumeBackup
podvolumerestores                              velero.io/v1                           true         PodVolumeRestore
resticrepositories                             velero.io/v1                           true         ResticRepository
restores                                       velero.io/v1                           true         Restore
schedules                                      velero.io/v1                           true         Schedule
serverstatusrequests              ssr          velero.io/v1                           true         ServerStatusRequest
volumesnapshotlocations                        velero.io/v1                           true         VolumeSnapshotLocation

PS：
roles
clusterroles
是否是namespaced。

```

## 1.4：RBAC简介

![](assets/images/rbac01.png)

![rbac02](assets/images/rbac02.png)

```sh
## RBAC简介：
RBAC API声明了四种kubernetes对象：Role、ClusterRole、RoleBinding和ClusterRoleBinding。

Role：定义一组规则，用于访问命名空间中的Kubernetes资源。
RoleBinding：定义用户和角色（Role）的绑定关系。

ClusterRole：定义了一组访问集群中Kubernetes资源（包括所有命名空间）的规则。
ClusterRoleBinding：定义了用户和集群角色（ClusterRole）的绑定关系。

serviceaccount。
先创建Role，它是针对namespace级别的，只对一个namespace内的资源生效。
ClusterRole，它是针对集群级别的。不常用。除非就想创建一个超级管理员一样。
```

![](assets/images/rbac03.png)

## 1.5：RBAC示例

### 1.5.1：基于token登录

```sh
[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# ll
total 32
drwxr-xr-x 2 root root  190 Jul 10 13:03 ./
drwxr-xr-x 6 root root   92 Jul 10 13:03 ../
-rw-r--r-- 1 root root  268 Jul 10 13:03 magedu-role-bind.yaml
-rw-r--r-- 1 root root  506 Jul 10 13:03 magedu-role.yaml
-rw-r--r-- 1 root root  218 Jul 10 13:03 magedu-user-csr.json
-rw-r--r-- 1 root root 1675 Jul 10 13:03 magedu-user-key.pem
-rw-r--r-- 1 root root  993 Jul 10 13:03 magedu-user.csr
-rw-r--r-- 1 root root 7111 Jul 10 13:03 magedu-user.kubeconfig
-rw-r--r-- 1 root root 1383 Jul 10 13:03 magedu-user.pem

[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# mv magedu-user* /tmp/
[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# ll
total 8
drwxr-xr-x 2 root root  59 Jul 13 13:24 ./
drwxr-xr-x 6 root root  92 Jul 10 13:03 ../
-rw-r--r-- 1 root root 268 Jul 10 13:03 magedu-role-bind.yaml
-rw-r--r-- 1 root root 506 Jul 13 13:23 magedu-role.yaml


[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# kubectl get pod -n magedu
NAME                                         READY   STATUS    RESTARTS      AGE
deploy-devops-redis-75d6c9ff6-vn4t6          1/1     Running   1 (42m ago)   38h
magedu-jenkins-deployment-67d564f976-jmlv8   1/1     Running   1 (42m ago)   38h
python-nginx-deployment-5f9bcc696-wbk4n      1/1     Running   1 (42m ago)   39h
wordpress-app-deployment-558b444569-6nn6n    2/2     Running   2 (42m ago)   38h

## 目标，通过magedu账号来管理magedu的namespace中的pod

# 第一步：创建magedu-user账户
[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# kubectl create serviceaccount magedu-user -n magedu
serviceaccount/magedu-user created

[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# kubectl get sa -n magedu
NAME          SECRETS   AGE
default       1         7d18h
magedu-user   1         11s

[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# kubectl describe sa -n magedu magedu-user 
Name:                magedu-user
Namespace:           magedu
Labels:              <none>
Annotations:         <none>
Image pull secrets:  <none>
Mountable secrets:   magedu-user-token-4c7fk
Tokens:              magedu-user-token-4c7fk
Events:              <none>

# 第二步：创建role规则
[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# vim magedu-role.yaml 
kind: Role
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  namespace: magedu
  name: magedu-role
rules:
- apiGroups: ["*"]
  resources: ["pods/exec"]
  #verbs: ["*"]
  ##RO-Role
  verbs: ["get", "list", "watch", "create"]

- apiGroups: ["*"]
  resources: ["pods"]
  #verbs: ["*"]
  ##RO-Role
  verbs: ["get", "list", "watch"]

- apiGroups: ["apps/v1"]
  resources: ["deployments"]
  #verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
  ##RO-Role
  verbs: ["get", "watch", "list"]

PS：
这个账号相当于于是给开发做排错使用的。一般不需要授予删除权限。

[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# kubectl apply -f magedu-role.yaml 
role.rbac.authorization.k8s.io/magedu-role created

[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# kubectl get role -n magedu
NAME          CREATED AT
magedu-role   2024-07-13T17:26:53Z

[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# kubectl describe role -n magedu magedu-role 
Name:         magedu-role
Labels:       <none>
Annotations:  <none>
PolicyRule:
  Resources            Non-Resource URLs  Resource Names  Verbs
  ---------            -----------------  --------------  -----
  pods.*/exec          []                 []              [get list watch create]
  pods.*               []                 []              [get list watch]
  deployments.apps/v1  []                 []              [get watch list]

# 第三步：绑定role和用户
[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# vim magedu-role-bind.yaml 
kind: RoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: role-bind-magedu
  namespace: magedu
subjects:
- kind: ServiceAccount
  name: magedu-user 
  namespace: magedu
roleRef:
  kind: Role
  name: magedu-role
  apiGroup: rbac.authorization.k8s.io

PS：
保证同一个namespace都有这个role和用户

[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# kubectl apply -f magedu-role-bind.yaml 
rolebinding.rbac.authorization.k8s.io/role-bind-magedu created

[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# kubectl get rolebindings -n magedu
NAME               ROLE               AGE
role-bind-magedu   Role/magedu-role   11s

[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# kubectl describe rolebindings -n magedu role-bind-magedu 
Name:         role-bind-magedu
Labels:       <none>
Annotations:  <none>
Role:
  Kind:  Role
  Name:  magedu-role
Subjects:
  Kind            Name         Namespace
  ----            ----         ---------
  ServiceAccount  magedu-user  magedu

PS：
查看是否写的正确。
一个账号是可以绑定多个role的。

# 第四步：检查token
[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# kubectl get secrets -n magedu
NAME                      TYPE                                  DATA   AGE
default-token-tkcwm       kubernetes.io/service-account-token   3      7d18h
magedu-user-token-4c7fk   kubernetes.io/service-account-token   3      13m

PS：
magedu-user-token-4c7fk

[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# kubectl describe secrets -n magedu magedu-user-token-4c7fk 
Name:         magedu-user-token-4c7fk
Namespace:    magedu
Labels:       <none>
Annotations:  kubernetes.io/service-account.name: magedu-user
              kubernetes.io/service-account.uid: e777fc7c-9fb5-493c-bc21-4d3e6d8c4c96

Type:  kubernetes.io/service-account-token

Data
====
ca.crt:     1302 bytes
namespace:  6 bytes
token:      eyJhbGciOiJSUzI1NiIsImtpZCI6InVHeWpKMFVtTHZZWndyOHNMTURFNUFCeEQ4Zl9EbjdYdnhscXdKclVGaDgifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJtYWdlZHUiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlY3JldC5uYW1lIjoibWFnZWR1LXVzZXItdG9rZW4tNGM3ZmsiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoibWFnZWR1LXVzZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiJlNzc3ZmM3Yy05ZmI1LTQ5M2MtYmMyMS00ZDNlNmQ4YzRjOTYiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6bWFnZWR1Om1hZ2VkdS11c2VyIn0.KKVUkTrHXTanbO9swuVIgOdDCZ-jg6LHh0e1_KEu1zKIrxhOgd5UR7676kFDz1M4v6SO20qq6A4RfWWU1QdYGsVEys51IgFGof800VmE-14nHCzpV6miT13HPq5PNLQ2tWubH08Qf7MVgv-o5Hd7WZAxiNtSV2xffEag6fX3s8pC4icHV3bohb7owpZW4WY2LP1M6y1ycq_2xuHwhudUY0veo-Zsk3D1I62qlZJS_lC6THWfqwSD5NH34cERzWVII-CMxx7htJsIbrZ2T1rhbhpGmwALgUkDLCZo23Bxi8sDn56IQAK0RHIs5aAx63dH8FsilyhycmqfZMLeh6Udgw

PS：
默认就是base64加密。

PS：
如果需要base64加密，可以看如下操作：
[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# kubectl get secrets -n magedu magedu-user-token-4c7fk -o jsonpath={.data.token} | base64 -d
eyJhbGciOiJSUzI1NiIsImtpZCI6InVHeWpKMFVtTHZZWndyOHNMTURFNUFCeEQ4Zl9EbjdYdnhscXdKclVGaDgifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJtYWdlZHUiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlY3JldC5uYW1lIjoibWFnZWR1LXVzZXItdG9rZW4tNGM3ZmsiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoibWFnZWR1LXVzZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiJlNzc3ZmM3Yy05ZmI1LTQ5M2MtYmMyMS00ZDNlNmQ4YzRjOTYiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6bWFnZWR1Om1hZ2VkdS11c2VyIn0.KKVUkTrHXTanbO9swuVIgOdDCZ-jg6LHh0e1_KEu1zKIrxhOgd5UR7676kFDz1M4v6SO20qq6A4RfWWU1QdYGsVEys51IgFGof800VmE-14nHCzpV6miT13HPq5PNLQ2tWubH08Qf7MVgv-o5Hd7WZAxiNtSV2xffEag6fX3s8pC4icHV3bohb7owpZW4WY2LP1M6y1ycq_2xuHwhudUY0veo-Zsk3D1I62qlZJS_lC6THWfqwSD5NH34cERzWVII-CMxx7htJsIbrZ2T1rhbhpGmwALgUkDLCZo23Bxi8sDn56IQAK0RHIs5aAx63dH8FsilyhycmqfZMLeh6Udgw


# 通过dashboard登录测试

[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# kubectl get svc -A
NAMESPACE              NAME                          TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                      AGE
default                kubernetes                    ClusterIP   10.100.0.1       <none>        443/TCP                      16d
kube-system            kube-dns                      ClusterIP   10.100.0.2       <none>        53/UDP,53/TCP,9153/TCP       16d
kube-system            metrics-server                ClusterIP   10.100.9.152     <none>        443/TCP                      4d4h
kubernetes-dashboard   dashboard-metrics-scraper     ClusterIP   10.100.194.39    <none>        8000/TCP                     15d
kubernetes-dashboard   kubernetes-dashboard          NodePort    10.100.44.84     <none>        443:30004/TCP                15d
linux66                linux66-nginx-service         NodePort    10.100.155.174   <none>        80:30006/TCP,443:30443/TCP   14d
linux66                linux66-tomcat-app1-service   ClusterIP   10.100.105.10    <none>        80/TCP                       14d
magedu                 magedu-jenkins-service        NodePort    10.100.128.111   <none>        80:38080/TCP                 5d16h
magedu                 python-nginx-service          NodePort    10.100.47.64     <none>        80:30014/TCP,443:30453/TCP   39h
magedu                 srv-devops-redis              NodePort    10.100.241.19    <none>        6379:36379/TCP               6d22h
magedu                 wordpress-app-spec            NodePort    10.100.169.159   <none>        80:30031/TCP,443:30033/TCP   5d2h

PS：
dashboard的地址是172.31.8.111:30004
thisisunsafe
登录后default里什么都看不到！！！只能看到magedu的namespace中的资源。
一般给开发这个权限就可以了，不能让他们删除。
```

![](assets/images/token_login_01.png)

![token_login_02](assets/images/token_login_02.png)

![token_login_03](assets/images/token_login_03.png)

```sh
# 
[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# vim magedu-role.yaml 
kind: Role
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  namespace: magedu
  name: magedu-role
rules:
#- apiGroups: ["*"]
#  resources: ["pods/exec"]
#  #verbs: ["*"]
#  ##RO-Role
#  verbs: ["get", "list", "watch", "create"]

- apiGroups: ["*"]
  resources: ["pods"]
  #verbs: ["*"]
  ##RO-Role
  verbs: ["get", "list", "watch"]

- apiGroups: ["apps/v1"]
  resources: ["deployments"]
  #verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
  ##RO-Role
  verbs: ["get", "watch", "list"]

PS：
不让他执行pod里的exec这个命令。

[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# kubectl apply -f magedu-role.yaml 
role.rbac.authorization.k8s.io/magedu-role configured

查看dashboard
报错！！！
```

![](assets/images/token_pod_exec_01.png)

![token_pod_exec_02](assets/images/token_pod_exec_02.png)

### 1.5.2：基于kube-config文件登录

#### 1.5.2.1：普通用户使用kube-config文件登录

```sh
## 场景：代码部署时，让开发升级测试环境中的自己namespace的job，此时必须给开发kubeconfig文件才可以。

# 第一步：创建csr文件。这是给开发账户申请证书使用的。
[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# vim magedu-user-csr.json 
{
  "CN": "China",
  "hosts": [],
  "key": {
    "algo": "rsa",
    "size": 2048
  },
  "names": [
    {
      "C": "CN",
      "ST": "BeiJing",
      "L": "BeiJing",
      "O": "k8s",
      "OU": "System"
    }
  ]
}

PS：
  "hosts": [],
hosts为空，就是所有的host
管理员账号有证书，普通用户也有证书。

# 第二步：签发证书
[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# ls /etc/kubeasz/bin/cfssl
/etc/kubeasz/bin/cfssl

[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# ll /etc/kubeasz/clusters/k8s-cluster1/ssl/
total 248
drwxr-xr-x 2 root root 4096 Jun 28 20:51 ./
drwxr-xr-x 5 root root  203 Jun 28 20:49 ../
-rw-r--r-- 1 root root  281 Jun 27 11:15 172.31.8.101-kubelet-csr.json
-rw------- 1 root root 1675 Jun 27 11:15 172.31.8.101-kubelet-key.pem
-rw-r--r-- 1 root root 1082 Jun 27 11:15 172.31.8.101-kubelet.csr
-rw-r--r-- 1 root root 1448 Jun 27 11:15 172.31.8.101-kubelet.pem
-rw-r--r-- 1 root root  281 Jun 27 11:15 172.31.8.102-kubelet-csr.json
-rw------- 1 root root 1679 Jun 27 11:15 172.31.8.102-kubelet-key.pem
-rw-r--r-- 1 root root 1082 Jun 27 11:15 172.31.8.102-kubelet.csr
-rw-r--r-- 1 root root 1448 Jun 27 11:15 172.31.8.102-kubelet.pem
-rw-r--r-- 1 root root  281 Jun 28 20:51 172.31.8.103-kubelet-csr.json
-rw------- 1 root root 1679 Jun 28 20:51 172.31.8.103-kubelet-key.pem
-rw-r--r-- 1 root root 1082 Jun 28 20:51 172.31.8.103-kubelet.csr
-rw-r--r-- 1 root root 1448 Jun 28 20:51 172.31.8.103-kubelet.pem
-rw-r--r-- 1 root root  281 Jun 27 11:16 172.31.8.111-kubelet-csr.json
-rw------- 1 root root 1675 Jun 27 11:16 172.31.8.111-kubelet-key.pem
-rw-r--r-- 1 root root 1082 Jun 27 11:16 172.31.8.111-kubelet.csr
-rw-r--r-- 1 root root 1448 Jun 27 11:16 172.31.8.111-kubelet.pem
-rw-r--r-- 1 root root  281 Jun 27 11:16 172.31.8.112-kubelet-csr.json
-rw------- 1 root root 1675 Jun 27 11:16 172.31.8.112-kubelet-key.pem
-rw-r--r-- 1 root root 1082 Jun 27 11:16 172.31.8.112-kubelet.csr
-rw-r--r-- 1 root root 1448 Jun 27 11:16 172.31.8.112-kubelet.pem
-rw-r--r-- 1 root root  281 Jun 28 20:38 172.31.8.113-kubelet-csr.json
-rw------- 1 root root 1675 Jun 28 20:38 172.31.8.113-kubelet-key.pem
-rw-r--r-- 1 root root 1082 Jun 28 20:38 172.31.8.113-kubelet.csr
-rw-r--r-- 1 root root 1448 Jun 28 20:38 172.31.8.113-kubelet.pem
-rw-r--r-- 1 root root  225 Jun 27 11:07 admin-csr.json
-rw------- 1 root root 1679 Jun 27 11:10 admin-key.pem
-rw-r--r-- 1 root root 1005 Jun 27 11:10 admin.csr
-rw-r--r-- 1 root root 1391 Jun 27 11:10 admin.pem
-rw-r--r-- 1 root root  219 Jun 27 11:14 aggregator-proxy-csr.json
-rw------- 1 root root 1675 Jun 28 20:50 aggregator-proxy-key.pem
-rw-r--r-- 1 root root  997 Jun 28 20:50 aggregator-proxy.csr
-rw-r--r-- 1 root root 1383 Jun 28 20:50 aggregator-proxy.pem
-rw-r--r-- 1 root root  483 Jun 27 11:07 ca-config.json
-rw-r--r-- 1 root root  243 Jun 27 11:07 ca-csr.json
-rw------- 1 root root 1679 Jun 27 11:07 ca-key.pem
-rw-r--r-- 1 root root 1041 Jun 27 11:07 ca.csr
-rw-r--r-- 1 root root 1302 Jun 27 11:07 ca.pem
-rw-r--r-- 1 root root  215 Jun 27 11:17 calico-csr.json
-rw------- 1 root root 1675 Jun 28 20:51 calico-key.pem
-rw-r--r-- 1 root root  989 Jun 28 20:51 calico.csr
-rw-r--r-- 1 root root 1379 Jun 28 20:51 calico.pem
-rw-r--r-- 1 root root  292 Jun 27 11:11 etcd-csr.json
-rw------- 1 root root 1679 Jun 27 11:11 etcd-key.pem
-rw-r--r-- 1 root root 1058 Jun 27 11:11 etcd.csr
-rw-r--r-- 1 root root 1428 Jun 27 11:11 etcd.pem
-rw-r--r-- 1 root root  266 Jun 27 11:07 kube-controller-manager-csr.json
-rw------- 1 root root 1679 Jun 27 11:10 kube-controller-manager-key.pem
-rw-r--r-- 1 root root 1062 Jun 27 11:10 kube-controller-manager.csr
-rw-r--r-- 1 root root 1448 Jun 27 11:10 kube-controller-manager.pem
-rw-r--r-- 1 root root  226 Jun 27 11:07 kube-proxy-csr.json
-rw------- 1 root root 1675 Jun 27 11:10 kube-proxy-key.pem
-rw-r--r-- 1 root root 1005 Jun 27 11:10 kube-proxy.csr
-rw-r--r-- 1 root root 1395 Jun 27 11:10 kube-proxy.pem
-rw-r--r-- 1 root root  248 Jun 27 11:07 kube-scheduler-csr.json
-rw------- 1 root root 1675 Jun 27 11:10 kube-scheduler-key.pem
-rw-r--r-- 1 root root 1033 Jun 27 11:10 kube-scheduler.csr
-rw-r--r-- 1 root root 1424 Jun 27 11:10 kube-scheduler.pem
-rw-r--r-- 1 root root  531 Jun 28 20:50 kubernetes-csr.json
-rw------- 1 root root 1675 Jun 28 20:50 kubernetes-key.pem
-rw-r--r-- 1 root root 1289 Jun 28 20:50 kubernetes.csr
-rw-r--r-- 1 root root 1610 Jun 28 20:50 kubernetes.pem

[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# cat /etc/kubeasz/clusters/k8s-cluster1/ssl/ca-config.json 
{
  "signing": {
    "default": {
      "expiry": "438000h"
    },
    "profiles": {
      "kubernetes": {
        "usages": [
            "signing",
            "key encipherment",
            "server auth",
            "client auth"
        ],
        "expiry": "438000h"
      }
    },
    "profiles": {
      "kcfg": {
        "usages": [
            "signing",
            "key encipherment",
            "client auth"
        ],
        "expiry": "438000h"
      }
    }
  }
}

PS：
这里的文件不需要动。它指定了证书的过期时间等。

PS：
要和k8s指定同一个CA来签发证书。

[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# cfssl gencert -ca=/etc/kubernetes/ssl/ca.pem -ca-key=/etc/kubernetes/ssl/ca-key.pem -config=/etc/kubeasz/clusters/k8s-cluster1/ssl/ca-config.json -profile=kubernetes magedu-user-csr.json | cfssljson -bare magedu-user
2024/07/13 14:36:42 [INFO] generate received request
2024/07/13 14:36:42 [INFO] received CSR
2024/07/13 14:36:42 [INFO] generating key: rsa-2048
2024/07/13 14:36:42 [INFO] encoded CSR
2024/07/13 14:36:42 [INFO] signed certificate with serial number 372581535377506966577321768826907438875480282504
2024/07/13 14:36:42 [WARNING] This certificate lacks a "hosts" field. This makes it unsuitable for
websites. For more information see the Baseline Requirements for the Issuance and Management
of Publicly-Trusted Certificates, v.1.1.6, from the CA/Browser Forum (https://cabforum.org);
specifically, section 10.2.3 ("Information Requirements").

[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# ll
total 24
drwxr-xr-x 2 root root  160 Jul 13 14:36 ./
drwxr-xr-x 6 root root   92 Jul 10 13:03 ../
-rw-r--r-- 1 root root  268 Jul 13 13:28 magedu-role-bind.yaml
-rw-r--r-- 1 root root  506 Jul 13 14:18 magedu-role.yaml
-rw-r--r-- 1 root root  218 Jul 13 14:23 magedu-user-csr.json
-rw------- 1 root root 1675 Jul 13 14:36 magedu-user-key.pem
-rw-r--r-- 1 root root  993 Jul 13 14:36 magedu-user.csr
-rw-r--r-- 1 root root 1383 Jul 13 14:36 magedu-user.pem

PS：
签发证书成功。
这意味着kubeconfig文件中的公钥和私钥有了，但是和kubeconfig文件还没有！
需要把证书放到这个文件里，还需要加密的方式。base64。


# 第三步：制作kubeconfig文件

`1. 生成普通用户kubeconfig文件。设置集群
[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# kubectl config set-cluster cluster1 --certificate-authority=/etc/kubernetes/ssl/ca.pem --embed-certs=true --server=https://172.31.8.188:6443 --kubeconfig=./magedu-user.kubeconfig
Cluster "cluster1" set.

PS：
--embed-certs=true
将证书以base64嵌入到文件中。
cluster1要和当前admin的kubeconfig文件中的cluster设置一样。

[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# ll
total 28
drwxr-xr-x 2 root root  190 Jul 13 14:45 ./
drwxr-xr-x 6 root root   92 Jul 10 13:03 ../
-rw-r--r-- 1 root root  268 Jul 13 13:28 magedu-role-bind.yaml
-rw-r--r-- 1 root root  506 Jul 13 14:18 magedu-role.yaml
-rw-r--r-- 1 root root  218 Jul 13 14:23 magedu-user-csr.json
-rw------- 1 root root 1675 Jul 13 14:36 magedu-user-key.pem
-rw-r--r-- 1 root root  993 Jul 13 14:36 magedu-user.csr
-rw------- 1 root root 1936 Jul 13 14:45 magedu-user.kubeconfig
-rw-r--r-- 1 root root 1383 Jul 13 14:36 magedu-user.pem

[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# vim magedu-user.kubeconfig 
apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURsRENDQW55Z0F3SUJBZ0lVYUJEM3VmVDMxd3k3M0I5L3ZZTCs3MWxYNktRd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1lURUxNQWtHQTFVRUJoTUNRMDR4RVRBUEJnTlZCQWdUQ0VoaGJtZGFhRzkxTVFzd0NRWURWUVFIRXdKWQpVekVNTUFvR0ExVUVDaE1EYXpoek1ROHdEUVlEVlFRTEV3WlRlWE4wWlcweEV6QVJCZ05WQkFNVENtdDFZbVZ5CmJtVjBaWE13SUJjTk1qUXdOakkzTVRVd01qQXdXaGdQTWpFeU5EQTJNRE14TlRBeU1EQmFNR0V4Q3pBSkJnTlYKQkFZVEFrTk9NUkV3RHdZRFZRUUlFd2hJWVc1bldtaHZkVEVMTUFrR0ExVUVCeE1DV0ZNeEREQUtCZ05WQkFvVApBMnM0Y3pFUE1BMEdBMVVFQ3hNR1UzbHpkR1Z0TVJNd0VRWURWUVFERXdwcmRXSmxjbTVsZEdWek1JSUJJakFOCkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXhvcnR2U1BZUEFQKzFTbnc1bVp3YlRrKy9DWW8KbmFiNE9LM1lnK3B3cnRydlFicnlWTC9nQ0ZxdXNIV1pQU3pqNDc2ZmdZOU12ZDZmZmZXUzNmaTJYWmNweUNFRwpoYlBWMlRrdXFMdlZ0YmNHUzNvS09TMWlORkVjV3RuNjgyRm8xSXdYOHQ3cUFEOW1mcnRvT3NyeDBlOG9LR3dMCjdEOEZ6cWxYczRWY3lSeWpZdVNoYU10dENrbFkwZzhTV2pDOW5NV3NsRHBpVk9zMnJqcFZUUVJ6OVZRekZWWHQKQkxXT01BdEpHVGVqODhIZEJIS3lPc21FM2crMVZmQ2ZTRHlnQXdlaHlPeko5bE96QzhCMmtrTFh6L3pOSlhnNApBbU5JZmtyOVY0UzZOZEphSWZBbjBkdmRDajBHck16bmpRbUMxc0xqU3ZtQThlb2UzRGZhNmRXTSt3SURBUUFCCm8wSXdRREFPQmdOVkhROEJBZjhFQkFNQ0FRWXdEd1lEVlIwVEFRSC9CQVV3QXdFQi96QWRCZ05WSFE0RUZnUVUKZmozdm52VUJlSS9sMVBQZkwvd243dnM0Y2FBd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFLSW1GajJRVGd3ZgpkbXlCRWlpZm5WM0tuSGVPaTdrbVBSSGtwR3dDbThYQVV0K2ordUo0Y1VZSFcrMTY4V3NhNjBJcEtockJob1ZLCkF1aVppMVkzVW5BNHBac2hvM3pzektFR3Npd0prRTUwYjVQb0ljVk1BdzlUTzFaR3A2K2xXWXdLV0lmWmxjL1oKQkorOTViL25hb2YxWGxxSklqU3ZxZG0yanQ3SnhGUGlEN2d0NHE1NzFPNVI1eldLZmJjeGF6cGgyQXk0VGVhQgp6VWxLYzU0Z0FvdFlldk8va3VqZXFVRnkybXRrNVljZWsyTDJmOFlyUFpGeU5GWkVXSTVJTjJ0YXJvU1lIVGIxCi96QW1TTzJUcSt2VWxJQnVDdTFOUlR4cHowZkZRVElnaVkzKzh0cWdoQzczU1NvWmErNGgzN1pNWVBnbm8wanEKNGpGcHlocmkzOFU9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    server: https://172.31.8.188:6443
  name: cluster1
contexts: null
current-context: ""
kind: Config
preferences: {}
users: null

PS：
目前只是把CA的公钥嵌入进来了。而且加密了。
server地址：https://172.31.8.188:6443
集权名字：cluster1
后面的字段是空，需要继续做！！！

`2. 设置客户端认证参数
[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# ll
total 28
drwxr-xr-x 2 root root  190 Jul 13 14:47 ./
drwxr-xr-x 6 root root   92 Jul 10 13:03 ../
-rw-r--r-- 1 root root  268 Jul 13 13:28 magedu-role-bind.yaml
-rw-r--r-- 1 root root  506 Jul 13 14:18 magedu-role.yaml
-rw-r--r-- 1 root root  218 Jul 13 14:23 magedu-user-csr.json
-rw------- 1 root root 1675 Jul 13 14:36 magedu-user-key.pem
-rw-r--r-- 1 root root  993 Jul 13 14:36 magedu-user.csr
-rw------- 1 root root 1936 Jul 13 14:47 magedu-user.kubeconfig
-rw-r--r-- 1 root root 1383 Jul 13 14:36 magedu-user.pem

[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# cp *.pem /etc/kubernetes/ssl/

[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# ll /etc/kubernetes/ssl/
total 48
drwxr-xr-x 2 root root  280 Jul 13 14:52 ./
drwxr-xr-x 3 root root  147 Jun 27 11:15 ../
-rw-r--r-- 1 root root 1679 Jun 27 11:14 aggregator-proxy-key.pem
-rw-r--r-- 1 root root 1383 Jun 27 11:14 aggregator-proxy.pem
-rw------- 1 root root 1679 Jun 28 13:18 awsuser-key.pem
-rw-r--r-- 1 root root 1387 Jun 28 13:18 awsuser.pem
-rw-r--r-- 1 root root 1679 Jun 27 11:14 ca-key.pem
-rw-r--r-- 1 root root 1302 Jun 27 11:14 ca.pem
-rw-r--r-- 1 root root 1675 Jun 27 11:15 kubelet-key.pem
-rw-r--r-- 1 root root 1448 Jun 27 11:15 kubelet.pem
-rw-r--r-- 1 root root 1675 Jun 27 11:14 kubernetes-key.pem
-rw-r--r-- 1 root root 1602 Jun 27 11:14 kubernetes.pem
-rw------- 1 root root 1675 Jul 13 14:52 magedu-user-key.pem
-rw-r--r-- 1 root root 1383 Jul 13 14:52 magedu-user.pem

PS：
拷贝用户证书和私钥到/etc/kubernetes/ssl/目录下，这样更规范一些。

PS：命令
kubectl config set-credentials magedu-user \
--client-certificate=/etc/kubernetes/ssl/magedu-user.pem \
--client-key=/etc/kubernetes/ssl/magedu-user-key.pem \
--embed-certs=true \
--kubeconfig=./magedu-user.kubeconfig

[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# kubectl config set-credentials magedu-user \
> --client-certificate=/etc/kubernetes/ssl/magedu-user.pem \
> --client-key=/etc/kubernetes/ssl/magedu-user-key.pem \
> --embed-certs=true \
> --kubeconfig=./magedu-user.kubeconfig
User "magedu-user" set.

[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# cat magedu-user.kubeconfig 
apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURsRENDQW55Z0F3SUJBZ0lVYUJEM3VmVDMxd3k3M0I5L3ZZTCs3MWxYNktRd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1lURUxNQWtHQTFVRUJoTUNRMDR4RVRBUEJnTlZCQWdUQ0VoaGJtZGFhRzkxTVFzd0NRWURWUVFIRXdKWQpVekVNTUFvR0ExVUVDaE1EYXpoek1ROHdEUVlEVlFRTEV3WlRlWE4wWlcweEV6QVJCZ05WQkFNVENtdDFZbVZ5CmJtVjBaWE13SUJjTk1qUXdOakkzTVRVd01qQXdXaGdQTWpFeU5EQTJNRE14TlRBeU1EQmFNR0V4Q3pBSkJnTlYKQkFZVEFrTk9NUkV3RHdZRFZRUUlFd2hJWVc1bldtaHZkVEVMTUFrR0ExVUVCeE1DV0ZNeEREQUtCZ05WQkFvVApBMnM0Y3pFUE1BMEdBMVVFQ3hNR1UzbHpkR1Z0TVJNd0VRWURWUVFERXdwcmRXSmxjbTVsZEdWek1JSUJJakFOCkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXhvcnR2U1BZUEFQKzFTbnc1bVp3YlRrKy9DWW8KbmFiNE9LM1lnK3B3cnRydlFicnlWTC9nQ0ZxdXNIV1pQU3pqNDc2ZmdZOU12ZDZmZmZXUzNmaTJYWmNweUNFRwpoYlBWMlRrdXFMdlZ0YmNHUzNvS09TMWlORkVjV3RuNjgyRm8xSXdYOHQ3cUFEOW1mcnRvT3NyeDBlOG9LR3dMCjdEOEZ6cWxYczRWY3lSeWpZdVNoYU10dENrbFkwZzhTV2pDOW5NV3NsRHBpVk9zMnJqcFZUUVJ6OVZRekZWWHQKQkxXT01BdEpHVGVqODhIZEJIS3lPc21FM2crMVZmQ2ZTRHlnQXdlaHlPeko5bE96QzhCMmtrTFh6L3pOSlhnNApBbU5JZmtyOVY0UzZOZEphSWZBbjBkdmRDajBHck16bmpRbUMxc0xqU3ZtQThlb2UzRGZhNmRXTSt3SURBUUFCCm8wSXdRREFPQmdOVkhROEJBZjhFQkFNQ0FRWXdEd1lEVlIwVEFRSC9CQVV3QXdFQi96QWRCZ05WSFE0RUZnUVUKZmozdm52VUJlSS9sMVBQZkwvd243dnM0Y2FBd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFLSW1GajJRVGd3ZgpkbXlCRWlpZm5WM0tuSGVPaTdrbVBSSGtwR3dDbThYQVV0K2ordUo0Y1VZSFcrMTY4V3NhNjBJcEtockJob1ZLCkF1aVppMVkzVW5BNHBac2hvM3pzektFR3Npd0prRTUwYjVQb0ljVk1BdzlUTzFaR3A2K2xXWXdLV0lmWmxjL1oKQkorOTViL25hb2YxWGxxSklqU3ZxZG0yanQ3SnhGUGlEN2d0NHE1NzFPNVI1eldLZmJjeGF6cGgyQXk0VGVhQgp6VWxLYzU0Z0FvdFlldk8va3VqZXFVRnkybXRrNVljZWsyTDJmOFlyUFpGeU5GWkVXSTVJTjJ0YXJvU1lIVGIxCi96QW1TTzJUcSt2VWxJQnVDdTFOUlR4cHowZkZRVElnaVkzKzh0cWdoQzczU1NvWmErNGgzN1pNWVBnbm8wanEKNGpGcHlocmkzOFU9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    server: https://172.31.8.188:6443
  name: cluster1
contexts: null
current-context: ""
kind: Config
preferences: {}
users:
- name: magedu-user
  user:
    client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUQwRENDQXJpZ0F3SUJBZ0lVUVVNaVJTUnpTMEdFZnI1L3drNWJIcllKMVlnd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1lURUxNQWtHQTFVRUJoTUNRMDR4RVRBUEJnTlZCQWdUQ0VoaGJtZGFhRzkxTVFzd0NRWURWUVFIRXdKWQpVekVNTUFvR0ExVUVDaE1EYXpoek1ROHdEUVlEVlFRTEV3WlRlWE4wWlcweEV6QVJCZ05WQkFNVENtdDFZbVZ5CmJtVjBaWE13SUJjTk1qUXdOekV6TVRnek1qQXdXaGdQTWpBM05EQTNNREV4T0RNeU1EQmFNR0F4Q3pBSkJnTlYKQkFZVEFrTk9NUkF3RGdZRFZRUUlFd2RDWldsS2FXNW5NUkF3RGdZRFZRUUhFd2RDWldsS2FXNW5NUXd3Q2dZRApWUVFLRXdOck9ITXhEekFOQmdOVkJBc1RCbE41YzNSbGJURU9NQXdHQTFVRUF4TUZRMmhwYm1Fd2dnRWlNQTBHCkNTcUdTSWIzRFFFQkFRVUFBNElCRHdBd2dnRUtBb0lCQVFDMVRJOGZZREhlOUpNb244elh6NGJCUVRlK3luVzQKUjY4V25SMW5DM2c2cmpHRGl6K0pwTk9PN0UvVTY5NC9MZHRWTnhnaEhWUlIwYnhGTm90b0dLbk5idldBT1hKbwpiWGZ5ZFgzeFpXeXNoNEJidDJSa1cwWlEzaFpKRFRBMEtkS1V4RzJZdzhxeXp5a2JIdGRYSFNTdXdnVU8wMTFJClpBT3VPR2FDVjhHVC9YUlMrZlczN1dpenR0bWxVam9JWXVESVBYcUtkNER1bEVzVmluRElzWWl0cTgxWnNHTkYKWWU4d3pIbVU0ZlN2S1V6V1FhbWJmd2hJOWVONTMzSkxaeGNqdi96N0pjRUtHU2phZjlrZ1pjY1prS2ZJY2RrNQpMRkZqRTFxb05CMmlzWVFUSkNTaWQzdTI0NS85K0Y0ZmVsTzRMdVg1Skw0b1pmakJDNHJ0SkpQUkFnTUJBQUdqCmZ6QjlNQTRHQTFVZER3RUIvd1FFQXdJRm9EQWRCZ05WSFNVRUZqQVVCZ2dyQmdFRkJRY0RBUVlJS3dZQkJRVUgKQXdJd0RBWURWUjBUQVFIL0JBSXdBREFkQmdOVkhRNEVGZ1FVQkRsVDJFeXBYUVdrRDdsamt1KytsOXBZM2F3dwpId1lEVlIwakJCZ3dGb0FVZmozdm52VUJlSS9sMVBQZkwvd243dnM0Y2FBd0RRWUpLb1pJaHZjTkFRRUxCUUFECmdnRUJBSkFIY1pscHVLbmloVHBndTZrK1JBOGxXZnN6TzlpdFFPYSt2VUJKdGViakRjL24wYnBQSnpKa29keW8KQ2twOGdZWkRyYkI3M2NvTWI0YmFyYXlsVCs1RTJKM3QyQms5ZkdMOVFkZkxnejJ0NHJvVjhpUGtDcHhENzRvVAo3aWp3Yy8zSk5GbThraDA5bkgyTG4xTjBTdk80WWZWc2djc0JlbVFmUVlHU2lEUlliT0t0TTNPcHdvNnpWRERMCjl3U1ZaSDZpQytCR3htRWFVMFZUL1Z1V2p3YXZjK3k3VENtdk1PUnpEYUVNWm10OURWVXZWYUhFUjBtM3FINTIKam1MY0JYcUE3UjBocE1nRXh4UVlGcG5CWlc1UDZEdE1sZWUvbzlvVEh4cTJzeUtKNjNNeC9YWjBtUUwwQjRRUwpmZVdyL2pPR0lGUDFlOTZPYVlTQVArajFIYk09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    client-key-data: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBdFV5UEgyQXgzdlNUS0ovTTE4K0d3VUUzdnNwMXVFZXZGcDBkWnd0NE9xNHhnNHMvCmlhVFRqdXhQMU92ZVB5M2JWVGNZSVIxVVVkRzhSVGFMYUJpcHpXNzFnRGx5YUcxMzhuVjk4V1ZzckllQVc3ZGsKWkZ0R1VONFdTUTB3TkNuU2xNUnRtTVBLc3M4cEd4N1hWeDBrcnNJRkR0TmRTR1FEcmpobWdsZkJrLzEwVXZuMQp0KzFvczdiWnBWSTZDR0xneUQxNmluZUE3cFJMRllwd3lMR0lyYXZOV2JCalJXSHZNTXg1bE9IMHJ5bE0xa0dwCm0zOElTUFhqZWQ5eVMyY1hJNy84K3lYQkNoa28ybi9aSUdYSEdaQ255SEhaT1N4Ull4TmFxRFFkb3JHRUV5UWsKb25kN3R1T2YvZmhlSDNwVHVDN2wrU1MrS0dYNHdRdUs3U1NUMFFJREFRQUJBb0lCQUJsT2dudml0Wk5sbUZVSApXVlNXaHp6YW1hbHNJVnFEeHhEbEJZR292RE9VdFJ5amgwN3pUd1NZUDl4OHdCMFpqWkFyakpheXZWNWVaR1ZVCjQ4aTRDSnZBYlV4a3VHK1RPRGNENTN5V3A4QzllVkZVSEJOV0drNlhjWXpvNWwyaHFOOVRPK2tqQzF4Q1JuNmUKbzNocGZRRlgyOVRoOUJkeXZvREhKcWZ6RC9aVUltRDZXQkFoREZ1cDVkc3V6VktRaFRMdXZkNkhtQk9LVW5XMgptTDdIbjFMM3UyMUNPM05lUlZjWHJrZ3VKV3FVODVDOTZTNFcvMG4xdWRZdWF5Y1dXWGp3TjNFczhqelRpNmNzCktsZno2WTFqTVZyUkRLY29ZeU9lSzlaN0I5TUJHL1Y1MGFTTGhpbzRCdmZBZjdLMGYxQ245aHgxMWEyckM3TmwKbmswZHlYRUNnWUVBeDBxWmZYOVJRM2JaMjNwUW5DOUprcnZvVS9XdHpaSmdadzBUd015Ym5uVmxORFo3eUN2bQpmWTZtQ3RLWU96UDlrODJETHppelplTlB1NjNaM0hMME02Nkw5VFpxYVNsTWxLOWJHby9iL0JJZEdPbCtnNnIxCi95WHhtR2NJRUVTR1J3T1lUZ3FIbkZqOVZJRTZGZU9yVzFTS0FpYndSalpsc283U1crbjE0cmNDZ1lFQTZPTk8KTWRyLzNpTkhTbDNyVTdVZGtLcUFWZ0hHQzdQazYwN1hxd1ZkdURreW16eVJtdzRFTmd0MFRXZlV0S1hBcHFFTQpqbXd4ZFY4ZzJCbXk4RCtjMldkR21ldFcxeG5XVGN2SFBBcnZLbm1iT0JBL1dyTGwvNFJtS3VYQVRlWUl5bm9QCmdEbFJTem11dmF0Uzh5OEt6TkErUnpXYlIyRHBFSjgyajhMdGxiY0NnWUVBdGJmU0NWckVVSTNZeklYVlp2Uy8KVTJxL3gzN25RZUZNd2Vwc3JvcGpBN1ByMmhZci9EUDdjVlZYRmRzOU1BNlNFK2w2eXQ0YXhyYmtoeTlZemVpTAp2MnhTOWY3dVBJR0o4TEdNa3NYR1F5eUpGNlFnMWhKWFNKWGltNkttK1o1aUNmSy9ON25tT2F2ekl0REtsQmNLCnNyWjlPTVVrcGdFSDdpN0lwVUxLRURVQ2dZQUxwdXZQcE1SdWlkZFVTalN2QUgzVk1pS3ZxdkVNdnRoeVNZU1MKNHZiWWM4d3JaakZtejZHNFRvUm9Kd3pHYVJDbGhhTktNUEdjak1Ebzd3Zzc2d0xmQWNMUGlxM1NuMUZRblNSLwp4WkJIME1QS1gwMjhMUDFDOW8zaUVaSzRrd3pYakpuZjhYNDJ4RkVRM2xTTkpFcG5DdmhDdWRUbUVsdzIzN0JzCkt2V1dLd0tCZ0hzM3M0NTNWSmllSHlUd1REUUxjU3p4K25jdTB3QnVoallQazd0dkYxcEFUYlNocVN6Y09tbGMKaVJCOXZFL1VSVkNMVkkzaHJOZElXS3dWVXpkdk84Qi9rL3laZVBVaTJZVTdJaTlYdWpodTBQdFBneDlhZERXeQp2akd6cStaK21TVnRWdFRKS1BkS014QWtmalNMUXJMc3pRcUVoR1ZnMUk5OE9lck8yNzg1Ci0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==

PS：
目前把用户的公钥和私钥放进来了。

`3. 设置上下文参数（多集群使用上下文区分）
https://kuberenetes.io/zh/docs/concepts/configuration/organize-cluster-access-kubeconfig/

PS：命令
kubectl config set-context cluster1 \
--cluster=cluster1 \
--user=magedu-user \
--namespace=magedu \
--kubeconfig=./magedu-user.kubeconfig

[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# kubectl config set-context cluster1 \
> --cluster=cluster1 \
> --user=magedu-user \
> --namespace=magedu \
> --kubeconfig=./magedu-user.kubeconfig
Context "cluster1" created.
[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# cat magedu-user.kubeconfig 
apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURsRENDQW55Z0F3SUJBZ0lVYUJEM3VmVDMxd3k3M0I5L3ZZTCs3MWxYNktRd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1lURUxNQWtHQTFVRUJoTUNRMDR4RVRBUEJnTlZCQWdUQ0VoaGJtZGFhRzkxTVFzd0NRWURWUVFIRXdKWQpVekVNTUFvR0ExVUVDaE1EYXpoek1ROHdEUVlEVlFRTEV3WlRlWE4wWlcweEV6QVJCZ05WQkFNVENtdDFZbVZ5CmJtVjBaWE13SUJjTk1qUXdOakkzTVRVd01qQXdXaGdQTWpFeU5EQTJNRE14TlRBeU1EQmFNR0V4Q3pBSkJnTlYKQkFZVEFrTk9NUkV3RHdZRFZRUUlFd2hJWVc1bldtaHZkVEVMTUFrR0ExVUVCeE1DV0ZNeEREQUtCZ05WQkFvVApBMnM0Y3pFUE1BMEdBMVVFQ3hNR1UzbHpkR1Z0TVJNd0VRWURWUVFERXdwcmRXSmxjbTVsZEdWek1JSUJJakFOCkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXhvcnR2U1BZUEFQKzFTbnc1bVp3YlRrKy9DWW8KbmFiNE9LM1lnK3B3cnRydlFicnlWTC9nQ0ZxdXNIV1pQU3pqNDc2ZmdZOU12ZDZmZmZXUzNmaTJYWmNweUNFRwpoYlBWMlRrdXFMdlZ0YmNHUzNvS09TMWlORkVjV3RuNjgyRm8xSXdYOHQ3cUFEOW1mcnRvT3NyeDBlOG9LR3dMCjdEOEZ6cWxYczRWY3lSeWpZdVNoYU10dENrbFkwZzhTV2pDOW5NV3NsRHBpVk9zMnJqcFZUUVJ6OVZRekZWWHQKQkxXT01BdEpHVGVqODhIZEJIS3lPc21FM2crMVZmQ2ZTRHlnQXdlaHlPeko5bE96QzhCMmtrTFh6L3pOSlhnNApBbU5JZmtyOVY0UzZOZEphSWZBbjBkdmRDajBHck16bmpRbUMxc0xqU3ZtQThlb2UzRGZhNmRXTSt3SURBUUFCCm8wSXdRREFPQmdOVkhROEJBZjhFQkFNQ0FRWXdEd1lEVlIwVEFRSC9CQVV3QXdFQi96QWRCZ05WSFE0RUZnUVUKZmozdm52VUJlSS9sMVBQZkwvd243dnM0Y2FBd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFLSW1GajJRVGd3ZgpkbXlCRWlpZm5WM0tuSGVPaTdrbVBSSGtwR3dDbThYQVV0K2ordUo0Y1VZSFcrMTY4V3NhNjBJcEtockJob1ZLCkF1aVppMVkzVW5BNHBac2hvM3pzektFR3Npd0prRTUwYjVQb0ljVk1BdzlUTzFaR3A2K2xXWXdLV0lmWmxjL1oKQkorOTViL25hb2YxWGxxSklqU3ZxZG0yanQ3SnhGUGlEN2d0NHE1NzFPNVI1eldLZmJjeGF6cGgyQXk0VGVhQgp6VWxLYzU0Z0FvdFlldk8va3VqZXFVRnkybXRrNVljZWsyTDJmOFlyUFpGeU5GWkVXSTVJTjJ0YXJvU1lIVGIxCi96QW1TTzJUcSt2VWxJQnVDdTFOUlR4cHowZkZRVElnaVkzKzh0cWdoQzczU1NvWmErNGgzN1pNWVBnbm8wanEKNGpGcHlocmkzOFU9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    server: https://172.31.8.188:6443
  name: cluster1
contexts:
- context:
    cluster: cluster1
    namespace: magedu
    user: magedu-user
  name: cluster1
current-context: ""
kind: Config
preferences: {}
users:
- name: magedu-user
  user:
    client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUQwRENDQXJpZ0F3SUJBZ0lVUVVNaVJTUnpTMEdFZnI1L3drNWJIcllKMVlnd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1lURUxNQWtHQTFVRUJoTUNRMDR4RVRBUEJnTlZCQWdUQ0VoaGJtZGFhRzkxTVFzd0NRWURWUVFIRXdKWQpVekVNTUFvR0ExVUVDaE1EYXpoek1ROHdEUVlEVlFRTEV3WlRlWE4wWlcweEV6QVJCZ05WQkFNVENtdDFZbVZ5CmJtVjBaWE13SUJjTk1qUXdOekV6TVRnek1qQXdXaGdQTWpBM05EQTNNREV4T0RNeU1EQmFNR0F4Q3pBSkJnTlYKQkFZVEFrTk9NUkF3RGdZRFZRUUlFd2RDWldsS2FXNW5NUkF3RGdZRFZRUUhFd2RDWldsS2FXNW5NUXd3Q2dZRApWUVFLRXdOck9ITXhEekFOQmdOVkJBc1RCbE41YzNSbGJURU9NQXdHQTFVRUF4TUZRMmhwYm1Fd2dnRWlNQTBHCkNTcUdTSWIzRFFFQkFRVUFBNElCRHdBd2dnRUtBb0lCQVFDMVRJOGZZREhlOUpNb244elh6NGJCUVRlK3luVzQKUjY4V25SMW5DM2c2cmpHRGl6K0pwTk9PN0UvVTY5NC9MZHRWTnhnaEhWUlIwYnhGTm90b0dLbk5idldBT1hKbwpiWGZ5ZFgzeFpXeXNoNEJidDJSa1cwWlEzaFpKRFRBMEtkS1V4RzJZdzhxeXp5a2JIdGRYSFNTdXdnVU8wMTFJClpBT3VPR2FDVjhHVC9YUlMrZlczN1dpenR0bWxVam9JWXVESVBYcUtkNER1bEVzVmluRElzWWl0cTgxWnNHTkYKWWU4d3pIbVU0ZlN2S1V6V1FhbWJmd2hJOWVONTMzSkxaeGNqdi96N0pjRUtHU2phZjlrZ1pjY1prS2ZJY2RrNQpMRkZqRTFxb05CMmlzWVFUSkNTaWQzdTI0NS85K0Y0ZmVsTzRMdVg1Skw0b1pmakJDNHJ0SkpQUkFnTUJBQUdqCmZ6QjlNQTRHQTFVZER3RUIvd1FFQXdJRm9EQWRCZ05WSFNVRUZqQVVCZ2dyQmdFRkJRY0RBUVlJS3dZQkJRVUgKQXdJd0RBWURWUjBUQVFIL0JBSXdBREFkQmdOVkhRNEVGZ1FVQkRsVDJFeXBYUVdrRDdsamt1KytsOXBZM2F3dwpId1lEVlIwakJCZ3dGb0FVZmozdm52VUJlSS9sMVBQZkwvd243dnM0Y2FBd0RRWUpLb1pJaHZjTkFRRUxCUUFECmdnRUJBSkFIY1pscHVLbmloVHBndTZrK1JBOGxXZnN6TzlpdFFPYSt2VUJKdGViakRjL24wYnBQSnpKa29keW8KQ2twOGdZWkRyYkI3M2NvTWI0YmFyYXlsVCs1RTJKM3QyQms5ZkdMOVFkZkxnejJ0NHJvVjhpUGtDcHhENzRvVAo3aWp3Yy8zSk5GbThraDA5bkgyTG4xTjBTdk80WWZWc2djc0JlbVFmUVlHU2lEUlliT0t0TTNPcHdvNnpWRERMCjl3U1ZaSDZpQytCR3htRWFVMFZUL1Z1V2p3YXZjK3k3VENtdk1PUnpEYUVNWm10OURWVXZWYUhFUjBtM3FINTIKam1MY0JYcUE3UjBocE1nRXh4UVlGcG5CWlc1UDZEdE1sZWUvbzlvVEh4cTJzeUtKNjNNeC9YWjBtUUwwQjRRUwpmZVdyL2pPR0lGUDFlOTZPYVlTQVArajFIYk09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    client-key-data: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBdFV5UEgyQXgzdlNUS0ovTTE4K0d3VUUzdnNwMXVFZXZGcDBkWnd0NE9xNHhnNHMvCmlhVFRqdXhQMU92ZVB5M2JWVGNZSVIxVVVkRzhSVGFMYUJpcHpXNzFnRGx5YUcxMzhuVjk4V1ZzckllQVc3ZGsKWkZ0R1VONFdTUTB3TkNuU2xNUnRtTVBLc3M4cEd4N1hWeDBrcnNJRkR0TmRTR1FEcmpobWdsZkJrLzEwVXZuMQp0KzFvczdiWnBWSTZDR0xneUQxNmluZUE3cFJMRllwd3lMR0lyYXZOV2JCalJXSHZNTXg1bE9IMHJ5bE0xa0dwCm0zOElTUFhqZWQ5eVMyY1hJNy84K3lYQkNoa28ybi9aSUdYSEdaQ255SEhaT1N4Ull4TmFxRFFkb3JHRUV5UWsKb25kN3R1T2YvZmhlSDNwVHVDN2wrU1MrS0dYNHdRdUs3U1NUMFFJREFRQUJBb0lCQUJsT2dudml0Wk5sbUZVSApXVlNXaHp6YW1hbHNJVnFEeHhEbEJZR292RE9VdFJ5amgwN3pUd1NZUDl4OHdCMFpqWkFyakpheXZWNWVaR1ZVCjQ4aTRDSnZBYlV4a3VHK1RPRGNENTN5V3A4QzllVkZVSEJOV0drNlhjWXpvNWwyaHFOOVRPK2tqQzF4Q1JuNmUKbzNocGZRRlgyOVRoOUJkeXZvREhKcWZ6RC9aVUltRDZXQkFoREZ1cDVkc3V6VktRaFRMdXZkNkhtQk9LVW5XMgptTDdIbjFMM3UyMUNPM05lUlZjWHJrZ3VKV3FVODVDOTZTNFcvMG4xdWRZdWF5Y1dXWGp3TjNFczhqelRpNmNzCktsZno2WTFqTVZyUkRLY29ZeU9lSzlaN0I5TUJHL1Y1MGFTTGhpbzRCdmZBZjdLMGYxQ245aHgxMWEyckM3TmwKbmswZHlYRUNnWUVBeDBxWmZYOVJRM2JaMjNwUW5DOUprcnZvVS9XdHpaSmdadzBUd015Ym5uVmxORFo3eUN2bQpmWTZtQ3RLWU96UDlrODJETHppelplTlB1NjNaM0hMME02Nkw5VFpxYVNsTWxLOWJHby9iL0JJZEdPbCtnNnIxCi95WHhtR2NJRUVTR1J3T1lUZ3FIbkZqOVZJRTZGZU9yVzFTS0FpYndSalpsc283U1crbjE0cmNDZ1lFQTZPTk8KTWRyLzNpTkhTbDNyVTdVZGtLcUFWZ0hHQzdQazYwN1hxd1ZkdURreW16eVJtdzRFTmd0MFRXZlV0S1hBcHFFTQpqbXd4ZFY4ZzJCbXk4RCtjMldkR21ldFcxeG5XVGN2SFBBcnZLbm1iT0JBL1dyTGwvNFJtS3VYQVRlWUl5bm9QCmdEbFJTem11dmF0Uzh5OEt6TkErUnpXYlIyRHBFSjgyajhMdGxiY0NnWUVBdGJmU0NWckVVSTNZeklYVlp2Uy8KVTJxL3gzN25RZUZNd2Vwc3JvcGpBN1ByMmhZci9EUDdjVlZYRmRzOU1BNlNFK2w2eXQ0YXhyYmtoeTlZemVpTAp2MnhTOWY3dVBJR0o4TEdNa3NYR1F5eUpGNlFnMWhKWFNKWGltNkttK1o1aUNmSy9ON25tT2F2ekl0REtsQmNLCnNyWjlPTVVrcGdFSDdpN0lwVUxLRURVQ2dZQUxwdXZQcE1SdWlkZFVTalN2QUgzVk1pS3ZxdkVNdnRoeVNZU1MKNHZiWWM4d3JaakZtejZHNFRvUm9Kd3pHYVJDbGhhTktNUEdjak1Ebzd3Zzc2d0xmQWNMUGlxM1NuMUZRblNSLwp4WkJIME1QS1gwMjhMUDFDOW8zaUVaSzRrd3pYakpuZjhYNDJ4RkVRM2xTTkpFcG5DdmhDdWRUbUVsdzIzN0JzCkt2V1dLd0tCZ0hzM3M0NTNWSmllSHlUd1REUUxjU3p4K25jdTB3QnVoallQazd0dkYxcEFUYlNocVN6Y09tbGMKaVJCOXZFL1VSVkNMVkkzaHJOZElXS3dWVXpkdk84Qi9rL3laZVBVaTJZVTdJaTlYdWpodTBQdFBneDlhZERXeQp2akd6cStaK21TVnRWdFRKS1BkS014QWtmalNMUXJMc3pRcUVoR1ZnMUk5OE9lck8yNzg1Ci0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==

PS：
目前上下文都有了。

`4. 设置当前上下文

PS：命令
kubectl config use-context cluster1 --kubeconfig=./magedu-user.kubeconfig
登录进来之后，就是这个集群。

[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# kubectl config use-context cluster1 --kubeconfig=./magedu-user.kubeconfig
Switched to context "cluster1".

[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# cat magedu-user.kubeconfig 
apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURsRENDQW55Z0F3SUJBZ0lVYUJEM3VmVDMxd3k3M0I5L3ZZTCs3MWxYNktRd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1lURUxNQWtHQTFVRUJoTUNRMDR4RVRBUEJnTlZCQWdUQ0VoaGJtZGFhRzkxTVFzd0NRWURWUVFIRXdKWQpVekVNTUFvR0ExVUVDaE1EYXpoek1ROHdEUVlEVlFRTEV3WlRlWE4wWlcweEV6QVJCZ05WQkFNVENtdDFZbVZ5CmJtVjBaWE13SUJjTk1qUXdOakkzTVRVd01qQXdXaGdQTWpFeU5EQTJNRE14TlRBeU1EQmFNR0V4Q3pBSkJnTlYKQkFZVEFrTk9NUkV3RHdZRFZRUUlFd2hJWVc1bldtaHZkVEVMTUFrR0ExVUVCeE1DV0ZNeEREQUtCZ05WQkFvVApBMnM0Y3pFUE1BMEdBMVVFQ3hNR1UzbHpkR1Z0TVJNd0VRWURWUVFERXdwcmRXSmxjbTVsZEdWek1JSUJJakFOCkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXhvcnR2U1BZUEFQKzFTbnc1bVp3YlRrKy9DWW8KbmFiNE9LM1lnK3B3cnRydlFicnlWTC9nQ0ZxdXNIV1pQU3pqNDc2ZmdZOU12ZDZmZmZXUzNmaTJYWmNweUNFRwpoYlBWMlRrdXFMdlZ0YmNHUzNvS09TMWlORkVjV3RuNjgyRm8xSXdYOHQ3cUFEOW1mcnRvT3NyeDBlOG9LR3dMCjdEOEZ6cWxYczRWY3lSeWpZdVNoYU10dENrbFkwZzhTV2pDOW5NV3NsRHBpVk9zMnJqcFZUUVJ6OVZRekZWWHQKQkxXT01BdEpHVGVqODhIZEJIS3lPc21FM2crMVZmQ2ZTRHlnQXdlaHlPeko5bE96QzhCMmtrTFh6L3pOSlhnNApBbU5JZmtyOVY0UzZOZEphSWZBbjBkdmRDajBHck16bmpRbUMxc0xqU3ZtQThlb2UzRGZhNmRXTSt3SURBUUFCCm8wSXdRREFPQmdOVkhROEJBZjhFQkFNQ0FRWXdEd1lEVlIwVEFRSC9CQVV3QXdFQi96QWRCZ05WSFE0RUZnUVUKZmozdm52VUJlSS9sMVBQZkwvd243dnM0Y2FBd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFLSW1GajJRVGd3ZgpkbXlCRWlpZm5WM0tuSGVPaTdrbVBSSGtwR3dDbThYQVV0K2ordUo0Y1VZSFcrMTY4V3NhNjBJcEtockJob1ZLCkF1aVppMVkzVW5BNHBac2hvM3pzektFR3Npd0prRTUwYjVQb0ljVk1BdzlUTzFaR3A2K2xXWXdLV0lmWmxjL1oKQkorOTViL25hb2YxWGxxSklqU3ZxZG0yanQ3SnhGUGlEN2d0NHE1NzFPNVI1eldLZmJjeGF6cGgyQXk0VGVhQgp6VWxLYzU0Z0FvdFlldk8va3VqZXFVRnkybXRrNVljZWsyTDJmOFlyUFpGeU5GWkVXSTVJTjJ0YXJvU1lIVGIxCi96QW1TTzJUcSt2VWxJQnVDdTFOUlR4cHowZkZRVElnaVkzKzh0cWdoQzczU1NvWmErNGgzN1pNWVBnbm8wanEKNGpGcHlocmkzOFU9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    server: https://172.31.8.188:6443
  name: cluster1
contexts:
- context:
    cluster: cluster1
    namespace: magedu
    user: magedu-user
  name: cluster1
current-context: cluster1
kind: Config
preferences: {}
users:
- name: magedu-user
  user:
    client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUQwRENDQXJpZ0F3SUJBZ0lVUVVNaVJTUnpTMEdFZnI1L3drNWJIcllKMVlnd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1lURUxNQWtHQTFVRUJoTUNRMDR4RVRBUEJnTlZCQWdUQ0VoaGJtZGFhRzkxTVFzd0NRWURWUVFIRXdKWQpVekVNTUFvR0ExVUVDaE1EYXpoek1ROHdEUVlEVlFRTEV3WlRlWE4wWlcweEV6QVJCZ05WQkFNVENtdDFZbVZ5CmJtVjBaWE13SUJjTk1qUXdOekV6TVRnek1qQXdXaGdQTWpBM05EQTNNREV4T0RNeU1EQmFNR0F4Q3pBSkJnTlYKQkFZVEFrTk9NUkF3RGdZRFZRUUlFd2RDWldsS2FXNW5NUkF3RGdZRFZRUUhFd2RDWldsS2FXNW5NUXd3Q2dZRApWUVFLRXdOck9ITXhEekFOQmdOVkJBc1RCbE41YzNSbGJURU9NQXdHQTFVRUF4TUZRMmhwYm1Fd2dnRWlNQTBHCkNTcUdTSWIzRFFFQkFRVUFBNElCRHdBd2dnRUtBb0lCQVFDMVRJOGZZREhlOUpNb244elh6NGJCUVRlK3luVzQKUjY4V25SMW5DM2c2cmpHRGl6K0pwTk9PN0UvVTY5NC9MZHRWTnhnaEhWUlIwYnhGTm90b0dLbk5idldBT1hKbwpiWGZ5ZFgzeFpXeXNoNEJidDJSa1cwWlEzaFpKRFRBMEtkS1V4RzJZdzhxeXp5a2JIdGRYSFNTdXdnVU8wMTFJClpBT3VPR2FDVjhHVC9YUlMrZlczN1dpenR0bWxVam9JWXVESVBYcUtkNER1bEVzVmluRElzWWl0cTgxWnNHTkYKWWU4d3pIbVU0ZlN2S1V6V1FhbWJmd2hJOWVONTMzSkxaeGNqdi96N0pjRUtHU2phZjlrZ1pjY1prS2ZJY2RrNQpMRkZqRTFxb05CMmlzWVFUSkNTaWQzdTI0NS85K0Y0ZmVsTzRMdVg1Skw0b1pmakJDNHJ0SkpQUkFnTUJBQUdqCmZ6QjlNQTRHQTFVZER3RUIvd1FFQXdJRm9EQWRCZ05WSFNVRUZqQVVCZ2dyQmdFRkJRY0RBUVlJS3dZQkJRVUgKQXdJd0RBWURWUjBUQVFIL0JBSXdBREFkQmdOVkhRNEVGZ1FVQkRsVDJFeXBYUVdrRDdsamt1KytsOXBZM2F3dwpId1lEVlIwakJCZ3dGb0FVZmozdm52VUJlSS9sMVBQZkwvd243dnM0Y2FBd0RRWUpLb1pJaHZjTkFRRUxCUUFECmdnRUJBSkFIY1pscHVLbmloVHBndTZrK1JBOGxXZnN6TzlpdFFPYSt2VUJKdGViakRjL24wYnBQSnpKa29keW8KQ2twOGdZWkRyYkI3M2NvTWI0YmFyYXlsVCs1RTJKM3QyQms5ZkdMOVFkZkxnejJ0NHJvVjhpUGtDcHhENzRvVAo3aWp3Yy8zSk5GbThraDA5bkgyTG4xTjBTdk80WWZWc2djc0JlbVFmUVlHU2lEUlliT0t0TTNPcHdvNnpWRERMCjl3U1ZaSDZpQytCR3htRWFVMFZUL1Z1V2p3YXZjK3k3VENtdk1PUnpEYUVNWm10OURWVXZWYUhFUjBtM3FINTIKam1MY0JYcUE3UjBocE1nRXh4UVlGcG5CWlc1UDZEdE1sZWUvbzlvVEh4cTJzeUtKNjNNeC9YWjBtUUwwQjRRUwpmZVdyL2pPR0lGUDFlOTZPYVlTQVArajFIYk09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    client-key-data: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBdFV5UEgyQXgzdlNUS0ovTTE4K0d3VUUzdnNwMXVFZXZGcDBkWnd0NE9xNHhnNHMvCmlhVFRqdXhQMU92ZVB5M2JWVGNZSVIxVVVkRzhSVGFMYUJpcHpXNzFnRGx5YUcxMzhuVjk4V1ZzckllQVc3ZGsKWkZ0R1VONFdTUTB3TkNuU2xNUnRtTVBLc3M4cEd4N1hWeDBrcnNJRkR0TmRTR1FEcmpobWdsZkJrLzEwVXZuMQp0KzFvczdiWnBWSTZDR0xneUQxNmluZUE3cFJMRllwd3lMR0lyYXZOV2JCalJXSHZNTXg1bE9IMHJ5bE0xa0dwCm0zOElTUFhqZWQ5eVMyY1hJNy84K3lYQkNoa28ybi9aSUdYSEdaQ255SEhaT1N4Ull4TmFxRFFkb3JHRUV5UWsKb25kN3R1T2YvZmhlSDNwVHVDN2wrU1MrS0dYNHdRdUs3U1NUMFFJREFRQUJBb0lCQUJsT2dudml0Wk5sbUZVSApXVlNXaHp6YW1hbHNJVnFEeHhEbEJZR292RE9VdFJ5amgwN3pUd1NZUDl4OHdCMFpqWkFyakpheXZWNWVaR1ZVCjQ4aTRDSnZBYlV4a3VHK1RPRGNENTN5V3A4QzllVkZVSEJOV0drNlhjWXpvNWwyaHFOOVRPK2tqQzF4Q1JuNmUKbzNocGZRRlgyOVRoOUJkeXZvREhKcWZ6RC9aVUltRDZXQkFoREZ1cDVkc3V6VktRaFRMdXZkNkhtQk9LVW5XMgptTDdIbjFMM3UyMUNPM05lUlZjWHJrZ3VKV3FVODVDOTZTNFcvMG4xdWRZdWF5Y1dXWGp3TjNFczhqelRpNmNzCktsZno2WTFqTVZyUkRLY29ZeU9lSzlaN0I5TUJHL1Y1MGFTTGhpbzRCdmZBZjdLMGYxQ245aHgxMWEyckM3TmwKbmswZHlYRUNnWUVBeDBxWmZYOVJRM2JaMjNwUW5DOUprcnZvVS9XdHpaSmdadzBUd015Ym5uVmxORFo3eUN2bQpmWTZtQ3RLWU96UDlrODJETHppelplTlB1NjNaM0hMME02Nkw5VFpxYVNsTWxLOWJHby9iL0JJZEdPbCtnNnIxCi95WHhtR2NJRUVTR1J3T1lUZ3FIbkZqOVZJRTZGZU9yVzFTS0FpYndSalpsc283U1crbjE0cmNDZ1lFQTZPTk8KTWRyLzNpTkhTbDNyVTdVZGtLcUFWZ0hHQzdQazYwN1hxd1ZkdURreW16eVJtdzRFTmd0MFRXZlV0S1hBcHFFTQpqbXd4ZFY4ZzJCbXk4RCtjMldkR21ldFcxeG5XVGN2SFBBcnZLbm1iT0JBL1dyTGwvNFJtS3VYQVRlWUl5bm9QCmdEbFJTem11dmF0Uzh5OEt6TkErUnpXYlIyRHBFSjgyajhMdGxiY0NnWUVBdGJmU0NWckVVSTNZeklYVlp2Uy8KVTJxL3gzN25RZUZNd2Vwc3JvcGpBN1ByMmhZci9EUDdjVlZYRmRzOU1BNlNFK2w2eXQ0YXhyYmtoeTlZemVpTAp2MnhTOWY3dVBJR0o4TEdNa3NYR1F5eUpGNlFnMWhKWFNKWGltNkttK1o1aUNmSy9ON25tT2F2ekl0REtsQmNLCnNyWjlPTVVrcGdFSDdpN0lwVUxLRURVQ2dZQUxwdXZQcE1SdWlkZFVTalN2QUgzVk1pS3ZxdkVNdnRoeVNZU1MKNHZiWWM4d3JaakZtejZHNFRvUm9Kd3pHYVJDbGhhTktNUEdjak1Ebzd3Zzc2d0xmQWNMUGlxM1NuMUZRblNSLwp4WkJIME1QS1gwMjhMUDFDOW8zaUVaSzRrd3pYakpuZjhYNDJ4RkVRM2xTTkpFcG5DdmhDdWRUbUVsdzIzN0JzCkt2V1dLd0tCZ0hzM3M0NTNWSmllSHlUd1REUUxjU3p4K25jdTB3QnVoallQazd0dkYxcEFUYlNocVN6Y09tbGMKaVJCOXZFL1VSVkNMVkkzaHJOZElXS3dWVXpkdk84Qi9rL3laZVBVaTJZVTdJaTlYdWpodTBQdFBneDlhZERXeQp2akd6cStaK21TVnRWdFRKS1BkS014QWtmalNMUXJMc3pRcUVoR1ZnMUk5OE9lck8yNzg1Ci0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==

PS：
到此位置，这个文件生成完毕。

# 让magedu-user登录dashboard，继续操作如下

[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# kubectl get secrets -A | grep magedu-user
magedu                 magedu-user-token-4c7fk                          kubernetes.io/service-account-token   3      121m

[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# kubectl describe secrets -n magedu magedu-user-token-4c7fk 
Name:         magedu-user-token-4c7fk
Namespace:    magedu
Labels:       <none>
Annotations:  kubernetes.io/service-account.name: magedu-user
              kubernetes.io/service-account.uid: e777fc7c-9fb5-493c-bc21-4d3e6d8c4c96

Type:  kubernetes.io/service-account-token

Data
====
namespace:  6 bytes
token:      eyJhbGciOiJSUzI1NiIsImtpZCI6InVHeWpKMFVtTHZZWndyOHNMTURFNUFCeEQ4Zl9EbjdYdnhscXdKclVGaDgifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJtYWdlZHUiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlY3JldC5uYW1lIjoibWFnZWR1LXVzZXItdG9rZW4tNGM3ZmsiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoibWFnZWR1LXVzZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiJlNzc3ZmM3Yy05ZmI1LTQ5M2MtYmMyMS00ZDNlNmQ4YzRjOTYiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6bWFnZWR1Om1hZ2VkdS11c2VyIn0.KKVUkTrHXTanbO9swuVIgOdDCZ-jg6LHh0e1_KEu1zKIrxhOgd5UR7676kFDz1M4v6SO20qq6A4RfWWU1QdYGsVEys51IgFGof800VmE-14nHCzpV6miT13HPq5PNLQ2tWubH08Qf7MVgv-o5Hd7WZAxiNtSV2xffEag6fX3s8pC4icHV3bohb7owpZW4WY2LP1M6y1ycq_2xuHwhudUY0veo-Zsk3D1I62qlZJS_lC6THWfqwSD5NH34cERzWVII-CMxx7htJsIbrZ2T1rhbhpGmwALgUkDLCZo23Bxi8sDn56IQAK0RHIs5aAx63dH8FsilyhycmqfZMLeh6Udgw
ca.crt:     1302 bytes

# 将token加入到magedu-user.config文件中
[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# vim magedu-user.kubeconfig 
apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURsRENDQW55Z0F3SUJBZ0lVYUJEM3VmVDMxd3k3M0I5L3ZZTCs3MWxYNktRd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1lURUxNQWtHQTFVRUJoTUNRMDR4RVRBUEJnTlZCQWdUQ0VoaGJtZGFhRzkxTVFzd0NRWURWUVFIRXdKWQpVekVNTUFvR0ExVUVDaE1EYXpoek1ROHdEUVlEVlFRTEV3WlRlWE4wWlcweEV6QVJCZ05WQkFNVENtdDFZbVZ5CmJtVjBaWE13SUJjTk1qUXdOakkzTVRVd01qQXdXaGdQTWpFeU5EQTJNRE14TlRBeU1EQmFNR0V4Q3pBSkJnTlYKQkFZVEFrTk9NUkV3RHdZRFZRUUlFd2hJWVc1bldtaHZkVEVMTUFrR0ExVUVCeE1DV0ZNeEREQUtCZ05WQkFvVApBMnM0Y3pFUE1BMEdBMVVFQ3hNR1UzbHpkR1Z0TVJNd0VRWURWUVFERXdwcmRXSmxjbTVsZEdWek1JSUJJakFOCkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXhvcnR2U1BZUEFQKzFTbnc1bVp3YlRrKy9DWW8KbmFiNE9LM1lnK3B3cnRydlFicnlWTC9nQ0ZxdXNIV1pQU3pqNDc2ZmdZOU12ZDZmZmZXUzNmaTJYWmNweUNFRwpoYlBWMlRrdXFMdlZ0YmNHUzNvS09TMWlORkVjV3RuNjgyRm8xSXdYOHQ3cUFEOW1mcnRvT3NyeDBlOG9LR3dMCjdEOEZ6cWxYczRWY3lSeWpZdVNoYU10dENrbFkwZzhTV2pDOW5NV3NsRHBpVk9zMnJqcFZUUVJ6OVZRekZWWHQKQkxXT01BdEpHVGVqODhIZEJIS3lPc21FM2crMVZmQ2ZTRHlnQXdlaHlPeko5bE96QzhCMmtrTFh6L3pOSlhnNApBbU5JZmtyOVY0UzZOZEphSWZBbjBkdmRDajBHck16bmpRbUMxc0xqU3ZtQThlb2UzRGZhNmRXTSt3SURBUUFCCm8wSXdRREFPQmdOVkhROEJBZjhFQkFNQ0FRWXdEd1lEVlIwVEFRSC9CQVV3QXdFQi96QWRCZ05WSFE0RUZnUVUKZmozdm52VUJlSS9sMVBQZkwvd243dnM0Y2FBd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFLSW1GajJRVGd3ZgpkbXlCRWlpZm5WM0tuSGVPaTdrbVBSSGtwR3dDbThYQVV0K2ordUo0Y1VZSFcrMTY4V3NhNjBJcEtockJob1ZLCkF1aVppMVkzVW5BNHBac2hvM3pzektFR3Npd0prRTUwYjVQb0ljVk1BdzlUTzFaR3A2K2xXWXdLV0lmWmxjL1oKQkorOTViL25hb2YxWGxxSklqU3ZxZG0yanQ3SnhGUGlEN2d0NHE1NzFPNVI1eldLZmJjeGF6cGgyQXk0VGVhQgp6VWxLYzU0Z0FvdFlldk8va3VqZXFVRnkybXRrNVljZWsyTDJmOFlyUFpGeU5GWkVXSTVJTjJ0YXJvU1lIVGIxCi96QW1TTzJUcSt2VWxJQnVDdTFOUlR4cHowZkZRVElnaVkzKzh0cWdoQzczU1NvWmErNGgzN1pNWVBnbm8wanEKNGpGcHlocmkzOFU9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    server: https://172.31.8.188:6443
  name: cluster1
contexts:
- context:
    cluster: cluster1
    namespace: magedu
    user: magedu-user
  name: cluster1
current-context: cluster1
kind: Config
preferences: {}
users:
- name: magedu-user
  user:
    client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUQwRENDQXJpZ0F3SUJBZ0lVUVVNaVJTUnpTMEdFZnI1L3drNWJIcllKMVlnd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1lURUxNQWtHQTFVRUJoTUNRMDR4RVRBUEJnTlZCQWdUQ0VoaGJtZGFhRzkxTVFzd0NRWURWUVFIRXdKWQpVekVNTUFvR0ExVUVDaE1EYXpoek1ROHdEUVlEVlFRTEV3WlRlWE4wWlcweEV6QVJCZ05WQkFNVENtdDFZbVZ5CmJtVjBaWE13SUJjTk1qUXdOekV6TVRnek1qQXdXaGdQTWpBM05EQTNNREV4T0RNeU1EQmFNR0F4Q3pBSkJnTlYKQkFZVEFrTk9NUkF3RGdZRFZRUUlFd2RDWldsS2FXNW5NUkF3RGdZRFZRUUhFd2RDWldsS2FXNW5NUXd3Q2dZRApWUVFLRXdOck9ITXhEekFOQmdOVkJBc1RCbE41YzNSbGJURU9NQXdHQTFVRUF4TUZRMmhwYm1Fd2dnRWlNQTBHCkNTcUdTSWIzRFFFQkFRVUFBNElCRHdBd2dnRUtBb0lCQVFDMVRJOGZZREhlOUpNb244elh6NGJCUVRlK3luVzQKUjY4V25SMW5DM2c2cmpHRGl6K0pwTk9PN0UvVTY5NC9MZHRWTnhnaEhWUlIwYnhGTm90b0dLbk5idldBT1hKbwpiWGZ5ZFgzeFpXeXNoNEJidDJSa1cwWlEzaFpKRFRBMEtkS1V4RzJZdzhxeXp5a2JIdGRYSFNTdXdnVU8wMTFJClpBT3VPR2FDVjhHVC9YUlMrZlczN1dpenR0bWxVam9JWXVESVBYcUtkNER1bEVzVmluRElzWWl0cTgxWnNHTkYKWWU4d3pIbVU0ZlN2S1V6V1FhbWJmd2hJOWVONTMzSkxaeGNqdi96N0pjRUtHU2phZjlrZ1pjY1prS2ZJY2RrNQpMRkZqRTFxb05CMmlzWVFUSkNTaWQzdTI0NS85K0Y0ZmVsTzRMdVg1Skw0b1pmakJDNHJ0SkpQUkFnTUJBQUdqCmZ6QjlNQTRHQTFVZER3RUIvd1FFQXdJRm9EQWRCZ05WSFNVRUZqQVVCZ2dyQmdFRkJRY0RBUVlJS3dZQkJRVUgKQXdJd0RBWURWUjBUQVFIL0JBSXdBREFkQmdOVkhRNEVGZ1FVQkRsVDJFeXBYUVdrRDdsamt1KytsOXBZM2F3dwpId1lEVlIwakJCZ3dGb0FVZmozdm52VUJlSS9sMVBQZkwvd243dnM0Y2FBd0RRWUpLb1pJaHZjTkFRRUxCUUFECmdnRUJBSkFIY1pscHVLbmloVHBndTZrK1JBOGxXZnN6TzlpdFFPYSt2VUJKdGViakRjL24wYnBQSnpKa29keW8KQ2twOGdZWkRyYkI3M2NvTWI0YmFyYXlsVCs1RTJKM3QyQms5ZkdMOVFkZkxnejJ0NHJvVjhpUGtDcHhENzRvVAo3aWp3Yy8zSk5GbThraDA5bkgyTG4xTjBTdk80WWZWc2djc0JlbVFmUVlHU2lEUlliT0t0TTNPcHdvNnpWRERMCjl3U1ZaSDZpQytCR3htRWFVMFZUL1Z1V2p3YXZjK3k3VENtdk1PUnpEYUVNWm10OURWVXZWYUhFUjBtM3FINTIKam1MY0JYcUE3UjBocE1nRXh4UVlGcG5CWlc1UDZEdE1sZWUvbzlvVEh4cTJzeUtKNjNNeC9YWjBtUUwwQjRRUwpmZVdyL2pPR0lGUDFlOTZPYVlTQVArajFIYk09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    client-key-data: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBdFV5UEgyQXgzdlNUS0ovTTE4K0d3VUUzdnNwMXVFZXZGcDBkWnd0NE9xNHhnNHMvCmlhVFRqdXhQMU92ZVB5M2JWVGNZSVIxVVVkRzhSVGFMYUJpcHpXNzFnRGx5YUcxMzhuVjk4V1ZzckllQVc3ZGsKWkZ0R1VONFdTUTB3TkNuU2xNUnRtTVBLc3M4cEd4N1hWeDBrcnNJRkR0TmRTR1FEcmpobWdsZkJrLzEwVXZuMQp0KzFvczdiWnBWSTZDR0xneUQxNmluZUE3cFJMRllwd3lMR0lyYXZOV2JCalJXSHZNTXg1bE9IMHJ5bE0xa0dwCm0zOElTUFhqZWQ5eVMyY1hJNy84K3lYQkNoa28ybi9aSUdYSEdaQ255SEhaT1N4Ull4TmFxRFFkb3JHRUV5UWsKb25kN3R1T2YvZmhlSDNwVHVDN2wrU1MrS0dYNHdRdUs3U1NUMFFJREFRQUJBb0lCQUJsT2dudml0Wk5sbUZVSApXVlNXaHp6YW1hbHNJVnFEeHhEbEJZR292RE9VdFJ5amgwN3pUd1NZUDl4OHdCMFpqWkFyakpheXZWNWVaR1ZVCjQ4aTRDSnZBYlV4a3VHK1RPRGNENTN5V3A4QzllVkZVSEJOV0drNlhjWXpvNWwyaHFOOVRPK2tqQzF4Q1JuNmUKbzNocGZRRlgyOVRoOUJkeXZvREhKcWZ6RC9aVUltRDZXQkFoREZ1cDVkc3V6VktRaFRMdXZkNkhtQk9LVW5XMgptTDdIbjFMM3UyMUNPM05lUlZjWHJrZ3VKV3FVODVDOTZTNFcvMG4xdWRZdWF5Y1dXWGp3TjNFczhqelRpNmNzCktsZno2WTFqTVZyUkRLY29ZeU9lSzlaN0I5TUJHL1Y1MGFTTGhpbzRCdmZBZjdLMGYxQ245aHgxMWEyckM3TmwKbmswZHlYRUNnWUVBeDBxWmZYOVJRM2JaMjNwUW5DOUprcnZvVS9XdHpaSmdadzBUd015Ym5uVmxORFo3eUN2bQpmWTZtQ3RLWU96UDlrODJETHppelplTlB1NjNaM0hMME02Nkw5VFpxYVNsTWxLOWJHby9iL0JJZEdPbCtnNnIxCi95WHhtR2NJRUVTR1J3T1lUZ3FIbkZqOVZJRTZGZU9yVzFTS0FpYndSalpsc283U1crbjE0cmNDZ1lFQTZPTk8KTWRyLzNpTkhTbDNyVTdVZGtLcUFWZ0hHQzdQazYwN1hxd1ZkdURreW16eVJtdzRFTmd0MFRXZlV0S1hBcHFFTQpqbXd4ZFY4ZzJCbXk4RCtjMldkR21ldFcxeG5XVGN2SFBBcnZLbm1iT0JBL1dyTGwvNFJtS3VYQVRlWUl5bm9QCmdEbFJTem11dmF0Uzh5OEt6TkErUnpXYlIyRHBFSjgyajhMdGxiY0NnWUVBdGJmU0NWckVVSTNZeklYVlp2Uy8KVTJxL3gzN25RZUZNd2Vwc3JvcGpBN1ByMmhZci9EUDdjVlZYRmRzOU1BNlNFK2w2eXQ0YXhyYmtoeTlZemVpTAp2MnhTOWY3dVBJR0o4TEdNa3NYR1F5eUpGNlFnMWhKWFNKWGltNkttK1o1aUNmSy9ON25tT2F2ekl0REtsQmNLCnNyWjlPTVVrcGdFSDdpN0lwVUxLRURVQ2dZQUxwdXZQcE1SdWlkZFVTalN2QUgzVk1pS3ZxdkVNdnRoeVNZU1MKNHZiWWM4d3JaakZtejZHNFRvUm9Kd3pHYVJDbGhhTktNUEdjak1Ebzd3Zzc2d0xmQWNMUGlxM1NuMUZRblNSLwp4WkJIME1QS1gwMjhMUDFDOW8zaUVaSzRrd3pYakpuZjhYNDJ4RkVRM2xTTkpFcG5DdmhDdWRUbUVsdzIzN0JzCkt2V1dLd0tCZ0hzM3M0NTNWSmllSHlUd1REUUxjU3p4K25jdTB3QnVoallQazd0dkYxcEFUYlNocVN6Y09tbGMKaVJCOXZFL1VSVkNMVkkzaHJOZElXS3dWVXpkdk84Qi9rL3laZVBVaTJZVTdJaTlYdWpodTBQdFBneDlhZERXeQp2akd6cStaK21TVnRWdFRKS1BkS014QWtmalNMUXJMc3pRcUVoR1ZnMUk5OE9lck8yNzg1Ci0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==
    token: eyJhbGciOiJSUzI1NiIsImtpZCI6InVHeWpKMFVtTHZZWndyOHNMTURFNUFCeEQ4Zl9EbjdYdnhscXdKclVGaDgifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJtYWdlZHUiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlY3JldC5uYW1lIjoibWFnZWR1LXVzZXItdG9rZW4tNGM3ZmsiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoibWFnZWR1LXVzZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiJlNzc3ZmM3Yy05ZmI1LTQ5M2MtYmMyMS00ZDNlNmQ4YzRjOTYiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6bWFnZWR1Om1hZ2VkdS11c2VyIn0.KKVUkTrHXTanbO9swuVIgOdDCZ-jg6LHh0e1_KEu1zKIrxhOgd5UR7676kFDz1M4v6SO20qq6A4RfWWU1QdYGsVEys51IgFGof800VmE-14nHCzpV6miT13HPq5PNLQ2tWubH08Qf7MVgv-o5Hd7WZAxiNtSV2xffEag6fX3s8pC4icHV3bohb7owpZW4WY2LP1M6y1ycq_2xuHwhudUY0veo-Zsk3D1I62qlZJS_lC6THWfqwSD5NH34cERzWVII-CMxx7htJsIbrZ2T1rhbhpGmwALgUkDLCZo23Bxi8sDn56IQAK0RHIs5aAx63dH8FsilyhycmqfZMLeh6Udg

PS：
token已经加入到magedu-user.kubeconfig中

将这个文件拷贝到windows桌面上。

登录dashboard。
```

![](assets/images/kubeconfig_user01.png)

#### 1.5.2.2：admin用户使用kube-config文件登录dashboard

```sh
# 如果想通过这个文件登录k8s集群
[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# cp /root/.kube/config /opt/admin-kubeconfig

PS：
要在这个文件中追加认证信息。

[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# kubectl get secrets -A | grep admin
kubernetes-dashboard   admin-user-token-cdh8k                           kubernetes.io/service-account-token   3      15d

[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# kubectl describe secrets -n kubernetes-dashboard admin-user-token-cdh8k 
Name:         admin-user-token-cdh8k
Namespace:    kubernetes-dashboard
Labels:       <none>
Annotations:  kubernetes.io/service-account.name: admin-user
              kubernetes.io/service-account.uid: f6f3f2bd-3247-414b-beae-3530cfe1fe5b

Type:  kubernetes.io/service-account-token

Data
====
namespace:  20 bytes
token:      eyJhbGciOiJSUzI1NiIsImtpZCI6InVHeWpKMFVtTHZZWndyOHNMTURFNUFCeEQ4Zl9EbjdYdnhscXdKclVGaDgifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJhZG1pbi11c2VyLXRva2VuLWNkaDhrIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImFkbWluLXVzZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiJmNmYzZjJiZC0zMjQ3LTQxNGItYmVhZS0zNTMwY2ZlMWZlNWIiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZXJuZXRlcy1kYXNoYm9hcmQ6YWRtaW4tdXNlciJ9.s6ISwp7q5tqUI10Ztj0k-s35QE1tSim3I0xcq5Re99RRoZISpIOsCqr8Wa8e1veKA3mrHDfoJxEp3jdyJKc659hG0Gu5a4UEIHG41q1KZK4sACNN3K0yEpkVqGY8d_jWS442XqKh-d8QAcIi5Xe1q03I2LzWMlshg2F3U1JJlafM27xbWo-28kxfSHVNnrRNQ9MaIT0mKThiDdbTLJmHBGrSDAq0JC0jcPbO2hpmSRCRIjzy2CwN1pkGaTs6cHWJrrbsu_B_VTMgqo4GW_ZGb4z2HyWVcvkEKVbcSzC5BIM8LBUs7eIuR4Lg8k2xeD-zpQC-oakdD8b1XbjWmeZQjw
ca.crt:     1302 bytes

PS：
复制token到kubeconfig文件中

[root@k8s-master1:~/yaml/20240710/RBAC-yaml-case]# vim /opt/admin-kubeconfig 
apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURsRENDQW55Z0F3SUJBZ0lVYUJEM3VmVDMxd3k3M0I5L3ZZTCs3MWxYNktRd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1lURUxNQWtHQTFVRUJoTUNRMDR4RVRBUEJnTlZCQWdUQ0VoaGJtZGFhRzkxTVFzd0NRWURWUVFIRXdKWQpVekVNTUFvR0ExVUVDaE1EYXpoek1ROHdEUVlEVlFRTEV3WlRlWE4wWlcweEV6QVJCZ05WQkFNVENtdDFZbVZ5CmJtVjBaWE13SUJjTk1qUXdOakkzTVRVd01qQXdXaGdQTWpFeU5EQTJNRE14TlRBeU1EQmFNR0V4Q3pBSkJnTlYKQkFZVEFrTk9NUkV3RHdZRFZRUUlFd2hJWVc1bldtaHZkVEVMTUFrR0ExVUVCeE1DV0ZNeEREQUtCZ05WQkFvVApBMnM0Y3pFUE1BMEdBMVVFQ3hNR1UzbHpkR1Z0TVJNd0VRWURWUVFERXdwcmRXSmxjbTVsZEdWek1JSUJJakFOCkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXhvcnR2U1BZUEFQKzFTbnc1bVp3YlRrKy9DWW8KbmFiNE9LM1lnK3B3cnRydlFicnlWTC9nQ0ZxdXNIV1pQU3pqNDc2ZmdZOU12ZDZmZmZXUzNmaTJYWmNweUNFRwpoYlBWMlRrdXFMdlZ0YmNHUzNvS09TMWlORkVjV3RuNjgyRm8xSXdYOHQ3cUFEOW1mcnRvT3NyeDBlOG9LR3dMCjdEOEZ6cWxYczRWY3lSeWpZdVNoYU10dENrbFkwZzhTV2pDOW5NV3NsRHBpVk9zMnJqcFZUUVJ6OVZRekZWWHQKQkxXT01BdEpHVGVqODhIZEJIS3lPc21FM2crMVZmQ2ZTRHlnQXdlaHlPeko5bE96QzhCMmtrTFh6L3pOSlhnNApBbU5JZmtyOVY0UzZOZEphSWZBbjBkdmRDajBHck16bmpRbUMxc0xqU3ZtQThlb2UzRGZhNmRXTSt3SURBUUFCCm8wSXdRREFPQmdOVkhROEJBZjhFQkFNQ0FRWXdEd1lEVlIwVEFRSC9CQVV3QXdFQi96QWRCZ05WSFE0RUZnUVUKZmozdm52VUJlSS9sMVBQZkwvd243dnM0Y2FBd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFLSW1GajJRVGd3ZgpkbXlCRWlpZm5WM0tuSGVPaTdrbVBSSGtwR3dDbThYQVV0K2ordUo0Y1VZSFcrMTY4V3NhNjBJcEtockJob1ZLCkF1aVppMVkzVW5BNHBac2hvM3pzektFR3Npd0prRTUwYjVQb0ljVk1BdzlUTzFaR3A2K2xXWXdLV0lmWmxjL1oKQkorOTViL25hb2YxWGxxSklqU3ZxZG0yanQ3SnhGUGlEN2d0NHE1NzFPNVI1eldLZmJjeGF6cGgyQXk0VGVhQgp6VWxLYzU0Z0FvdFlldk8va3VqZXFVRnkybXRrNVljZWsyTDJmOFlyUFpGeU5GWkVXSTVJTjJ0YXJvU1lIVGIxCi96QW1TTzJUcSt2VWxJQnVDdTFOUlR4cHowZkZRVElnaVkzKzh0cWdoQzczU1NvWmErNGgzN1pNWVBnbm8wanEKNGpGcHlocmkzOFU9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    server: https://172.31.8.188:6443
  name: cluster1
contexts:
- context:
    cluster: cluster1
    user: admin
  name: context-cluster1
current-context: context-cluster1
kind: Config
preferences: {}
users:
- name: admin
  user:
    client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUQxekNDQXIrZ0F3SUJBZ0lVRUVHczd6SW9UOXYwclF6YTF0MVJZTzJRR2hZd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1lURUxNQWtHQTFVRUJoTUNRMDR4RVRBUEJnTlZCQWdUQ0VoaGJtZGFhRzkxTVFzd0NRWURWUVFIRXdKWQpVekVNTUFvR0ExVUVDaE1EYXpoek1ROHdEUVlEVlFRTEV3WlRlWE4wWlcweEV6QVJCZ05WQkFNVENtdDFZbVZ5CmJtVjBaWE13SUJjTk1qUXdOakkzTVRVd05UQXdXaGdQTWpBM05EQTJNVFV4TlRBMU1EQmFNR2N4Q3pBSkJnTlYKQkFZVEFrTk9NUkV3RHdZRFZRUUlFd2hJWVc1bldtaHZkVEVMTUFrR0ExVUVCeE1DV0ZNeEZ6QVZCZ05WQkFvVApEbk41YzNSbGJUcHRZWE4wWlhKek1ROHdEUVlEVlFRTEV3WlRlWE4wWlcweERqQU1CZ05WQkFNVEJXRmtiV2x1Ck1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBdjlpSDhuMkIwanpOWTFpMTY2b0gKVHRySnczRnBBS2FTZjNIOGJGVlZOUmZQSGNSOEplaTBSQ2xtZVBTbzEwM0FrM2ViV01FRWtrdnFaWVl4UFJhTQpROHhZbE5QNlVxdGZ3OEVuYUVzc21rSkZlckJoMC9VYXZWTmpqWjFJclRGT0xpQWltY0hjNDB4V0c5YmJEdWZnCjdESjRQUG90SXF2Wmp0S2xFYlN1eENaMS9tUFo1S2FTUFhXbUNVSkhvbmxGSmc3UmNWcWtqSFo4dkQ0MVZCODYKU1FEbGpIYUh2NWlpbUpMbmlHcm53UEhhcldXUHRvUUs4QzUrUldUaGJTOUtxMjc1SWd3M254Sk9JVUp3Znhocwp0ZGZrZktiQ2JGNVhWMEozKzkvM0hJUzBXZ0RPWFp0SlVxZGhyVTNVQXFGYVd0RlNXV0FDSTRpU3lDbUE4eVcyCkh3SURBUUFCbzM4d2ZUQU9CZ05WSFE4QkFmOEVCQU1DQmFBd0hRWURWUjBsQkJZd0ZBWUlLd1lCQlFVSEF3RUcKQ0NzR0FRVUZCd01DTUF3R0ExVWRFd0VCL3dRQ01BQXdIUVlEVlIwT0JCWUVGS0t3NDF6NVdnbXVvdHBvRzFrYgpWdXdDSThOZ01COEdBMVVkSXdRWU1CYUFGSDQ5NzU3MUFYaVA1ZFR6M3kvOEorNzdPSEdnTUEwR0NTcUdTSWIzCkRRRUJDd1VBQTRJQkFRQzJvdkx4Q2gwMlV3TUk4MndFSFhaSkVGRExONGthMm1yMjdGUWIwdWVnWG5IV1drSjkKcHJFQk5QUXgydGIwSkVZV0RwbjRTM0JkeDdkVzdYMC8wYUw2VU92RVhtWEJpNmYzUDVzVC9nTWU5NE5pRGNxRwpIa1pQOTNGQUFiM2l5eVQ1V3VtWDBZQWV4Wk15N3E5d1hWUXFNaUdubWFQaEx6clpRdWpvWEZKNXVCS3ByRHhuCnUwU0ZVTnphQmZOQjFkMEJQT3FvMmhDNytsWldnbmwxaDI4bVBJMFZGZ21iSGFyRmxSUVNUSmN0bzM3NnBCdDIKbXRTc1VtQ2w1OTdJOHZTYzFSd2hMZVE0Q3UzdHFqTHJrcmR1VkJhTDVUSXoybzJORDJOS21HZlNSQ3pXQlFQZwppTUtvWkpHYzNCWjhTQldyR3lDNkdNSC9WdlBNcnR4Q0prckMKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
    client-key-data: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBdjlpSDhuMkIwanpOWTFpMTY2b0hUdHJKdzNGcEFLYVNmM0g4YkZWVk5SZlBIY1I4CkplaTBSQ2xtZVBTbzEwM0FrM2ViV01FRWtrdnFaWVl4UFJhTVE4eFlsTlA2VXF0Znc4RW5hRXNzbWtKRmVyQmgKMC9VYXZWTmpqWjFJclRGT0xpQWltY0hjNDB4V0c5YmJEdWZnN0RKNFBQb3RJcXZaanRLbEViU3V4Q1oxL21QWgo1S2FTUFhXbUNVSkhvbmxGSmc3UmNWcWtqSFo4dkQ0MVZCODZTUURsakhhSHY1aWltSkxuaUdybndQSGFyV1dQCnRvUUs4QzUrUldUaGJTOUtxMjc1SWd3M254Sk9JVUp3Znhoc3RkZmtmS2JDYkY1WFYwSjMrOS8zSElTMFdnRE8KWFp0SlVxZGhyVTNVQXFGYVd0RlNXV0FDSTRpU3lDbUE4eVcySHdJREFRQUJBb0lCQUVaVUFacFNpam5oRWtZZQpLaXFuWFNCNk1rYlVsM0ttbmNQY3JIV21YcU1sQkVkY1ZVcXNZUkV2d0NJTlJxd1BFODY3cFJaSFEvN0JsNzc2CkQ2amVVRE0yZ1M2bCt2azlXOUR1U1IwQm1lcys2aXVNNTRBRk5YVThVWjJEa0RYMWdqeUVpVXFtZCt4WGVxV2cKQVJRWXl5cXJZY3F3eDhVVERLRS85VVZsWUVBRldzY2YzRDlPK0pSc3RNWThzTDVEZ2Q4NzBjRHVwM3dWdTFoSgpRTDRFQW5sUVBsTVVwNnU2YnZ1Q00yQ3hMdW1hRjM0aEEvVURxSFB5cXBhV1RlYUNtZTh0aUp3bFErOWxSZksyCkV3Y1d2OEJTNjBha0d1Q1VsTjFvRjdQaXJ6N0xobEdSc2tLSnZzZXB2Z3lqTTl4UjRlYTBqK3NVd1lidUExTzcKNjBpVEJ5a0NnWUVBNkdzM00wSDJ3V3FqUG9CeGo4WG9BL0RtWTM1ZjdONlVUL3Y5Tk9GdSsxckI5akZDOEtnSApJSTJCaE5wcWlMQ2pUSVRqTVVQcnFCYVd5dnFZV1Qyd1U1V1Y0RGlDbG5yTGZsbFlpcTE1a0lNWGRUekZMWmdmCndwTVVvcko5V2I0cWtaVWpabi9XamJLV1BxcFFralJvazhxUHc4RXpaTFJhWnZWd1dnSGtrUU1DZ1lFQTAwOTcKdzdrd1l4RWtySWVqWTc4OW1LNlUxdUNOTWZSam1uaWU3aVpIc0N5d3d2anM2aHNDVDViNU93S1p4ZW5jak9ZRwpGTnduUmJZUXprcHFuNWtJdEhnV1hueGlJTitrVWp5NFFaZnZCaEF0aW9zS252OXlxU2xFMDZLaDBuaUdUVXRiCitYQ3RQcUdRVmRob0xpd2toeGU1M01SNUVxWWRYVmVkNnBMSFpiVUNnWUVBZ0JoWFhCREhCdUxYQmVPVXMwREkKRnlQMlZtK1lQdHlOc1dlWXJrUncvbWVPN3psSFE0dllJY0RiMlhUbnNsNW9JZ3c3aXpONzlqQTgrN0lSdFYyaQppTzZ3bzl1QlhaNWYrVXNVMlpteW5rc2g2cU9McVExbXM3Nk1hUDhteHdkZ1BzeUxyanBXN2RHM3JPSUJkaE1jCmNCZjhGRSt2RzVtckdZTzhZRjhhc2pFQ2dZRUF3aU5OVHdXdVNlWXZMbit6Z21ucU9vTnk1WFFLNVBGbUxUNVMKcmZQbmV4bWtFSTFJaE5EcHI1dkNRUS9qbld4OW44bVpuc0toSmkvZWd0amwydGxyb1BxUGVxR0dPak9lTVp2dApvUDNvc1VaZHdPSjdrSmFham9ZRzRQV1MvTjZVYlNFbVVDYlFWREYxZlJsRXBkOFNkRGM5SUhJMTFnZGVCU3NCClA4azRmdDBDZ1lCMHBBcTVyay82VXppVzJoaDFabHBhaGhKYzBYR3ZTdC9NVWs1eHhBOWFTQmhNZWt5UXhIRUYKbE13elNnWDd3VTdGeTlNTE53LzJ0Q2JleXRUT2VoNTc3cGN0ZzgxNVZFZjhRQ2loOS9RWkxMZS81WDcySmJ1Rgo2SFlCNWsreVg1UzQyeVF1aHZHeTdDRkFMTDdRSStnT3BiMDNjdWtrZDFyOWo5anc0T3VrdGc9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
    token: eyJhbGciOiJSUzI1NiIsImtpZCI6InVHeWpKMFVtTHZZWndyOHNMTURFNUFCeEQ4Zl9EbjdYdnhscXdKclVGaDgifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJhZG1pbi11c2VyLXRva2VuLWNkaDhrIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImFkbWluLXVzZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiJmNmYzZjJiZC0zMjQ3LTQxNGItYmVhZS0zNTMwY2ZlMWZlNWIiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZXJuZXRlcy1kYXNoYm9hcmQ6YWRtaW4tdXNlciJ9.s6ISwp7q5tqUI10Ztj0k-s35QE1tSim3I0xcq5Re99RRoZISpIOsCqr8Wa8e1veKA3mrHDfoJxEp3jdyJKc659hG0Gu5a4UEIHG41q1KZK4sACNN3K0yEpkVqGY8d_jWS442XqKh-d8QAcIi5Xe1q03I2LzWMlshg2F3U1JJlafM27xbWo-28kxfSHVNnrRNQ9MaIT0mKThiDdbTLJmHBGrSDAq0JC0jcPbO2hpmSRCRIjzy2CwN1pkGaTs6cHWJrrbsu_B_VTMgqo4GW_ZGb4z2HyWVcvkEKVbcSzC5BIM8LBUs7eIuR4Lg8k2xeD-zpQC-oakdD8b1XbjWmeZQjw

PS：
把这个文件放到本地，就可以登录了，不过这是admin权限。

将这个文件放到windows桌面。
使用dashboard登录
```

![](assets/images/kubeconfig_admin01.png)

![kubeconfig_admin02](assets/images/kubeconfig_admin02.png)

